{"spaces":[{"id":0,"spaceId":"ntb-defs-0","name":"קבוצה 1","width":450,"height":1200,"defs":{"version":5,"height":1200,"width":450,"blocks":[{"id":0,"action":"","required":true,"placement":"starter","format":"to configure-population-1\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 1))","isTerminal":true,"closeClauses":"table:put curr-ast-by-population 1 ast-root","limit":1,"blockColor":"#078c03","clauses":[{"children":[],"action":"תכונות","open":"add-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" {0}))","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["property"]}},{"children":[],"action":"פעולות","open":"add-node \"actions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["action"]}},{"children":[],"action":"יחסי גומלין","open":"add-node \"interactions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["interaction"]}}],"params":[{"id":0,"type":"text","name":"שם קבוצה"}]},{"id":1,"action":"צבע","required":false,"placement":"child","format":"add-node \"color\" (list (list \"color\" {0}))","isTerminal":false,"blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"select","name":"צבע","quoteValues":"never-quote","default":"15","values":[{"actual":"15","display":"אדום"},{"actual":"25","display":"כתום"},{"actual":"35","display":"חום"},{"actual":"45","display":"צהוב"},{"actual":"55","display":"ירוק"},{"actual":"65","display":"ירוק בהיר"},{"actual":"75","display":"טורקיז"},{"actual":"85","display":"ציאן"},{"actual":"95","display":"כחול בהיר"},{"actual":"105","display":"כחול"},{"actual":"115","display":"סגול"},{"actual":"125","display":"מגנטה"},{"actual":"135","display":"ורוד"},{"actual":"9.9","display":"לבן"},{"actual":"5","display":"אפור"}]}]},{"id":2,"action":"גודל","required":false,"placement":"child","format":"add-node \"size\" (list (list \"size\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"range","def":0.5,"name":"גודל","step":0.1,"random":false,"default":0.5,"min":0.1,"max":3}]},{"id":3,"action":"צורה","required":false,"placement":"child","format":"add-node \"shape\" (list (list \"shape\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"select","name":"צורה","quoteValues":"never-quote","default":"\"circle\"","values":[{"actual":"\"circle\"","display":"עיגול"},{"actual":"\"square\"","display":"ריבוע"},{"actual":"\"arrow\"","display":"חץ"},{"actual":"\"molecule-a2\"","display":"A2 מולקולה"},{"actual":"\"molecule-ha\"","display":"HA מולקולה"},{"actual":"\"molecule-ao\"","display":"AO מולקולה"},{"actual":"\"molecule-no2\"","display":"NO2 מולקולה"},{"actual":"\"molecule-h2o\"","display":"H2O מולקולה"},{"actual":"\"molecule-co2\"","display":"CO2 מולקולה"},{"actual":"\"molecule-nh3\"","display":"NH3 מולקולה"},{"actual":"\"molecule-ch4\"","display":"CH4 מולקולה"},{"actual":"\"molecule-ch3oh\"","display":"CH3OH מולקולה"},{"actual":"\"molecule-n2h4\"","display":"N2H4 מולקולה"},{"actual":"\"molecule-n2o4\"","display":"N2O4 מולקולה"},{"actual":"\"molecule-candle\"","display":"מולקולת שעווה"},{"actual":"\"molecule-alcohol\"","display":"מולקולת אלכוהול"},{"actual":"\"molecule-sugar\"","display":"מולקולת סוכר"}]}]},{"id":4,"action":"כיוון התחלתי","required":false,"placement":"child","format":"add-node \"initial-heading\" (list (list \"heading\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"select","name":"זווית","quoteValues":"never-quote","default":"\"random\"","values":[{"actual":"\"random\"","display":"אקראי"},{"actual":"270","display":"שמאל"},{"actual":"90","display":"ימין"},{"actual":"0","display":"למעלה"},{"actual":"180","display":"למטה"}]}]},{"id":5,"action":"מהירות התחלתית","required":false,"placement":"child","format":"add-node \"initial-speed\" (list (list \"speed\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"range","name":"מהירות","step":1,"random":false,"default":10,"min":1,"max":50}]},{"id":7,"action":"התקדם ללא הפסקה","required":false,"placement":"child","format":"add-node \"move-forever\" []","isTerminal":false,"blockColor":"#bf789f","tags":["action"]},{"id":8,"action":"התקדם מספר צעדים","required":false,"placement":"child","format":"add-node \"move-x-steps\" (list (list \"steps\" {0}))","blockColor":"#bf789f","tags":["action"],"params":[{"id":0,"type":"range","name":"Amount of steps","step":1,"random":false,"default":20,"min":0,"max":100}]},{"id":9,"action":"אם כדור פוגש","required":false,"placement":"child","format":"add-node \"if-ball-meets\" []\nincrease-depth","closeClauses":"decrease-depth","blockColor":"#2176a1","tags":["interaction"],"clauses":[{"children":[],"open":"add-node \"objects\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["object"]}},{"children":[],"action":"אז","open":"add-node \"then\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["effect"]}}]},{"id":10,"action":"קיר","required":false,"placement":"child","format":"add-node \"wall\" []","blockColor":"#339aa6","textColor":"#ffffff","tags":["object"]},{"id":14,"action":"כדור","required":false,"placement":"child","format":"add-node \"ball-from-population\" (list (list \"population\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["object"],"params":[{"id":0,"type":"text","name":"קבוצה","default":"1"}]},{"id":15,"action":"כיוון","required":false,"placement":"child","format":"add-node \"heading\" (list (list \"heading\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["effect"],"params":[{"id":0,"type":"select","name":"כיוון","quoteValues":"never-quote","default":"\"collide\"","values":[{"actual":"\"no change\"","display":"ללא שינוי"},{"actual":"\"collide\"","display":"התנגשות"},{"actual":"\"turn left\"","display":"הסתובב שמאלה"},{"actual":"\"turn right\"","display":"הסתובב ימינה"},{"actual":"\"repel\"","display":"דחייה"},{"actual":"\"attract\"","display":"משיכה"},{"actual":"\"repel and attract\"","display":"דחייה ומשיכה"}]}]},{"id":16,"action":"מהירות","required":false,"placement":"child","format":"add-node \"speed\" (list (list \"speed\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["effect"],"params":[{"id":0,"type":"select","name":"מהירות","quoteValues":"never-quote","default":"\"collide\"","values":[{"actual":"\"no change\"","display":"ללא שינוי"},{"actual":"\"collide\"","display":"התנגשות"},{"actual":"\"zero\"","display":"עצירה"},{"actual":"\"increase\"","display":"האצה"},{"actual":"\"decrease\"","display":"האטה"},{"actual":"\"repel\"","display":"דחייה"},{"actual":"\"attract\"","display":"משיכה"},{"actual":"\"repel and attract\"","display":"דחייה ומשיכה"}]}]},{"id":11,"action":"שדה כבידה","required":false,"placement":"child","format":"add-node \"gravity-field\" []","blockColor":"#339aa6","textColor":"#ffffff","tags":["object"]},{"id":12,"action":"שדה חשמלי","required":false,"placement":"child","format":"add-node \"electric-field\" []","blockColor":"#339aa6","textColor":"#ffffff"},{"id":17,"action":"עוצמת שדה","required":false,"placement":"child","format":"add-node \"field-strength\" (list (list \"strength\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["effect"],"params":[{"id":0,"type":"int","name":"עוצמה","step":1,"default":10}]},{"id":19,"action":"הוסף כדור","required":false,"placement":"child","format":"add-node \"add\" (list (list \"population\" {0}))","blockColor":"#339aa6","tags":["effect"],"params":[{"id":0,"type":"text","name":"קבוצה","default":"1"}]},{"id":20,"action":"הסר כדור","required":false,"placement":"child","format":"add-node \"disappear\" (list (list \"population\" {0}))","blockColor":"#339aa6","tags":["effect"],"params":[{"id":0,"type":"text","name":"קבוצה","default":"1"}]},{"id":21,"action":"סיכוי","required":false,"placement":"child","format":"add-node \"chance\" (list (list \"probability\" {0}))\nincrease-depth","closeClauses":"decrease-depth","blockColor":"#339aa6","tags":["effect"],"clauses":[{"children":[],"open":"if true [","close":"]","allowedTags":{"type":"inherit"}}],"params":[{"id":0,"type":"range","name":"אחוזי הצלחה","step":1,"random":false,"default":50,"min":0,"max":100}]},{"id":22,"action":"חזרה על הפעולות","required":false,"placement":"child","format":"add-node \"repeat\" (list (list \"amount\" {0}))\nincrease-depth","closeClauses":"decrease-depth","blockColor":"#339aa6","tags":["effect"],"clauses":[{"children":[],"open":"if true [","close":"]","allowedTags":{"type":"inherit"}}],"params":[{"id":0,"type":"int","name":"מספר פעמים","step":1,"default":1}]}],"program":{"chains":[{"x":13.3333740234375,"y":15.555572509765625,"blocks":[{"id":0,"action":"","required":true,"placement":"starter","instanceId":26,"format":"to configure-population-1\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 1))","isTerminal":true,"closeClauses":"table:put curr-ast-by-population 1 ast-root","blockColor":"#078c03","clauses":[{"children":[],"action":"תכונות","open":"add-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" {0}))","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["property"]}},{"children":[],"action":"פעולות","open":"add-node \"actions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["action"]}},{"children":[],"action":"יחסי גומלין","open":"add-node \"interactions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["interaction"]}}],"params":[{"id":0,"type":"text","name":"שם קבוצה"}]}]}]},"blockStyles":{"starterBlockStyle":{"blockColor":"#bb5555","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""},"containerBlockStyle":{"blockColor":"#8899aa","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""},"commandBlockStyle":{"blockColor":"#9977aa","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""}},"expressions":[{"name":"true","type":"bool"},{"name":"false","type":"bool"},{"name":"AND","type":"bool","arguments":["bool","bool"],"format":"({0} and {1})"},{"name":"OR","type":"bool","arguments":["bool","bool"],"format":"({0} or {1})"},{"name":"NOT","type":"bool","arguments":["bool"],"format":"(not {0})"},{"name":">","type":"bool","arguments":["num","num"]},{"name":">=","type":"bool","arguments":["num","num"]},{"name":"<","type":"bool","arguments":["num","num"]},{"name":"<=","type":"bool","arguments":["num","num"]},{"name":"!=","type":"bool","arguments":["num","num"]},{"name":"=","type":"bool","arguments":["num","num"]},{"name":"+","type":"num","arguments":["num","num"]},{"name":"-","type":"num","arguments":["num","num"]},{"name":"×","type":"num","arguments":["num","num"],"format":"({0} * {1})"},{"name":"/","type":"num","arguments":["num","num"]},{"name":"random","type":"num","arguments":["num"],"format":"random-float {0}"}]},"netLogoCode":"to configure-population-1\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 1))\nadd-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" (nt:get \"__ntb-defs-0-canvas_0_26_0\")))\n] decrease-depth\nadd-node \"actions\" []\nincrease-depth if true [\n] decrease-depth\nadd-node \"interactions\" []\nincrease-depth if true [\n] decrease-depth\ntable:put curr-ast-by-population 1 ast-root\nend","netLogoDisplay":"to configure-population-1\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 1))\nadd-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" (nt:get \"__ntb-defs-0-canvas_0_26_0\")))\n] decrease-depth\nadd-node \"actions\" []\nincrease-depth if true [\n] decrease-depth\nadd-node \"interactions\" []\nincrease-depth if true [\n] decrease-depth\ntable:put curr-ast-by-population 1 ast-root\nend"},{"id":1,"spaceId":"ntb-defs-1","name":"קבוצה 2","width":450,"height":1200,"defs":{"version":5,"height":1200,"width":450,"blocks":[{"id":0,"action":"","required":true,"placement":"starter","format":"to configure-population-2\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 2))","isTerminal":true,"closeClauses":"table:put curr-ast-by-population 2 ast-root","limit":1,"blockColor":"#078c03","clauses":[{"children":[],"action":"תכונות","open":"add-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" {0}))","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["property"]}},{"children":[],"action":"פעולות","open":"add-node \"actions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["action"]}},{"children":[],"action":"יחסי גומלין","open":"add-node \"interactions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["interaction"]}}],"params":[{"id":0,"type":"text","name":"שם קבוצה"}]},{"id":1,"action":"צבע","required":false,"placement":"child","format":"add-node \"color\" (list (list \"color\" {0}))","isTerminal":false,"blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"select","name":"צבע","quoteValues":"never-quote","default":"15","values":[{"actual":"15","display":"אדום"},{"actual":"25","display":"כתום"},{"actual":"35","display":"חום"},{"actual":"45","display":"צהוב"},{"actual":"55","display":"ירוק"},{"actual":"65","display":"ירוק בהיר"},{"actual":"75","display":"טורקיז"},{"actual":"85","display":"ציאן"},{"actual":"95","display":"כחול בהיר"},{"actual":"105","display":"כחול"},{"actual":"115","display":"סגול"},{"actual":"125","display":"מגנטה"},{"actual":"135","display":"ורוד"},{"actual":"9.9","display":"לבן"},{"actual":"5","display":"אפור"}]}]},{"id":2,"action":"גודל","required":false,"placement":"child","format":"add-node \"size\" (list (list \"size\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"range","name":"גודל","step":0.1,"random":false,"default":0.5,"min":0.1,"max":3}]},{"id":3,"action":"צורה","required":false,"placement":"child","format":"add-node \"shape\" (list (list \"shape\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"select","name":"צורה","quoteValues":"never-quote","default":"\"circle\"","values":[{"actual":"\"circle\"","display":"עיגול"},{"actual":"\"square\"","display":"ריבוע"},{"actual":"\"arrow\"","display":"חץ"},{"actual":"\"molecule-a2\"","display":"A2 מולקולה"},{"actual":"\"molecule-ha\"","display":"HA מולקולה"},{"actual":"\"molecule-ao\"","display":"AO מולקולה"},{"actual":"\"molecule-no2\"","display":"NO2 מולקולה"},{"actual":"\"molecule-h2o\"","display":"H2O מולקולה"},{"actual":"\"molecule-co2\"","display":"CO2 מולקולה"},{"actual":"\"molecule-nh3\"","display":"NH3 מולקולה"},{"actual":"\"molecule-ch4\"","display":"CH4 מולקולה"},{"actual":"\"molecule-candle\"","display":"מולקולת שעווה"},{"actual":"\"molecule-alcohol\"","display":"מולקולת אלכוהול"},{"actual":"\"molecule-sugar\"","display":"מולקולת סוכר"}],"def":"\"circle\""}]},{"id":4,"action":"כיוון התחלתי","required":false,"placement":"child","format":"add-node \"initial-heading\" (list (list \"heading\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"select","name":"זווית","quoteValues":"never-quote","default":"\"random\"","values":[{"actual":"\"random\"","display":"אקראי"},{"actual":"270","display":"שמאל"},{"actual":"90","display":"ימין"},{"actual":"0","display":"למעלה"},{"actual":"180","display":"למטה"}]}]},{"id":5,"action":"מהירות התחלתית","required":false,"placement":"child","format":"add-node \"initial-speed\" (list (list \"speed\" {0}))","blockColor":"#bf8821","tags":["property"],"params":[{"id":0,"type":"range","name":"מהירות","step":1,"random":false,"default":10,"min":1,"max":50}]},{"id":7,"action":"התקדם ללא הפסקה","required":false,"placement":"child","format":"add-node \"move-forever\" []","isTerminal":false,"blockColor":"#bf789f","tags":["action"]},{"id":8,"action":"התקדם מספר צעדים","required":false,"placement":"child","format":"add-node \"move-x-steps\" (list (list \"steps\" {0}))","blockColor":"#bf789f","tags":["action"],"params":[{"id":0,"type":"range","name":"Amount of steps","step":1,"random":false,"default":20,"min":0,"max":100}]},{"id":9,"action":"אם כדור פוגש","required":false,"placement":"child","format":"add-node \"if-ball-meets\" []\nincrease-depth","closeClauses":"decrease-depth","blockColor":"#2176a1","tags":["interaction"],"clauses":[{"children":[],"open":"add-node \"objects\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["object"]}},{"children":[],"action":"אז","open":"add-node \"then\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["effect"]}}]},{"id":10,"action":"קיר","required":false,"placement":"child","format":"add-node \"wall\" []","blockColor":"#339aa6","textColor":"#ffffff","tags":["object"]},{"id":14,"action":"כדור","required":false,"placement":"child","format":"add-node \"ball-from-population\" (list (list \"population\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["object"],"params":[{"id":0,"type":"text","name":"קבוצה","default":"1"}]},{"id":15,"action":"כיוון","required":false,"placement":"child","format":"add-node \"heading\" (list (list \"heading\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["effect"],"params":[{"id":0,"type":"select","name":"כיוון","quoteValues":"never-quote","default":"\"collide\"","values":[{"actual":"\"no change\"","display":"ללא שינוי"},{"actual":"\"collide\"","display":"התנגשות"},{"actual":"\"turn left\"","display":"הסתובב שמאלה"},{"actual":"\"turn right\"","display":"הסתובב ימינה"},{"actual":"\"repel\"","display":"דחייה"},{"actual":"\"attract\"","display":"משיכה"},{"actual":"\"repel and attract\"","display":"דחייה ומשיכה"}]}]},{"id":16,"action":"מהירות","required":false,"placement":"child","format":"add-node \"speed\" (list (list \"speed\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["effect"],"params":[{"id":0,"type":"select","name":"מהירות","quoteValues":"never-quote","default":"\"collide\"","values":[{"actual":"\"no change\"","display":"ללא שינוי"},{"actual":"\"collide\"","display":"התנגשות"},{"actual":"\"zero\"","display":"עצירה"},{"actual":"\"increase\"","display":"האצה"},{"actual":"\"decrease\"","display":"האטה"},{"actual":"\"repel\"","display":"דחייה"},{"actual":"\"attract\"","display":"משיכה"},{"actual":"\"repel and attract\"","display":"דחייה ומשיכה"}]}]},{"id":11,"action":"שדה כבידה","required":false,"placement":"child","format":"add-node \"gravity-field\" []","blockColor":"#339aa6","textColor":"#ffffff","tags":["object"]},{"id":12,"action":"שדה חשמלי","required":false,"placement":"child","format":"add-node \"electric-field\" []","blockColor":"#339aa6","textColor":"#ffffff"},{"id":17,"action":"עוצמת שדה","required":false,"placement":"child","format":"add-node \"field-strength\" (list (list \"strength\" {0}))","blockColor":"#339aa6","textColor":"#ffffff","tags":["effect"],"params":[{"id":0,"type":"int","name":"עוצמה","step":1,"default":10}]},{"id":19,"action":"הוסף כדור","required":false,"placement":"child","format":"add-node \"add\" (list (list \"population\" {0}))","blockColor":"#339aa6","tags":["effect"],"params":[{"id":0,"type":"text","name":"קבוצה","default":"1"}]},{"id":20,"action":"הסר כדור","required":false,"placement":"child","format":"add-node \"disappear\" (list (list \"population\" {0}))","blockColor":"#339aa6","tags":["effect"],"params":[{"id":0,"type":"text","name":"קבוצה","default":"1"}]},{"id":21,"action":"סיכוי","required":false,"placement":"child","format":"add-node \"chance\" (list (list \"probability\" {0}))\nincrease-depth","closeClauses":"decrease-depth","blockColor":"#339aa6","tags":["effect"],"clauses":[{"children":[],"open":"if true [","close":"]","allowedTags":{"type":"inherit"}}],"params":[{"id":0,"type":"range","name":"אחוזי הצלחה","step":1,"random":false,"default":50,"min":0,"max":100}]},{"id":22,"action":"חזרה על הפעולות","required":false,"placement":"child","format":"add-node \"repeat\" (list (list \"amount\" {0}))\nincrease-depth","closeClauses":"decrease-depth","blockColor":"#339aa6","tags":["effect"],"clauses":[{"children":[],"open":"if true [","close":"]","allowedTags":{"type":"inherit"}}],"params":[{"id":0,"type":"int","name":"מספר פעמים","step":1,"default":1}]}],"program":{"chains":[{"x":12.5555419921875,"y":14.111114501953125,"blocks":[{"id":0,"action":"","required":true,"placement":"starter","instanceId":0,"format":"to configure-population-2\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 2))","isTerminal":true,"closeClauses":"table:put curr-ast-by-population 2 ast-root","blockColor":"#078c03","clauses":[{"children":[],"action":"תכונות","open":"add-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" {0}))","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["property"]}},{"children":[],"action":"פעולות","open":"add-node \"actions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["action"]}},{"children":[],"action":"יחסי גומלין","open":"add-node \"interactions\" []\nincrease-depth if true [","close":"] decrease-depth","allowedTags":{"type":"any-of","tags":["interaction"]}}],"params":[{"id":0,"type":"text","name":"שם קבוצה"}]}]}]},"blockStyles":{"starterBlockStyle":{"blockColor":"#bb5555","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""},"containerBlockStyle":{"blockColor":"#8899aa","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""},"commandBlockStyle":{"blockColor":"#9977aa","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""}},"expressions":[{"name":"true","type":"bool"},{"name":"false","type":"bool"},{"name":"AND","type":"bool","arguments":["bool","bool"],"format":"({0} and {1})"},{"name":"OR","type":"bool","arguments":["bool","bool"],"format":"({0} or {1})"},{"name":"NOT","type":"bool","arguments":["bool"],"format":"(not {0})"},{"name":">","type":"bool","arguments":["num","num"]},{"name":">=","type":"bool","arguments":["num","num"]},{"name":"<","type":"bool","arguments":["num","num"]},{"name":"<=","type":"bool","arguments":["num","num"]},{"name":"!=","type":"bool","arguments":["num","num"]},{"name":"=","type":"bool","arguments":["num","num"]},{"name":"+","type":"num","arguments":["num","num"]},{"name":"-","type":"num","arguments":["num","num"]},{"name":"×","type":"num","arguments":["num","num"],"format":"({0} * {1})"},{"name":"/","type":"num","arguments":["num","num"]},{"name":"random","type":"num","arguments":["num"],"format":"random-float {0}"}]},"netLogoCode":"to configure-population-2\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 2))\nadd-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" (nt:get \"__ntb-defs-1-canvas_0_0_0\")))\n] decrease-depth\nadd-node \"actions\" []\nincrease-depth if true [\n] decrease-depth\nadd-node \"interactions\" []\nincrease-depth if true [\n] decrease-depth\ntable:put curr-ast-by-population 2 ast-root\nend","netLogoDisplay":"to configure-population-2\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 2))\nadd-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" \"\"))\n] decrease-depth\nadd-node \"actions\" []\nincrease-depth if true [\n] decrease-depth\nadd-node \"interactions\" []\nincrease-depth if true [\n] decrease-depth\ntable:put curr-ast-by-population 2 ast-root\nend"}],"netTangoToggles":{"workspaceBelow":false,"showCode":false},"tabOptions":{"commandCenterTab":true,"codeTab":true,"infoTab":true,"speedBar":false,"fileButtons":true,"authoring":true,"tabsPosition":true,"poweredBy":false},"blockStyles":{"starterBlockStyle":{"blockColor":"#bb5555","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""},"containerBlockStyle":{"blockColor":"#8899aa","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""},"commandBlockStyle":{"blockColor":"#9977aa","textColor":"#ffffff","borderColor":"#ffffff","fontWeight":"","fontSize":"","fontFace":""}},"title":"mmm","extraCss":"","code":"extensions [send-to fetch import-a table]; profiler]\n\nglobals [\n  tick-delta    ; how much the model advances every tick\n  global-variables-record\n  animation-ticks  ; animations advance relative to this tick\n  chosen-background-color\n  verbal\n\n  ;==== balls ====\n  wall-collisions    ; count wall collisions for each population.\n  max-balls    ; possibly omit later, to prevent balls slowing down too much so that it's visible and confuses the students about speed\n  max-speed     ; max allowed speed in system (recursive speed increase may blow up the variable)\n  collision-speed-delta    ;  value to increase or decrease speed after wall and ball collision\n  collision-depth-threshold    ; how deep the intersection of balls can be to be considered collision\n  look-ahead-wall-collision    ; distance to check ahead if near wall\n  population-balls    ; for fast access of balls belonging to certain population\n  -show-ball-label\n  color-ball-by-speed\n\n  ;==== electric field ====\n  electric-field-color\n  patches-brush-drew-electric-field-on\n\n  ;==== nettango ====\n  nettango-block-space-count    ; how many blocks spaces in nettango for configuring populations\n  run-me-if-i-throw-error-then-nettango-has-recompiled    ; used to fix a bug in nettango which throws error if lambdas are ran after netlogo has been recompiled\n\n  ;==== ast ==== abstract syntax tree, nested structure of nettango blocks.\n  blocks\n  curr-ast-by-population    ; used for comparison of prev ast to check for changes\n  prev-ast-by-population    ; used for comparison to check for changes\n  node-runners    ; hashes node name to procedure that runs block\n  node-parsers    ; hashes node name to function that parses node\n\n  ;==== counters ====\n  counters-information-gfx ; breed that references 2 gfx-overlay turtles that display information for counter\n  counter-value ; table that keeps track of ball count in all counters\n\n  ;==== population properties ====\n  population-properties ; list that holds properties for each population. Each index is a different property. Check report procedure \"property-index\"\n  prev-population-properties ; previous values of properties. used for checking if value has changed.\n  default-colors-for-ball-populations\n  population-to-set-properties-for-in-ui ; which population is selected in the ball pallet in ui\n\n  ;==== log =====\n  log-enabled\n  -log ; keeps track of all log history. need this because netlogo web can not append to a file, so need to write whole log every time\n  logged-pictures ; keeps track how many pictures logged so far so the file can be named with picture number in ascending order\n  log-file-name  ; will hold filename\n  log-picture-prefix ; will hold photo file name\n  prev-command-name ; will hold the prev command printedin log file (to avoid double logging)\n  prev-line  ; will hold the last line printedin log file\n\n  ;===== lennard jones ======\n  repulsion-strength\n  attraction-strength\n  LJeps   ; Lennard Jones constants\n  LJsigma ; Lennard Jones constants\n\n  ;======= brush ===========\n  brush-shape                           ; square or circle\n  brush-type                            ; what is brush drawing?\n  brush-size\n  marked-balls\n  center-patch-of-drawn-shape           ; keeps track of patch brush first clicked on when shape was first drawn.\n  patches-affected-by-drawn-shape       ; patches that would be drawn on if user were to draw shape right now\n  gfx-displaying-patches-affected-by-drawn-shape    ; turtles that only serve to display boundaries of shape currently being configured\n  mouse-xy-when-brush-was-pressed-down  ; x,y coordinates when brush was first clicked\n  shape-drawn-by-brush                  ; circle,rectangle,line,square\n  -brush-border-outline                 ; gfx turtle dsetuisplaying which patches will get drawn onby brush\n  -brush-cursor                         ; gfx turtle displaying brush cursor\n  brush-style                           ; is brush drawing free-form or a shape\n  brush-type-icon                       ; icon top right of model displaying what brush is drawing\n  brush-draw-erase-mode-icon            ; icon top right of model displaying if brush is set to draw, erase, or configuring shape\n  brush-icon-size\n  brush-icon-transparency-normalized\n  brush-in-draw-mode                    ; true if brush is drawing, false if erasing\n  mouse-down?-when-brush-was-last-activated\n  mousexy-when-brush-was-last-activated\n  current-mousexy\n  current-mouse-down?\n  current-mouse-inside?\n  patches-drawn-on-since-brush-was-held-down    ; keeps track if you do not want to draw twice on the same patch since brush was pressed down.\n  counter-number-drawn-by-brush                 ; counter number currently being drawn by brush\n  brush-activated-after-model-was-advanced      ; to know if display should be updated because model isnt running which means display isn't updated in \"go\" procedure\n  click-count-when-radio-buttons-were-first-clicked ; used for radio buttons for brush. keeps track of what order brush buttons were clicked so the right button is unpressed\n  brush-radio-buttons-click-count ; increased when one of the brush buttons is clicked, used to keep track of which button was pressed last\n  curr-marker\n  prev-marker\n\n  ;======= AST VARIABLES =========\n  ast-root\n  current-node\n  last-added-node\n  nodes-by-id\n  last-used-nodes-by-id\n  id-counter\n]\n\n; order of breeds determines layering of turtles.\nbreed [counters counter]\nbreed [animations animation]\nbreed [arrows arrow]\nbreed [halos halo]\nbreed [ball-compound-shapes ball-compound-shape]\nbreed [balls ball]\nbreed [gfx-overlay a-gfx-overlay] ; turtles used to diplay gfx\nbreed [brush-border-outlines brush-border-outline] ; gfx for brush outline\nbreed [brush-cursors brush-cursor] ; gfx for brush cursor\n\nundirected-link-breed\n[\n  compound-shapes\n  compound-shape\n]\n\nanimations-own\n[\n  lifespan\n  birthday                   ; tick count animation was created\n  data                       ; data can be anything the animation needs. table variable\n  -name                      ; name of animation\n]\n\nballs-own\n[\n  population-num\n  speed\n  mass\n  energy\n  tick-move-enabled     ; tick count when move was enabled to move if in blocks set to \"Move X Steps\"\n  last-tick-wall-collision-occured    ; keep track last tick wall collision occured to reduce calculation when changing speed if collision occured\n  balls-collided-with\n  force-x-sum                     ; used to efficiently calculate repel and attract forces on ball at end of tick. reset to 0 at start of tick\n  force-y-sum                     ; used to efficiently calculate repel and attract forces on ball at end of tick. reset to 0 at start of tick\n]\n\npatches-own\n[\n  field-x             ; vector  field_x and field_y define the direction and strength of the electric field within the patch\n  field-y             ; vector  field_x and field_y define the direction and strength of the electric field within the patch\n  accum-x             ; accumulates vector  field_x for gobal field computation\n  accum-y             ; accumulates vector  field_y for gobal field computation\n  accum-w             ; accumulates weights  for gobal field computation\n  field-number        ; holds the component number of the field\n  has-wall            ; true if patch has wall\n]\n\ncounters-own\n[\n  number\n]\n\nhalos-own\n[\n  show-speed\n]\n\nto initialize-properties-for-populations [populations]\n  foreach populations [population -> initialize-ball-population-properties population]\nend\n\nto crt-pop\n  let pop-properties table:make\n  table:put pop-properties 1 table:from-list\n    [\n      [\"size\" 1]\n      [\"wall-heading\" \"collide\"]\n      [\"wall-speed\" \"collide\"]\n      [\"ball-heading\" \"collide\"]\n      [\"ball-speed\" \"collide\"]\n      [\"other-ball-heading\" \"collide\"]\n      [\"other-ball-speed\" \"collide\"]\n      [\"gravity\" 0]\n      [\"electric-field\" 40]\n      [\"move\" true]\n      [\"color\" red]\n      [\"name\" \"group-name\"]\n    ]\n  table:put pop-properties 2 table:from-list\n    [\n      [\"size\" 1]\n      [\"wall-heading\" \"collide\"]\n      [\"wall-speed\" \"collide\"]\n      [\"ball-heading\" \"collide\"]\n      [\"ball-speed\" \"collide\"]\n      [\"other-ball-heading\" \"collide\"]\n      [\"other-ball-speed\" \"collide\"]\n      [\"gravity\" 0]\n      [\"electric-field\" 0]\n      [\"move\" true]\n      [\"color\" blue]\n    ]\n  table:put pop-properties 3 table:from-list\n    [\n      [\"size\" 1]\n      [\"wall-heading\" \"collide\"]\n      [\"wall-speed\" \"collide\"]\n      [\"ball-heading\" \"collide\"]\n      [\"ball-speed\" \"collide\"]\n      [\"other-ball-heading\" \"collide\"]\n      [\"other-ball-speed\" \"collide\"]\n      [\"gravity\" 0]\n      [\"electric-field\" 0]\n      [\"move\" true]\n      [\"color\" green]\n    ]\n  foreach table:keys pop-properties [population ->\n   initialize-properties-for-populations (list population)\n   let properties table:get pop-properties population\n   foreach table:keys properties [property ->\n      let value table:get properties property\n      set-prop population property value\n   ]\n  ]\nend\n\nto throw-error-if-population-block-space-does-not-exist-in-nettango [population]\n  run (word \"let x [ -> configure-population-\" population \" ]\")\nend\n\nto-report count-population-block-spaces-in-nettango\n  let block-space-number 1\n  carefully [\n    loop [\n      throw-error-if-population-block-space-does-not-exist-in-nettango block-space-number\n      set block-space-number block-space-number + 1\n    ]\n  ] []\n  report (block-space-number - 1)\nend\n\nto-report block-spaces-in-nettango-already-counted?\n  report nettango-block-space-count > 0\nend\n\nto-report amount-of-population-block-spaces-in-nettango\n  report ifelse-value block-spaces-in-nettango-already-counted? [nettango-block-space-count] [count-population-block-spaces-in-nettango]\nend\n\nto initialize-world\n  initialize-global-values\n  initialize-patches\nend\n\nto initialize-patches\n  ask patches [\n    initialize-patch\n  ]\nend\n\nto initialize-patch\n  set has-wall false\n  set field-x 0\n  set field-y 0\n  set accum-x 0\n  set accum-y 0\n  set accum-w 0\n  set field-number 0\nend\n\nto initialize-global-values\n  set verbal true\n\n  set chosen-background-color צבע-רקע\n  set marked-balls no-turtles\n  set curr-marker סמן\n  set log-enabled false\n  set -show-ball-label false\n  set color-ball-by-speed false\n  set population-properties table:make\n  set prev-population-properties population-properties\n  set population-to-set-properties-for-in-ui \"-\"\n  set default-colors-for-ball-populations [red blue lime orange violet yellow cyan pink brown green sky magenta turquoise gray ]\n  set counters-information-gfx table:make\n  set counter-value table:make\n  set patches-brush-drew-electric-field-on []\n  set brush-activated-after-model-was-advanced false\n  set click-count-when-radio-buttons-were-first-clicked table:make\n  set brush-radio-buttons-click-count 0\n  set -log \"\"\n  set logged-pictures 0\n  set wall-collisions table:make\n  set population-balls table:make\n  set max-balls 2000\n  set collision-speed-delta 0.5;\n  set max-speed 20\n  set look-ahead-wall-collision 0.6\n  set electric-field-color 87\n  set repulsion-strength 100\n  set attraction-strength 30\n  set collision-depth-threshold 0.99\n  set tick-delta 1 / 50   ; MAXIMUM possible value of ball speed. Change this if changed SLIDER in interface\n  setup-logging  \"LOGGING/logFile\"  ; sets the log file name log-filename\n  set prev-command-name \"None\"\n  set prev-line \"None\"\n  set LJeps 0.5  ; Lennard Jones constants\n  set run-me-if-i-throw-error-then-nettango-has-recompiled [[] ->]\n  set global-variables-record global-variable-values\n  initialize-ast\nend\n\nto initialize-all-anonymous-procedures\n  set run-me-if-i-throw-error-then-nettango-has-recompiled [[] ->]\n  initialize-procedures-to-run-ast-node-lookup-table\n  initialize-ast-parse-lookup-table\nend\n\nto initialize-all-lookup-tables-if-nettango-has-recompiled\n  ; temporary fix to solve a nettango bug, after nettango is recompiled\n  ; then error \"Importing and then running lambdas is not supported!\" is thrown.\n  ; It happens if an anonymous procedure that was stored in a variable before nettango\n  ; was recompiled is ran, so all anonymous procedures need to be initialized.\n  ; Update: this is a known issue - https://github.com/NetLogo/NetLogo/issues/22\n  carefully [\n    run run-me-if-i-throw-error-then-nettango-has-recompiled ]\n  [\n    initialize-all-anonymous-procedures\n  ]\nend\n\nto-report global-variable-values\n  report table:from-list (list\n    ;(list \"show-name\" show-name)\n    ;(list \"color-speed\" color-speed)\n  )\nend\n\nto update-ball-shape-by-default\n  ; if ball was formerly a compound shape then need to remove them\n  kill-existing-compound-shapes\n  set shape prop \"shape\"\nend\n\nto-report population-colors [population]\n  report (sentence pprop population \"color\" pprop population \"secondary-colors\")\nend\n\nto update-compound-shape [base-name part-names view-order]\n  set shape \"empty\"\n  kill-existing-compound-shapes\n  create-compound-shapes base-name part-names view-order\nend\n\nto kill-existing-compound-shapes\n  ask compound-shape-neighbors [die]\n  ask my-compound-shapes [die]\nend\n\nto-report add-default-colors-if-not-defined [colors -length]\n  let amount-of-colors-missing -length - length colors\n  report (sentence colors n-values amount-of-colors-missing [gray])\nend\n\nto create-compound-shapes [base-name part-names view-order]\n  let amount-of-compound-shapes length part-names\n  let colors ball-colors\n  if length colors < length part-names [set colors add-default-colors-if-not-defined colors length part-names]\n  foreach range amount-of-compound-shapes [index ->\n    create-compound-shape base-name (item index view-order) (item (position (item index view-order) part-names) colors)\n  ]\nend\n\nto create-compound-shape [base-name part-name -color]\n  let shape-name (word base-name \"-\" part-name)\n  hatch-ball-compound-shapes 1 [\n    set shape shape-name\n    set size [size] of myself\n    set color -color\n    set label \"\"\n    set label-color white\n    pen-up\n    create-compound-shape-with myself [\n      tie\n    ]\n  ]\nend\n\nto-report ball-colors\n  report population-colors population-num\nend\n\nto initialize-ast\n  set ast-root table:make\n  set current-node false\n  set last-added-node false\n  set nodes-by-id []\n  set last-used-nodes-by-id []\n  set id-counter 0\n  set blocks table:make\n  set curr-ast-by-population table:make\n  set prev-ast-by-population (word curr-ast-by-population)\n  initialize-procedures-to-run-ast-node-lookup-table\n  initialize-ast-parse-lookup-table\nend\n\nto initialize-procedures-to-run-ast-node-lookup-table\n  set node-runners table:from-list (list\n    ;(list \"\" [[node population objects] -> func node population objects])\n    (list \"properties\" [[node population objects] -> run-properties-clause node population])\n    (list \"actions\" [[node population objects] -> run-actions-clause node population])\n    (list \"interactions\" [[node population objects] -> run-interactions-clause node population])\n\n    (list \"color\" [[node population objects] -> run-color-block node population])\n    (list \"size\" [[node population objects] -> run-property-block node population])\n    (list \"shape\" [[node population objects] -> run-property-block node population])\n    (list \"initial-heading\" [[node population objects] -> run-property-block node population])\n    (list \"initial-speed\" [[node population objects] -> run-property-block node population])\n    (list \"name\" [[node population objects] -> run-property-block node population])\n\n    (list \"move-forever\" [[node population objects] -> run-move-forever-block node population])\n    (list \"move-x-steps\" [[node population objects] -> run-move-x-steps-block node population])\n\n    (list \"if-ball-meets\" [[node population objects] -> run-if-ball-meets-block node population])\n    (list \"objects\" [[node population objects] -> run-if-ball-meets-block-objects-clause node population])\n    (list \"then\" [[node population objects] -> run-if-ball-meets-block-then-clause node population objects])\n\n    (list \"wall\" [[node population objects] -> run-wall-block node population])\n    (list \"gravity-field\" [[node population objects] -> run-gravity-field-block node population])\n    (list \"electric-field\" [[node population objects] -> run-electric-field-block node population])\n    (list \"ball-same-population\" [[node population objects] -> run-ball-same-population-block node population])\n    (list \"ball-from-population\" [[node population objects] -> run-ball-other-population-block node population])\n\n    (list \"heading\" [[node population objects] -> run-heading-block node population objects])\n    (list \"speed\" [[node population objects] -> run-speed-block node population objects])\n    (list \"field-strength\" [[node population objects] -> run-field-strength-block node population objects])\n    (list \"create-ball\" [[node population objects] -> run-create-balls-block node population])\n    (list \"add\" [[node population objects] -> run-add-block node population])\n    (list \"disappear\" [[node population objects] -> run-disappear-block node population objects])\n    (list \"kill-balls-that-meet\" [[node population objects] -> run-kill-balls-that-meet-block node population objects])\n    (list \"chance\" [[node population objects] -> run-chance-block node population objects])\n    (list \"if-collide\" [[node population objects] -> run-if-collide-block node population objects])\n    (list \"if-in-radius\" [[node population objects] -> run-if-in-radius-block node population objects])\n    (list \"repeat\" [[node population objects] -> run-repeat-block node population objects])\n    (list \"mark\" [[node population objects] -> run-mark-block node population objects])\n    (list \"draw\" [[node population objects] -> run-draw-block node population objects])\n    (list \"animate\" [[node population objects] -> run-animate-block node population objects])\n    (list \"at-least-x-ticks\" [[node population objects] -> run-at-least-x-ticks-block node population objects])\n  )\nend\n\nto initialize-ast-parse-lookup-table\n  set node-parsers table:from-list (list\n    (list \"properties\" [[node population objects] -> parse-properties-clause node population])\n    (list \"actions\" [[node population objects] -> parse-actions-clause node population])\n    (list \"interactions\" [[node population objects] -> parse-interactions-clause node population])\n\n    (list \"color\" [[node population objects] -> parse-color-block node population])\n    (list \"size\" [[node population objects] -> parse-property-block node population])\n    (list \"shape\" [[node population objects] -> parse-property-block node population])\n    (list \"initial-heading\" [[node population objects] -> parse-property-block node population])\n    (list \"initial-speed\" [[node population objects] -> parse-property-block node population])\n    (list \"name\" [[node population objects] -> parse-property-block node population])\n\n    (list \"move-forever\" [[node population objects] -> parse-move-forever-block node population])\n    (list \"move-x-steps\" [[node population objects] -> parse-move-x-steps-block node population])\n\n    (list \"if-ball-meets\" [[node population objects] -> parse-if-ball-meets-block node population])\n    (list \"objects\" [[node population objects] -> parse-if-ball-meets-block-objects-clause node population])\n    (list \"then\" [[node population objects] -> parse-if-ball-meets-block-then-clause node population objects])\n\n    (list \"wall\" [[node population objects] -> parse-wall-block node population])\n    (list \"gravity-field\" [[node population objects] -> parse-gravity-field-block node population])\n    (list \"electric-field\" [[node population objects] -> parse-electric-field-block node population])\n    (list \"ball-same-population\" [[node population objects] -> parse-ball-same-population-block node population])\n    (list \"ball-from-population\" [[node population objects] -> parse-ball-other-population-block node population])\n\n    (list \"heading\" [[node population objects] -> parse-heading-block node population objects])\n    (list \"speed\" [[node population objects] -> parse-speed-block node population objects])\n    (list \"field-strength\" [[node population objects] -> parse-field-strength-block node population objects])\n    (list \"create-ball\" [[node population objects] -> parse-create-balls-block node population])\n    (list \"add\" [[node population objects] -> parse-add-block node population])\n    (list \"disappear\" [[node population objects] -> parse-disappear-block node population objects])\n    (list \"kill-balls-that-meet\" [[node population objects] -> parse-kill-balls-that-meet-block node population objects])\n    (list \"chance\" [[node population objects] -> parse-chance-block node population objects])\n    (list \"if-collide\" [[node population objects] -> parse-if-collide-block node population objects])\n    (list \"if-in-radius\" [[node population objects] -> parse-if-in-radius-block node population objects])\n    (list \"repeat\" [[node population objects] -> parse-repeat-block node population objects])\n    (list \"mark\" [[node population objects] -> parse-mark-block node population objects])\n    (list \"draw\" [[node population objects] -> parse-draw-block node population objects])\n    (list \"animate\" [[node population objects] -> parse-animate-block node population objects])\n    (list \"at-least-x-ticks\" [[node population objects] -> parse-at-least-x-ticks-block node population objects])\n  )\nend\n\n;to update-all-plots\n  ;update-ball-population-plot\n  ;update-ball-collisions-plot\n;end\n\n;to update-ball-population-plot\n;  set-current-plot \"Ball Population\"\n;  foreach population-numbers [population -> update-ball-population-in-plot population]\n;end\n\n;to update-ball-population-in-plot [population]\n;  set-ball-population-plot-pen population\n;  plotxy ticks ball-count-in-population population\n;end\n\n;to set-ball-population-plot-pen [population]\n;  let pen (word population)\n;  ifelse plot-pen-exists? pen [\n;    set-current-plot-pen pen ]\n;  [\n;    create-temporary-plot-pen pen\n;    set-plot-pen-color pprop population \"color\"\n;  ]\n;end\n\n;to update-ball-collisions-plot\n\n;end\n\nto iterate-through-population-number-in-ui-by-ascending-circular-order\n  let -population-numbers population-numbers\n  ifelse is-a-population-selected-in-ui [\n    let index-of-current-populaiton-in-ui position population-to-set-properties-for-in-ui -population-numbers\n    set population-to-set-properties-for-in-ui\n          item ((index-of-current-populaiton-in-ui + 1) mod (length -population-numbers)) -population-numbers ]\n  [\n    set population-to-set-properties-for-in-ui min -population-numbers\n  ]\nend\n\nto-report population-numbers\n  report table:keys population-properties\nend\n\nto-report any-population-exists\n  report length population-numbers > 0\nend\n\nto select-next-population-in-properties-ui\n  if any-population-exists [\n    iterate-through-population-number-in-ui-by-ascending-circular-order\n  ]\nend\n\nto-report highest-population-number\n  report max population-numbers\nend\n\nto-report unused-population-number-higher-than-existing-population-numbers\n  ifelse any-population-exists [\n    report highest-population-number + 1]\n  [\n    report 1\n  ]\nend\n\nto set-new-population-to-set-properties-for-in-ui\n  set population-to-set-properties-for-in-ui unused-population-number-higher-than-existing-population-numbers\nend\n\nto-report default-color-for-population [population-number]\n  let -population-colors map [population -> pprop population \"color\"] population-numbers\n  let default-colors-not-used-by-any-population filter [default-color -> not member? default-color -population-colors] default-colors-for-ball-populations\n  ifelse not empty? default-colors-not-used-by-any-population [\n    report first default-colors-not-used-by-any-population ]\n  [\n    report item (population-number mod length default-colors-not-used-by-any-population) default-colors-not-used-by-any-population\n  ]\nend\n\nto-report is-a-population-selected-in-ui\n  report is-number? population-to-set-properties-for-in-ui\nend\n\nto-report any-record-of-radio-button-requesting-to-be-clicked? [button]\n  report not table:has-key? click-count-when-radio-buttons-were-first-clicked button\nend\n\nto-report is-first-time-radio-button-is-activated [button]\n  report any-record-of-radio-button-requesting-to-be-clicked? button\nend\n\nto increase-radio-button-press-count\n  set brush-radio-buttons-click-count brush-radio-buttons-click-count + 1\nend\n\nto record-radio-button-clicked [button]\n  increase-radio-button-press-count\n  table:put click-count-when-radio-buttons-were-first-clicked button brush-radio-buttons-click-count\nend\n\nto remove-record-of-buttons-clicked-previous-to [button]\n  let first-time-button-was-pressed table:get click-count-when-radio-buttons-were-first-clicked button\n  foreach (filter [key -> (key != button) and (table:get click-count-when-radio-buttons-were-first-clicked key < first-time-button-was-pressed)] table:keys click-count-when-radio-buttons-were-first-clicked )\n    [key -> table:remove click-count-when-radio-buttons-were-first-clicked key]\nend\n\nto update-record-of-when-brush-radio-button-was-first-clicked [button]\n  ifelse any-record-of-radio-button-requesting-to-be-clicked? button [\n    record-radio-button-clicked button]\n  [\n    remove-record-of-buttons-clicked-previous-to button\n  ]\nend\n\nto-report is-first-time-radio-button-is-pressed-down [button]\n  ;report not table-has-key? time-when-brush-buttons-were-first-clicked button\n  report not table:has-key? click-count-when-radio-buttons-were-first-clicked button\nend\n\nto-report should-release-brush-radio-button? [button]\n  ;should be called from a procedure ran by a brush button in the interface, only once per button name\n  unselect-brush-radio-button-if-another-button-was-clicked-more-recently button\n  report not table:has-key? click-count-when-radio-buttons-were-first-clicked button\nend\n\nto unselect-brush-radio-button-if-another-button-was-clicked-more-recently [button]\n  update-record-of-when-brush-radio-button-was-first-clicked button\n  if another-brush-radio-button-was-clicked-more-recently button [\n    deselect-brush-radio-button button ]\nend\n\nto-report another-brush-radio-button-was-clicked-more-recently [button]\n  let first-time-button-was-pressed table:get click-count-when-radio-buttons-were-first-clicked button\n  let buttons-pressed-more-recently filter [key -> (key != button) and (table:get click-count-when-radio-buttons-were-first-clicked key > first-time-button-was-pressed)]\n    (table:keys click-count-when-radio-buttons-were-first-clicked)\n  report not empty? buttons-pressed-more-recently\nend\n\nto deselect-brush-radio-button [button]\n  table:remove click-count-when-radio-buttons-were-first-clicked button\nend\n\nto-report population-properties-initialized? [population]\n  report table:has-key? population-properties population\nend\n\nto initialize-properties-for-all-populations\n  foreach population-numbers [population ->\n     table:put population-properties population initialized-population-properties\n  ]\nend\n\nto-report population-count\n  report length table:keys population-properties\nend\n\nto initialize-ball-population-properties-old [population]\n  let population-color default-color-for-population population\n  table:put population-properties population initialized-population-properties\n  set-prop population \"color\" population-color\nend\n\nto initialize-ball-population-properties [population]\n  table:put population-properties population initialized-population-properties\nend\n\nto-report initialized-population-properties\n  report table:from-list [\n    [\"size\" 0.5]\n    [\"shape\" \"circle\"]\n    [\"heading\" \"random\"]\n    [\"speed\" 10]\n    [\"color\" gray]\n    [\"name\" \"\"]\n    [\"secondary-colors\" []]\n    [\"move\" false]\n    [\"wall-heading\" \"no change\"]\n    [\"wall-speed\" \"no change\"]\n    [\"ball-heading\" \"no change\"]\n    [\"ball-speed\" \"no change\"]\n    [\"other-ball-heading\" \"no change\"]\n    [\"other-ball-speed\" \"no change\"]\n    [\"gravity\" 0]\n    [\"electric-field\" 0]\n  ]\nend\n\nto-report amount-of-balls-that-can-be-created-given-maximum-capacity [requested-amount]\n  let maximum-amount-of-balls-that-can-currently-be-created (max-balls - count balls)\n  report min (list requested-amount maximum-amount-of-balls-that-can-currently-be-created)\nend\n\nto notify-user-unable-to-create-balls-due-to-maximum-capacity\n  user-message (word \"Unable to create more balls, maximum capacity of \" max-balls \" reached.\")\nend\n\nto create-balls-if-under-maximum-capacity [population amount -xcor -ycor]\n  let amount-of-balls-to-create amount-of-balls-that-can-be-created-given-maximum-capacity amount\n  let unable-to-create-balls-due-to-maximum-capacity ifelse-value (amount-of-balls-to-create = 0) and (amount > 0) [true] [false]\n  ifelse unable-to-create-balls-due-to-maximum-capacity [\n    notify-user-unable-to-create-balls-due-to-maximum-capacity]\n  [\n    create-balls-at population amount-of-balls-to-create -xcor -ycor\n  ]\nend\n\nto update-ball-shape\n  let shape-name prop \"shape\"\n  (ifelse\n    shape-name = \"molecule-ha\" [update-compound-shape \"molecule-ha\" [\"h\" \"a\"] [\"h\" \"a\"]]\n    shape-name = \"molecule-ao\" [update-compound-shape \"molecule-ao\" [\"a\" \"o\"] [\"a\" \"o\"]]\n    shape-name = \"molecule-no2\" [update-compound-shape \"molecule-no2\" [\"n\" \"o2\"] [\"o2\" \"n\"]]\n    shape-name = \"molecule-h2o\" [update-compound-shape \"molecule-h2o\" [\"h2\" \"o\"] [\"o\" \"h2\"]]\n    shape-name = \"molecule-co2\" [update-compound-shape \"molecule-co2\" [\"c\" \"o2\"] [\"o2\" \"c\"]]\n    shape-name = \"molecule-nh3\" [update-compound-shape \"molecule-nh3\" [\"n\" \"h3\"] [\"n\" \"h3\"]]\n    shape-name = \"molecule-ch4\" [update-compound-shape \"molecule-ch4\" [\"c\" \"h4\"] [\"c\" \"h4\"]]\n    shape-name = \"molecule-ch3oh\" [update-compound-shape \"molecule-ch3oh\" [\"c\" \"h4\" \"o\"] [\"h4\" \"o\" \"c\"]]\n    shape-name = \"molecule-n2h4\" [update-compound-shape \"molecule-n2h4\" [\"n2\" \"h4\"] [\"h4\" \"n2\"]]\n    shape-name = \"molecule-n2o4\" [update-compound-shape \"molecule-n2o4\" [\"n2\" \"o4\"] [\"o4\" \"n2\"]]\n    shape-name = \"molecule-candle\" [update-compound-shape \"molecule-candle\" [\"c\" \"h\"] [\"c\" \"h\"]]\n    shape-name = \"molecule-alcohol\" [update-compound-shape \"molecule-alcohol\" [\"c2\" \"h5\" \"oh\"] [\"c2\" \"oh\" \"h5\"]]\n    [update-ball-shape-by-default]\n  )\nend\n\nto reset-sum-of-forces-acting-on-balls\n  set force-x-sum 0\n  set force-y-sum 0\nend\n\nto update-balls-by-population [-ball]\n  let population [population-num] of -ball\n  table:put population-balls population (turtle-set balls-of population -ball)\nend\n\nto initialize-ball-after-creation [population -xcor -ycor]\n  set population-num population\n  set color prop \"color\"\n  set size prop \"size\"\n  update-ball-shape\n  set tick-move-enabled ticks\n  set speed prop \"speed\"\n  set mass prop \"size\"\n  setxy -xcor -ycor\n  pen-up\n  update-ball-label\n  initialize-ball-heading\n  reset-sum-of-forces-acting-on-balls\n  update-balls-by-population self\n  reset-balls-collided-with\nend\n\nto update-ball-label\n  ifelse -show-ball-label [show-ball-label] [hide-ball-label]\nend\n\nto hatch-balls-at [population amount -xcor -ycor]\n  hatch-balls amount [\n    initialize-ball-after-creation population -xcor -ycor\n  ]\n  on-ball-created\nend\n\nto create-balls-at [population amount -xcor -ycor]\n  create-balls amount [\n    initialize-ball-after-creation population -xcor -ycor\n    ifelse amount > 1 [ randomly-move-ball-inside-radius 3 ] [randomly-move-ball-inside-radius 0.1]\n  ]\n  on-ball-created\nend\n\nto randomly-move-ball-inside-radius [radius]\n  setxy (xcor + (random-float (radius * 2)) - radius) (ycor + (random-float (radius * 2)) - radius)\nend\n\nto on-ball-created\n  ;update-ball-population-plot\n  log-command \"place-balls\"\nend\n\n; ball procedure\nto initialize-ball-heading\n  ifelse prop \"heading\" = \"random\" [\n    set heading random-float 360 ]\n  [\n    set heading prop \"heading\"\n  ]\nend\n\nto-report population-repels-or-attracts-other-populations? [population]\n  let interaction pprop population \"other-ball-heading\"\n  report member? interaction [\"repel\" \"attract\" \"repel and attract\"]\nend\n\n;========== getters and setters for ball properties ========\n\nto-report pprop [population property]\n  report table:get (properties-of population) property\nend\n\nto-report prev-pprop [population property]\n  report table:get (prev-properties-of population) property\nend\n\nto-report pprop-changed? [population property]\n  report pprop population property != prev-pprop population property\nend\n\nto-report prop [property] ; ball procedure\n  report pprop population-num property\nend\n\nto-report is-affected-by-gravity ; ball procedure\n  report prop \"gravity\" > 0\nend\n\nto-report properties-of [population]\n  report table:get population-properties population\nend\n\nto-report prev-properties-of [population]\n  report table:get prev-population-properties population\nend\n\nto set-prop [population property value]\n  table:put (properties-of population) property value\nend\n\n;==============================\n\nto-report has-neighbors-with-arrows\n  report any? neighbors with [any? arrows-here]\nend\n\nto draw-arrow-in-direction-of-electric-field\n  if not has-neighbors-with-arrows [\n    ask arrows-here [die]\n    sprout-arrows 1\n    [\n      set shape \"arrow\"\n      set color electric-field-color\n      set size 1.0\n      set heading atan field-x field-y\n     ]\n  ]\nend\n\nto create-electric-field-in-direction-configured-by-brush\n  let current-patch []  ; will hold a patch that is being processed\n\n  let electric-field-count [field-number] of one-of patches-brush-drew-electric-field-on\n  let list-patches patches-brush-drew-electric-field-on\n  ask (patch-set list-patches) [recolor-patch]\n  ask arrows [set color electric-field-color - 4]\n  ; fill patches in connected componnent with field-color\n  while [not empty? list-patches]\n  [ set current-patch first list-patches\n    set list-patches but-first list-patches\n    ask current-patch\n    [\n      ask neighbors4-no-wrap with [(not has-wall) and (not has-field)]\n         [\n            set field-number electric-field-count\n            set list-patches lput self list-patches  ;add to list-patches  ; Another way set frontier2 (patch-set frontier2 patch-here)\n            recolor-patch\n         ] ; end ask neighbors\n    ] ; end ask current-patch\n  ] ; end field while\n\n  ; now spread the field vectors in all the painted field cells WITHIN connected comp ONLY\n  let list-field-patches []\n  let marked-patch []  ;first list-field-marked-patches\n  let dist 0\n\n  let list-field-marked-patches  patch-set patches-brush-drew-electric-field-on ; list of patches that were marked as field by user\n  ask  list-field-marked-patches\n  [   set marked-patch self\n      set list-field-patches  patches with [ field-number = electric-field-count] ; all patches that were colored within same connected comp\n      ask list-field-patches\n      [\n        set dist sqrt ((pxcor - [pxcor] of  marked-patch) ^ 2 + (pycor - [pycor] of  marked-patch) ^ 2 )\n;        if dist < max-field-spread  ; spread the field only within a radius\n        if (dist = 0) [ set dist (1 / (max-pxcor * 2))]   ; weight is 1/dist and so dist should not be 0\n        set accum-w accum-w + (1 / dist)\n        set accum-x  accum-x +  ((1 / dist) * [field-x] of marked-patch)\n        set accum-y  accum-y +  ((1 / dist) * [field-y] of marked-patch)\n;       ] ; end if dist < max-field-spread\n    ]\n  ]\n\n  ; now compute the final field values of all field patches\n  ask list-field-patches\n  [  if (accum-w != 0)\n     [   set field-x  (accum-x / accum-w)\n         set field-y  (accum-y / accum-w)\n         set field-x    (field-x / (sqrt ((field-x ^ 2) + (field-y ^ 2))))\n         set field-y    (field-y / (sqrt ((field-x ^ 2) + (field-y ^ 2))))\n      ]\n  ]\n\n  log-command \"fill-field\"\nend\n\n;patch procedure\nto remove-electric-field-from-patch\n  ask arrows-here [die]\n  set field-number 0\n  set field-x  0\n  set field-y  0\n  set accum-x  0\n  set accum-y  0\n  set accum-w  0\nend\n\nto erase-field [-field-number]\n  let patches-occupied-by-field patches with [field-number = -field-number]\n  ask patches-occupied-by-field\n  [\n    remove-electric-field-from-patch\n    recolor-patch\n  ]\nend\n\nto-report has-field\n  report field-number > 0\nend\n\nto recolor-patch\n  (ifelse\n    has-wall [set pcolor wall-color ]\n    has-field [set pcolor electric-field-color ]\n    [set pcolor background-color]\n  )\nend\n\nto-report wall-color\n  report צבע-מברשת\nend\n\nto-report background-color\n  report chosen-background-color\nend\n\nto set-background-color-button-clicked\n  set chosen-background-color צבע-רקע\n  recolor-all-patches\n  log-command \"paint-world\"\n  ask halos [\n    contrast-color-to-background\n  ]\nend\n\nto recolor-all-patches\n  ask patches [recolor-patch]\nend\n\nto-report interaction-clause-of-population [population]\n  report child-by-name table:get blocks population \"interactions\"\nend\n\nto netlogo-web-advance-balls-in-world\n    ask balls [\n      run-interactions-clause (interaction-clause-of-population population-num) population-num\n      factor-forces-acting-on-ball\n      set-ball-speed-to-maximum-if-above-max-speed\n      reset-balls-collided-with\n    ]\n    ask balls [\n      move\n    ]\nend\n\nto factor-forces-acting-on-ball\n  apply-forces-acting-on-ball\n  reset-sum-of-forces-acting-on-balls\nend\n\nto advance-balls-in-world2\n  netlogo-web-advance-balls-in-world\nend\n\nto advance-balls-in-world\n  ifelse netlogo-web? [\n    netlogo-web-advance-balls-in-world ]\n  [\n    ask balls [\n      factor-electric-field ; add change of speed and heading due to electric field\n      factor-repel-and-attract-forces\n      factor-gravity;\n      check-for-wall-collision\n      check-for-ball-collision\n      set-ball-speed-to-maximum-if-above-max-speed\n      reset-balls-collided-with\n    ]\n    ask balls [\n      move\n    ]\n  ]\nend\n\nto reset-balls-collided-with\n  set balls-collided-with no-turtles\nend\n\nto run-animations\n  every 0.05 [\n    if any? animations [\n      ask animations [animate]\n      set animation-ticks animation-ticks + 1\n    ]\n  ]\nend\n\nto animate\n  (ifelse\n    -name = \"flash\" [animate-flash]\n    -name = \"mark\" [remove-animation-if-past-lifespan]\n    -name = \"patch-flash\" [remove-animation-if-past-lifespan]\n    -name = \"rotate\" [rotate-animation]\n    -name = \"inflate\" [increase-animation-size]\n    -name = \"draw\" [remove-animation-if-past-lifespan]\n  )\nend\n\nto-report any-moving-balls?\n  let any-ball-moving false\n  ask balls [if ball-can-move [set any-ball-moving true stop]]\n  report any-ball-moving;\nend\n\nto advance-ticks\n  tick\nend\n\nto log-go-procedure\n  if (test-if-log-output \"play\" = TRUE) [  ; test that prev logging is not exactly the same\n    log-output \"play\"\n    log_picture\n  ]\nend\n\nto re-enable-movement-for-balls-predefined-to-move-limited-number-of-ticks\n  ask balls with [is-number? prop \"move\"] [set tick-move-enabled ticks]\nend\n\n;============= ast parse ====================\n\nto-report map-population-names-to-populaiton-number\n  let mapped-population-names table:make\n  foreach population-numbers [population-number -> table:put mapped-population-names (pprop population-number \"name\") population-number]\n  report mapped-population-names\nend\n\nto-report convert-to-number-if-possible [input]\n  let output input\n  carefully [\n    set output read-from-string input\n  ] []\n  report output\nend\n\nto-report user-population-input-to-population-number [raw-input]\n  let population-input convert-to-number-if-possible raw-input\n  let mapped-population-names map-population-names-to-populaiton-number\n  let population-names table:keys mapped-population-names\n  let input-is-population-number member? population-input population-numbers\n  let input-is-population-name member? population-input population-names\n  (ifelse\n    input-is-population-number [report population-input]\n    input-is-population-name [report table:get mapped-population-names population-input]\n  )\n  report false\nend\n\nto-report is-multiple-objects [objects]\n  report length objects > 1\nend\n\nto apply-heading-change-if-meets-with-ball [other-balls heading-change]\n  (ifelse\n    heading-change = \"no change\" []\n    heading-change = \"collide\" [change-heading-if-collides-with other-balls heading-change]\n    heading-change = \"turn left\" [change-heading-if-collides-with other-balls heading-change]\n    heading-change = \"turn right\" [change-heading-if-collides-with other-balls heading-change]\n    heading-change = \"repel\" [apply-force-on other-balls heading-change]\n    heading-change = \"attract\" [apply-force-on other-balls heading-change]\n    heading-change = \"repel and attract\" [apply-force-on other-balls heading-change]\n  )\nend\n\nto apply-speed-change-if-meets-with-ball [other-balls speed-change]\n  (ifelse\n    speed-change = \"zero\" [change-speed-if-collides-with other-balls speed-change]\n    speed-change = \"increase\" [change-speed-if-collides-with other-balls speed-change]\n    speed-change = \"decrease\" [change-speed-if-collides-with other-balls speed-change]\n  )\nend\n\nto-report random-chance [probability]\n  let normalized-probability probability / 100\n  report random-float 1 < normalized-probability\nend\n\nto-report object-is-balls [object]\n  report is-turtle-set? object\nend\n\nto-report objects-colliding-with [objects]\n  report ifelse-value is-multiple-objects objects [objects-colliding-with-multiple-objects objects] [objects-colliding-with-single-object objects]\nend\n\nto-report objects-colliding-with-multiple-objects [objects]\n  ifelse multiple-objects-already-set objects [\n    report ifelse-value count ((turtle-set objects) with [ball-collides-with myself]) = length objects [objects] [false] ]\n  [\n    let all-balls-in-collision balls-colliding\n    let ball-populations objects\n    let balls-in-collision [] ; a single combination set (of all possible) from balls in radius\n    ask all-balls-in-collision [\n      if member? population-num ball-populations [\n        set ball-populations remove-item (position population-num ball-populations) ball-populations\n        set balls-in-collision lput self balls-in-collision\n        if empty? ball-populations [stop]\n      ]\n    ]\n    report ifelse-value empty? ball-populations [balls-in-collision] [false]\n  ]\nend\n\nto-report objects-colliding-with-single-object [objects]\n  let -objects-colliding balls-colliding-from (first objects)\n  report ifelse-value any? -objects-colliding [(list -objects-colliding)] [false]\nend\n\nto-report objects-in-radius [objects radius]\n  report ifelse-value is-multiple-objects objects [objects-in-radius-multiple-objects objects radius] [objects-in-radius-single-object objects radius]\nend\n\nto-report parse-function-of [node]\n  let a table:get-or-default node-parsers node-name node false\n  if a = false [error (word \"can not find parse function for \" node)]\n  report table:get node-parsers node-name node\nend\n\nto-report run-function-of [node]\n  report table:get node-runners node-name node\nend\n\nto-report parse-result-of-node [node population objects]\n  report (runresult (parse-function-of node) node population objects)\nend\n\nto-report run-result-of-node [node population objects]\n  report (runresult (run-function-of node) node population objects)\nend\n\nto parse-node [node population objects]\n  (run (parse-function-of node) node population objects)\nend\n\nto run-node [node population objects]\n  (run (run-function-of node) node population objects)\nend\n\nto-report parse-result-children [node population objects]\n  report map [child -> parse-result-of-node child population objects] node-children node\nend\n\nto parse-children [node population objects]\n  foreach node-children node [child -> parse-node child population objects]\nend\n\nto-report run-result-children [node population objects]\n  report map [child -> run-result-of-node child population objects] node-children node\nend\n\nto run-children [node population objects]\n  foreach node-children node [child -> run-node child population objects]\nend\n\nto parse-heading-block [node population objects]\n  let parameters node-parameters node\n  let heading-change table:get parameters \"heading\"\n  ifelse not is-multiple-objects objects [\n    let object first objects\n    if not member? object [\"wall\" \"ball-same-population\" \"ball-from-population\"] [\n      let message (word \"Heading can not be set for '\" object \"'\" )\n      throw-ast-error node message\n    ]\n    if member? heading-change [\"repel\" \"attract\" \"repel and attract\"] and not member? object [\"ball-same-population\" \"ball-from-population\"] [\n      let message (word \"Heading '\" heading-change \"' can not be set for '\" object \"'\" )\n      throw-ast-error node message\n    ]\n  ]\n  [\n    let message (word \"Heading can not be set for multiple objects: \" objects )\n    throw-ast-error node message\n  ]\nend\n\nto run-heading-block [node population objects]\n  let parameters node-parameters node\n  let heading-change table:get parameters \"heading\"\n  let object first objects\n  (ifelse\n    object = \"wall\" [change-heading-if-collides-with-wall heading-change]\n    object-is-balls object [apply-heading-change-if-meets-with-ball object heading-change]\n  )\nend\n\nto parse-speed-block [node population objects]\n  let parameters node-parameters node\n  let speed-change table:get parameters \"speed\"\n  let object first objects\n  ifelse not is-multiple-objects objects [\n    if not member? object [\"wall\" \"ball-same-population\" \"ball-from-population\"] [\n      let message (word \"Speed can not be set for '\" object \"'\" )\n      throw-ast-error node message\n    ]\n    if member? speed-change [\"repel\" \"attract\" \"repel and attract\"] and not member? object [\"ball-same-population\" \"ball-from-population\"] [\n      let message (word \"Speed '\" speed-change \"' can not be set for '\" object \"'\" )\n      throw-ast-error node message\n    ]\n  ]\n  [\n    let message (word \"Speed can not be set for multiple objects: \" objects )\n    throw-ast-error node message\n  ]\nend\n\nto run-speed-block [node population objects]\n  let parameters node-parameters node\n  let speed-change table:get parameters \"speed\"\n  let object first objects\n  (ifelse\n    object = \"wall\" [change-speed-if-collides-with-wall speed-change]\n    object-is-balls object [apply-speed-change-if-meets-with-ball object speed-change ]\n  )\nend\n\nto parse-field-strength-block [node population objects]\n  let object first objects\n  if not member? object [\"gravity-field\" \"electric-field\"] [\n    let message (word \"field strength can not be set for \" object )\n    throw-ast-error node message\n  ]\nend\n\nto run-field-strength-block [node population objects]\n  let parameters node-parameters node\n  let field-strength table:get parameters \"strength\"\n  let object first objects\n  (ifelse\n    object = \"gravity-field\" [apply-gravity (- field-strength)]\n    object = \"electric-field\" [apply-electric-field field-strength]\n  )\nend\n\nto parse-create-balls-block [node population]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let population-of-ball-being-created user-population-input-to-population-number user-defined-population\n  if population-of-ball-being-created = false [\n    let message (word \"Population '\" user-defined-population \"' defined in '\" name \"' block does not exist.\")\n    throw-ast-error node message\n  ]\nend\n\nto run-create-balls-block [node population]\n  let name node-name node\n  let parameters node-parameters node\n  let amount table:get parameters \"amount\"\n  let user-defined-population table:get parameters \"population\"\n  let population-of-ball-being-created user-population-input-to-population-number user-defined-population\n  hatch-balls-at population-of-ball-being-created amount xcor ycor\nend\n\nto-report center-xy [agent-set]\n  report (list mean [xcor] of agent-set mean [ycor] of agent-set)\nend\n\nto extend-mark-lifespan [mark]\n  ask mark [set birthday ticks]\nend\n\nto set-mark-xy [mark x y]\n  ask mark [setxy x y]\nend\n\nto set-mark-size [mark -size]\n  ask mark [set size -size]\nend\n\nto remove-animation-if-past-lifespan\n  if animation-ticks - birthday > lifespan [die]\nend\n\nto rotate-animation\n  ; Need to find a way to chain animatin procedures, such as\n  ; chain-animation (list rotate-animation remove-animation-if-past-lifespan)\n  set heading heading + table:get data \"angle\"\n  remove-animation-if-past-lifespan\nend\n\nto increase-animation-size\n  let increase table:get data \"increase\"\n  set size size * ((100 + increase) / 100)\n  remove-animation-if-past-lifespan\nend\n\nto-report should-flash\n  let flash-rate table:get data \"flash-every-n-ticks\"\n  report animation-ticks mod flash-rate = 0\nend\n\nto toggle-hidden-shown\n  ifelse hidden? [show-turtle] [hide-turtle]\nend\n\nto animate-flash\n  if should-flash [\n    toggle-hidden-shown\n  ]\n  remove-animation-if-past-lifespan\nend\n\nto run-animate-block [node population objects]\n  let parameters node-parameters node\n  let -effect table:get parameters \"effect\"\n  let -shape table:get parameters \"shape\"\n  let -size table:get parameters \"size\"\n  let -color add-transparency table:get parameters \"color\" 0.35\n  let -lifespan table:get parameters \"lifespan\"\n  (ifelse\n    -effect = \"rotate\" [hatch-rotating-animation -shape -size -color -lifespan]\n    -effect = \"flash\" [let -animation hatch-flashing-animation -shape -size -color -lifespan]\n    -effect = \"inflate\" [create-inflating-animation -shape -size -color -lifespan]\n  )\nend\n\nto flash-outline [duration -color]\n  ifelse already-flashing-outline [\n    extend-lifespan-of-flashing-outline ]\n  [\n    hatch-flashing-outline duration -color\n  ]\nend\n\nto extend-lifespan-of-flashing-outline\n  ask one-of link-neighbors with [is-animation? self and -name = \"flash\"] [reset-animation-lifespan]\nend\n\nto-report already-flashing-outline\n  report any? link-neighbors with [is-animation? self and -name = \"flash\"]\nend\n\nto hatch-flashing-outline [duration -color]\n  let outline-thickness min (list (size * 1.5) (size + 0.5))\n  let -flash hatch-flashing-animation shape outline-thickness -color duration\n  ask -flash [tie-to-myself]\nend\n\nto tie-to-myself\n  create-link-from myself [\n    tie\n    hide-link\n  ]\nend\n\nto create-inflating-animation [-shape -size -color -lifespan]\n  ask hatch-animation \"inflate\" -lifespan [\n    set shape -shape\n    set size -size\n    set color -color\n    set data table:from-list [[\"increase\" 5]]\n    pen-up\n  ]\nend\n\nto-report hatch-flashing-animation [-shape -size -color -lifespan]\n  let -animation nobody\n  ask hatch-animation \"flash\" -lifespan [\n    set -animation self\n    set shape -shape\n    set size -size\n    set color -color\n    pen-up\n    set data table:from-list (list\n      (list \"flash-every-n-ticks\" 1))\n  ]\n  report -animation\nend\n\nto hatch-rotating-animation [-shape -size -color -lifespan]\n  ask hatch-animation \"rotate\" -lifespan [\n    set shape -shape\n    set size -size\n    set color -color\n    pen-up\n    set data table:from-list [[\"angle\" 10]]\n  ]\nend\n\nto-report sprout-animation [name -lifespan]\n  let sprouted-animation nobody\n  sprout-animations 1 [\n    initialize-animation name -lifespan\n    set sprouted-animation self\n  ]\n  report sprouted-animation\nend\n\nto-report  hatch-animation [name -lifespan]\n  let hatched-animation nobody\n  hatch-animations 1 [\n    initialize-animation name -lifespan\n    set hatched-animation self\n  ]\n  report hatched-animation\nend\n\nto-report create-animation [name -lifespan]\n  let created-animation nobody\n  create-animations 1 [\n    initialize-animation name -lifespan\n    set created-animation self\n  ]\n  report created-animation\nend\n\n;to initialize-animator\n;  set animator get-animator -name\n;end\n\nto initialize-animation [name -lifespan]\n  set -name name\n  set birthday animation-ticks\n  set lifespan -lifespan\n  ;initialize-animator\n  set data table:make\n  set label \"\"\n  set label-color white\n  set color add-transparency white 0\n  set heading 0\n  set shape \"empty\"\n  set size 0\n  pen-up\n  show-turtle\nend\n\nto parse-animate-block [node population objects]\n  ; check if lifespan is negative\nend\n\nto run-draw-block [node population objects]\n  let parameters node-parameters node\n  let -shape table:get parameters \"shape\"\n  let -lifespan table:get parameters \"lifespan\"\n  let -color table:get parameters \"color\"\n  let -size table:get parameters \"size\"\n  hatch-animations 1 [\n    set -name \"draw\"\n    set shape -shape\n    set color add-transparency -color 0.35\n    set size -size\n    set lifespan -lifespan\n    set label \"\"\n    set label-color white\n    set heading 0\n    show-turtle\n    set birthday ticks\n    pen-up\n  ]\nend\n\nto parse-draw-block [node population objects]\n  ; check if lifespan is negative\nend\n\nto-report get-ball-mark [node]\n  report table:get-or-default node who nobody\nend\n\nto-report ball-already-has-mark [node]\n  report get-ball-mark node != nobody\nend\n\nto-report create-mark [-color -shape -lifespan]\n  let mark hatch-animation \"mark\" -lifespan\n  ask mark [\n    set color -color\n    set shape -shape\n    pen-up\n  ]\n  report mark\nend\n\nto create-new-mark-for-ball [node objects]\n  let parameters node-parameters node\n  let -color add-transparency table:get parameters \"color\" 0.35\n  let -shape table:get parameters \"shape\"\n  let -lifespan table:get parameters \"lifespan\"\n  let mark create-mark -color -shape -lifespan\n  table:put node who mark\n  mark-objects mark objects\nend\n\nto mark-objects [mark objects]\n  let balls-to-mark (turtle-set self ifelse-value is-multiple-objects objects [objects] [one-of first objects])\n  let -center center-xy balls-to-mark\n  let -xcor first -center\n  let -ycor last -center\n  let -size max [(distancexy -xcor -ycor) + size + 1.5] of balls-to-mark\n  ask mark [\n    set size -size\n    setxy -xcor -ycor\n    reset-animation-lifespan\n  ]\nend\n\nto run-mark-block [node population objects]\n  ifelse not ball-already-has-mark node [\n    create-new-mark-for-ball node objects\n  ] [\n    mark-objects get-ball-mark node objects\n  ]\nend\n\nto parse-mark-block [node population objects]\n  validate-has-one-of-ancestors node [\"if-collide\" \"if-in-radius\"]\n  ; check if lifespan negative\nend\n\nto run-repeat-block [node population objects]\n  let parameters node-parameters node\n  let amount table:get parameters \"amount\"\n  repeat amount [run-children node population objects]\nend\n\nto parse-repeat-block [node population objects]\n  let parameters node-parameters node\n  let amount table:get parameters \"amount\"\n  if amount < 0 [\n    let message (word \"Repeat amount can not be negative: \" amount)\n    throw-ast-error node message\n  ]\n  parse-children node population objects\nend\n\nto parse-disappear-block [node population objects]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let population-of-ball-being-created user-population-input-to-population-number user-defined-population\n  if population-of-ball-being-created = false [\n    let message (word \"Population '\" user-defined-population \"' defined in '\" name \"' block does not exist.\")\n    throw-ast-error node message\n  ]\nend\n\nto run-disappear-block [node population objects]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let population-of-ball-being-removed user-population-input-to-population-number user-defined-population\n  let removal-candidates (turtle-set objects) with [population-num = population-of-ball-being-removed]\n  ifelse any? removal-candidates [\n    ask one-of removal-candidates [remove-ball]]\n  [\n    if population-num = population-of-ball-being-removed [remove-ball]\n  ]\nend\n\nto parse-add-block [node population]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let population-of-ball-being-created user-population-input-to-population-number user-defined-population\n  if population-of-ball-being-created = false [\n    let message (word \"Population '\" user-defined-population \"' defined in '\" name \"' block does not exist.\")\n    throw-ast-error node message\n  ]\nend\n\nto run-add-block [node population]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let population-of-ball-being-created user-population-input-to-population-number user-defined-population\n  hatch-balls-at population-of-ball-being-created 1 xcor ycor\nend\n\nto parse-at-least-x-ticks-block [node population objects]\n  let name node-name node\n  let parameters node-parameters node\n  let amount table:get parameters \"amount\"\n  if amount < 0 [\n    let message (word \"Tick amount can not be negative: \" amount)\n    throw-ast-error node message\n  ]\n  parse-children node population objects\nend\n\nto run-at-least-x-ticks-block [node population objects]\n  let parameters node-parameters node\n  let amount table:get parameters \"amount\"\n  table:put node who last-n-elements (sentence (table:get-or-default node who []) ticks) amount\n  let arithmetic-sum (amount * (amount + 1)) / 2\n  let sum-tick-count-of-last-x-visits-here sum table:get node who\n  let has-visited-node-x-consequtive-ticks (sum-tick-count-of-last-x-visits-here + arithmetic-sum) = (ticks + 1) * amount\n  if has-visited-node-x-consequtive-ticks [\n    run-children node population objects\n  ]\nend\n\nto run-chance-block [node population objects]\n  let probability table:get node-parameters node \"probability\"\n  if random-chance probability [run-children node population objects]\nend\n\nto parse-chance-block [node population objects]\n  ;validate-node-has-only-children-named node [\"heading\" \"speed\" \"field-strength\" \"create-ball\" \"chance\" \"kill-balls-that-meet\" \"if-collide\" \"if-in-radius\" \"add\" \"disappear\" \"repeat\" \"mark\" \"at-least-x-ticks\"]\n  parse-children node population objects\nend\n\nto parse-if-in-radius-block [node population objects]\n  ;validate-node-has-only-children-named node [\"heading\" \"speed\" \"chance\" \"create-ball\" \"kill-balls-that-meet\" \"if-collide\" \"if-in-radius\" \"add\" \"disappear\" \"repeat\" \"mark\" \"at-least-x-ticks\"]\n  parse-children node population objects\nend\n\nto run-if-in-radius-block [node population objects]\n  let parameters node-parameters node\n  let radius table:get parameters \"radius\"\n  let -objects-in-radius objects-in-radius objects radius\n  if -objects-in-radius != false [run-children node population -objects-in-radius]\nend\n\nto parse-if-collide-block [node population objects]\n  ;validate-node-has-only-children-named node [\"heading\" \"speed\" \"chance\" \"create-ball\" \"kill-balls-that-meet\" \"if-collide\" \"if-in-radius\" \"add\" \"disappear\" \"repeat\" \"mark\" \"at-least-x-ticks\"]\n  parse-children node population objects\nend\n\nto run-if-collide-block [node population objects]\n  let -objects-colliding-with objects-colliding-with objects\n  if -objects-colliding-with != false [run-children node population -objects-colliding-with]\nend\n\nto parse-if-ball-meets-block-then-clause [node population objects]\n  ;validate-node-has-only-children-named node [\"heading\" \"speed\" \"field-strength\" \"chance\" \"create-ball\" \"kill-balls-that-meet\" \"if-collide\" \"if-in-radius\" \"add\" \"disappear\" \"repeat\" \"mark\" \"at-least-x-ticks\"]\n  let name node-name node\n  let children node-children node\n  if (empty? objects) and (not empty? children) [\n    let message (word \"No objects defined\" )\n    throw-ast-error node message\n  ]\n  parse-children node population objects\nend\n\nto run-if-ball-meets-block-then-clause [node population objects]\n  run-children node population objects\nend\n\nto parse-kill-balls-that-meet-block [node population objects]\n  validate-has-one-of-ancestors node [\"if-collide\" \"if-in-radius\"]\nend\n\nto run-kill-balls-that-meet-block [node population objects]\n  ifelse is-multiple-objects objects [foreach [self] of turtle-set objects remove-ball] [ask one-of turtle-set objects [remove-ball]]\n  remove-ball\nend\n\nto parse-if-ball-meets-block [node population]\n  let children node-children node\n  let children-names map node-name children\n  let objects-clause child-by-name node \"objects\"\n  let then-clause child-by-name node \"then\"\n  let objects parse-result-of-node objects-clause population []\n  parse-node then-clause population objects\nend\n\nto run-if-ball-meets-block [node population]\n  let children node-children node\n  let objects-clause child-by-name node \"objects\"\n  let then-clause child-by-name node \"then\"\n  let objects run-result-of-node objects-clause population []\n  run-node then-clause population objects\nend\n\nto-report run-wall-block [node population]\n  report \"wall\"\nend\n\nto parse-wall-block [node population]\n  ; nothing to parse\nend\n\nto-report run-ball-same-population-block [node population]\n  ;report (list \"ball\" population)\n  report population\nend\n\nto parse-ball-same-population-block [node population]\n  ; nothing to parse\nend\n\nto-report run-ball-other-population-block [node population]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let other-population user-population-input-to-population-number user-defined-population\n  report other-population\nend\n\nto parse-ball-other-population-block [node population]\n  let name node-name node\n  let parameters node-parameters node\n  let user-defined-population table:get parameters \"population\"\n  let other-population user-population-input-to-population-number user-defined-population\n  if other-population = false [\n    let message (word \"Population '\" user-defined-population \"' defined in '\" name \"' block does not exist.\")\n    throw-ast-error node message\n  ]\nend\n\nto-report run-gravity-field-block [node population]\n  report \"gravity-field\"\nend\n\nto parse-gravity-field-block [node population]\n  ; nothing to parse\nend\n\nto-report run-electric-field-block [node population]\n  report \"electric-field\"\nend\n\nto parse-electric-field-block [node population]\n  ; nothing to parse\nend\n\nto-report parse-if-ball-meets-block-objects-clause [node population]\n  validate-node-has-only-children-named node [\"wall\" \"ball-same-population\" \"ball-from-population\" \"gravity-field\" \"electric-field\"]\n  let children node-children node\n  let objects map node-name children\n  let non-ball-objects filter [object -> not member? object [\"ball-same-population\" \"ball-from-population\"]] objects\n  let objects-contain-non-ball-object not empty? non-ball-objects\n  if (length children > 1) and (objects-contain-non-ball-object) [\n    let message (word \"Multiple objects is only defined for ball type objects, please remove the following: \"\n      non-ball-objects \" from objects: \" objects)\n    throw-ast-error node message\n  ]\n  parse-children node population []\n  report objects\nend\n\nto-report objects-clause-has-multiple-ball-objects [node]\n  let children-names map node-name node-children node\n  report not empty? filter [name -> member? name [\"ball-same-population\" \"ball-from-population\"]] children-names\nend\n\nto-report run-if-ball-meets-block-objects-clause [node population]\n  let objects run-result-children node population []\n  ; only balls can be multiple objects, if so then handle what their values should be.\n  ; if single object then return agent-set of balls\n  ; if multiple objects then return population-numbers of balls in a list as is\n  ; if multiple objects and has gone through a block that changes object then return list of turtles (not done in this function)\n  if objects-clause-has-multiple-ball-objects node [\n    report ifelse-value is-multiple-objects objects [objects] [map [object -> other balls-of object] objects] ]\n  report objects\nend\n\nto parse-actions-and-properties-of-configure-population-block [node]\n  let parameters node-parameters node\n  let population table:get parameters \"population\"\n  let properties-clause child-by-name node \"properties\"\n  let actions-clause child-by-name node \"actions\"\n  parse-properties-clause properties-clause population\n  parse-actions-clause actions-clause population\nend\n\nto run-actions-and-properties-of-configure-population-block [node]\n  let parameters node-parameters node\n  let population table:get parameters \"population\"\n  initialize-ball-population-properties population\n  let properties-clause child-by-name node \"properties\"\n  let actions-clause child-by-name node \"actions\"\n  run-properties-clause properties-clause population\n  run-actions-clause actions-clause population\nend\n\nto parse-interactions-clause [node population]\n  validate-node-has-only-children-named node [\"if-ball-meets\"]\n  parse-children node population []\nend\n\nto run-interactions-clause [node population]\n  run-children node population []\nend\n\nto parse-actions-clause [node population]\n  validate-node-has-only-children-named node [\"move-forever\" \"move-x-steps\"]\n  validate-only-one-of-children-exists node [\"move-forever\" \"move-x-steps\"]\n  validate-no-duplicate-children-named node [\"move-forever\" \"move-x-steps\"]\n  parse-children node population []\nend\n\nto run-actions-clause [node population]\n  run-children node population []\nend\n\nto parse-move-forever-block [node population]\n  ; nothing to parse\nend\n\nto run-move-forever-block [node population]\n  set-prop population \"move\" true\nend\n\nto parse-move-x-steps-block [node population]\n  ; nothing to parse\nend\n\nto run-move-x-steps-block [node population]\n  let parameters node-parameters node\n  let steps table:get parameters \"steps\"\n  set-prop population \"move\" steps\nend\n\nto parse-properties-clause [node population]\n  validate-node-has-only-children-named node [\"color\" \"size\" \"shape\" \"initial-heading\" \"initial-speed\" \"name\"]\n  parse-children node population []\nend\n\nto run-properties-clause [node population]\n  run-children node population []\nend\n\nto parse-property-block [node population]\n  ; nothing to currently parse in general property block\nend\n\nto run-property-block [node population]\n  let parameters node-parameters node\n  let property-name first table:keys parameters\n  let property-value table:get parameters property-name\n  set-prop population property-name property-value\nend\n\nto parse-color-block [node population]\n  ; nothing to currently parse in color block\nend\n\nto run-color-block [node population]\n  let color-value node-parameter node \"color\"\n  ifelse is-first-color-property-to-be-defined node [\n    set-prop population \"color\" color-value]\n  [\n    add-secondary-color-to-population population color-value\n  ]\nend\n\nto add-secondary-color-to-population [population -color]\n  set-prop population \"secondary-colors\" lput -color pprop population \"secondary-colors\"\nend\n\nto-report is-first-color-property-to-be-defined [node]\n  let parent node-parent node\n  let sibling-nodes node-children parent\n  let node-index position node sibling-nodes\n  report empty? filter [sibling-node -> node-name sibling-node = \"color\"] sublist sibling-nodes 0 node-index\nend\n\nto-report multiple-objects-already-set [objects]\n  report is-turtle? one-of objects\nend\n\nto-report objects-in-radius-multiple-objects [objects radius]\n  ifelse multiple-objects-already-set objects [\n    report ifelse-value count (turtle-set objects in-radius radius) = length objects [objects] [false]\n  ] [\n    let all-balls-in-radius other (balls in-radius radius)\n    let ball-populations objects\n    let balls-in-radius [] ; a single combination set (of all possible) from balls in radius\n    ask all-balls-in-radius [\n      if member? population-num ball-populations [\n        set ball-populations remove-item (position population-num ball-populations) ball-populations\n        set balls-in-radius lput self balls-in-radius\n        if empty? ball-populations [stop]\n      ]\n    ]\n    report ifelse-value empty? ball-populations [balls-in-radius] [false]\n  ]\nend\n\nto-report objects-in-radius-single-object [objects radius]\n  let -objects-in-radius (first objects) in-radius radius\n  report ifelse-value any? -objects-in-radius [(list -objects-in-radius)] [false]\nend\n\nto update-shapes-of-population [population]\n  ask balls-of population [update-ball-shape]\nend\n\nto update-color-of-population [population]\n  ask balls-of population [update-ball-color]\nend\n\nto update-size-of-population [population]\n  ask balls-of population [update-ball-size]\nend\n\nto update-ball-size\n  set size prop \"size\"\n  ; compound shapes need to be updated to new size as well\n  update-ball-shape\nend\n\nto update-ball-color\n  set color prop \"color\"\n  ; compound shapes need to be updated to new color as well\n  update-ball-shape\nend\n\nto-report unequal-keys [table1 table2]\n  report filter [key -> table:get table1 key != table:get table2 key] table:keys table1\nend\n\nto-report properties-that-changed-for-population [population]\n  report unequal-keys (properties-of population) (prev-properties-of population)\nend\n\nto notify-property-changed-for-population [population property]\n  (ifelse\n    property = \"shape\" [update-shapes-of-population population]\n    property = \"size\" [update-size-of-population population]\n    property = \"color\" [update-color-of-population population]\n    property = \"secondary-colors\" [update-color-of-population population]\n  )\nend\n\n;to-report property-changed-procedure [property]\n;  report table:get-or-default property-change-procedure-lookup property [[population] -> ]\n;end\n\n;to-report global-variable-changed-procedure [global-variable]\n;  report table:get-or-default global-variables-set-handlers global-variable [[new-value] -> ]\n;end\n\nto-report global-variables-that-changed\n  let current global-variable-values\n  let prev global-variables-record\n  let -global-variables-that-changed table:from-list map [global-variable -> (list global-variable table:get current global-variable)] (unequal-keys prev current)\n  set global-variables-record current\n  report -global-variables-that-changed\nend\n\nto handle-global-variable-set [name value]\n  (ifelse\n    name = \"show-name\" [ifelse value [show-balls-labels] [hide-balls-labels]]\n    name = \"color-speed\" [if not value [ask balls [update-ball-color]]]\n  )\nend\n\nto notify-of-global-variable-changes\n  let -global-variables-that-changed global-variables-that-changed\n  foreach table:keys -global-variables-that-changed [global-variable ->\n    let new-value table:get -global-variables-that-changed global-variable\n    handle-global-variable-set global-variable new-value\n  ]\nend\n\nto notify-properties-that-changed-for-population [population]\n  foreach properties-that-changed-for-population population [\n    changed-property -> notify-property-changed-for-population population changed-property ]\nend\n\nto notify-properties-that-changed-for-each-population\n  foreach population-numbers notify-properties-that-changed-for-population\nend\n\nto update-ball-population-properties-defined-in-nettango-blocks\n  ; in order to account for changes to property blocks, every turn the population properties are initialized\n  ; and reset. The reason is that if a block is removed, then the option for that property must\n  ; be set to default, which is done by initializing all population properties and reapplying\n  ; properties of remaining blocks.\n  ; these functions are defined in nettango, so to reduce the amount of lines\n  ; needed to be changed between desktop and web use, the primitive \"run\"\n  ; is used because the compiler can not check if these procedures exist until runtime\n  initialize-all-lookup-tables-if-nettango-has-recompiled\n  set nodes-by-id []\n  set id-counter 0\n\n  let amount-of-populations 2\n  ;foreach (range 1 (amount-of-populations + 1)) [ population ->\n  ;  run (word \"configure-population-\" population)\n  ;]\n  configure-population-1\n  configure-population-2\n  if keep-prev-ast-if-new-ast-did-not-change [\n    ;todo parsing is redundant if ast has not changed\n    ;need to run actions here\n    foreach (range 1 (amount-of-populations + 1)) [ population ->\n      parse-actions-and-properties-of-configure-population-block table:get blocks population\n    ]\n    foreach (range 1 (amount-of-populations + 1)) [ population ->\n      run-actions-and-properties-of-configure-population-block table:get blocks population\n    ]\n    foreach (range 1 (amount-of-populations + 1)) [ population ->\n      parse-interactions-clause interaction-clause-of-population population population\n    ]\n    notify-properties-that-changed-for-each-population\n  ]\nend\n\nto-report keep-prev-ast-if-new-ast-did-not-change\n  ;if not tables-are-equal curr-ast-by-population prev-ast-by-population  [\n  let ast-changed (word curr-ast-by-population) != prev-ast-by-population\n  if ast-changed [\n    ;print \"changed\"\n    set blocks copy-table curr-ast-by-population\n    set last-used-nodes-by-id nodes-by-id\n    ;print blocks\n  ]\n  ;set prev-ast-by-population table-as-list curr-ast-by-population\n  set prev-ast-by-population (word curr-ast-by-population)\n  set curr-ast-by-population table:make\n  ; this line of code is important, since every tick a new ast is formed, and\n  ; nodes-by-id gets updated with the new nodes, however it needs to get set to\n  ; the list of nodes that the current running ast is using, which is not the same\n  ; as the ast the was just formed in nettango. The nodes need this to know how to\n  ; refer to each other by id.\n  ; TODO: find a more elegant solution.\n  set nodes-by-id last-used-nodes-by-id\n  report ast-changed\nend\n\nto time-run\n  ;if ticks = 0 [profiler:reset profiler:start]\n  ;if ticks = 300 [print profiler:report profiler:reset]\nend\n\nto advance-state-of-world\n  every (tick-delta) [\n    advance-balls-in-world2\n    advance-ticks\n  ]\nend\n\nto lp [string]\n  ;if verbal = true [\n  ;  print (word string \" \" timer)\n  ;  reset-timer\n  ;]\nend\n\nto go\n  on-start-of-turn\n  ifelse any-moving-balls? [\n    advance-state-of-world\n  ][\n    re-enable-movement-for-balls-predefined-to-move-limited-number-of-ticks\n    on-end-of-turn\n    stop  ; unselect \"play\" button\n  ]\n  on-end-of-turn\nend\n\nto update-marker\n  update-speed-in-halos\n  set curr-marker סמן\n  ifelse markers-set-to-hidden\n  [\n    hide-all-markers\n  ]\n  [\n    if markers-set-to-shown\n    [\n      show-all-markers\n    ]\n  ]\n  set prev-marker curr-marker\nend\n\nto marker-changed-from [prev]\n  (ifelse\n    ;prev = \"הילה\" [ask halos [hide-turtle]]\n    ;prev = \"הילה עם מהירות\" [ask halos [hide-turtle] update-speed-in-halos]\n    ;prev = \"עקבות של כדור\" [pause-ball-tracing]\n    ;prev = \"מונה כדורים\" [hide-counters]\n    prev = \"ללא סמן\" [show-all-markers]\n  )\nend\n\nto marker-changed-to [new]\n  (ifelse\n    new = \"הילה\" [ask halos [show-turtle]]\n    new = \"הילה עם מהירות\" [ask halos [show-turtle] update-speed-in-halos]\n    new = \"עקבות של כדור\" [resume-ball-tracing]\n    new = \"מונה כדורים\" [show-counters]\n    new = \"ללא סמן\" [hide-all-markers]\n  )\nend\n\nto hide-counters\n  ask counters [hide-turtle]\n  ask (turtle-set map [counter-number -> counter-number-gfx counter-number] table:keys counters-information-gfx\n                  map [counter-number -> counter-number-gfx counter-number] table:keys counters-information-gfx)\n  [\n    hide-turtle\n  ]\n  ;ask counter-information-gfx [\n  ;  ask counter-number-gfx-overlay [hide-turtle]\n  ;  ask ball-count-gfx-overlay [hide-turtle]\n  ;]\nend\n\nto show-counters\n  ask counters [show-turtle]\n  ask (turtle-set map [counter-number -> counter-number-gfx counter-number] table:keys counters-information-gfx\n                  map [counter-number -> counter-number-gfx counter-number] table:keys counters-information-gfx)\n  [\n    show-turtle\n  ]\n  ;ask counter-information-gfx [\n  ;  ask counter-number-gfx-overlay [show-turtle]\n  ;  ask ball-count-gfx-overlay [show-turtle]\n  ;]\nend\n\nto-report markers-set-to-hidden\n  report prev-marker != curr-marker and curr-marker = \"ללא סמן\"\nend\n\nto-report markers-set-to-shown\n  report prev-marker != curr-marker and prev-marker = \"ללא סמן\"\nend\n\nto hide-all-markers\n  clear-drawing\n  pause-ball-tracing\n  ask halos [hide-turtle]\nend\n\nto pause-ball-tracing\n  set marked-balls balls with [pen-mode = \"down\"]\n  ask marked-balls [pen-up]\nend\n\nto resume-ball-tracing\n  ask marked-balls [pen-down]\n  resume-ball-tracing\nend\n\nto show-all-markers\n  ask marked-balls [pen-down]\n  ask halos [show-turtle]\nend\n\nto-report halo-is-displaying-speed\n  report label != \"\"\nend\n\nto-report halo-with-speed-marker-selected\n  report סמן = \"הילה עם מהירות\"\nend\n\nto update-speed-in-halos\n  ask halos [\n    update-halo-speed\n  ]\nend\n\nto update-halo-speed\n  ifelse show-speed [\n    set label (word precision [speed] of ball-tied-to-halo 2 \"     \")\n  ] [\n    set label \"\"\n  ]\nend\n\nto-report ball-tied-to-halo\n  report [other-end] of one-of my-links\nend\n\nto on-end-of-turn\n  set brush-activated-after-model-was-advanced false\n  set prev-population-properties copy-table population-properties\n  notify-of-global-variable-changes\n  check-if-should-color-balls-relative-to-population-speed\n  run-animations\n  update-marker\n  update-speed-in-halos\nend\n\nto on-start-of-turn\n  ;time-run\n  log-go-procedure\n  update-ball-population-properties-defined-in-nettango-blocks\nend\n\n;to-report prev-global-variable [name]\n;  report table:get global-variables-record name\n;end\n\nto check-if-should-color-balls-relative-to-population-speed\n  ;if color-speed [color-balls-relative-to-population-speed]\nend\n\nto show-balls-labels\n  ask balls [show-ball-label]\nend\n\nto hide-balls-labels\n  ask balls [hide-ball-label]\nend\n\nto update-ball-labels\n  ifelse -show-ball-label [\n    show-balls-labels ]\n  [\n    hide-balls-labels\n  ]\nend\n\nto color-population-by-speed [population]\n  let -balls balls-of population\n  if (count -balls > 1) [\n    let speed-of-balls [speed] of -balls\n    let average-speed mean speed-of-balls\n    let speed-standard-deviation standard-deviation speed-of-balls\n    let lower-limit average-speed - 3 * speed-standard-deviation\n    let upper-limit average-speed + 3 * speed-standard-deviation\n    ask -balls [set color scale-color color speed (lower-limit - 1) (upper-limit + 1)]\n  ]\nend\n\nto color-balls-relative-to-population-speed\n  foreach population-numbers [population -> color-population-by-speed population]\nend\n\nto show-ball-label\n  set label prop \"name\"\n  set label-color add-transparency label-color 1\nend\n\nto hide-ball-label\n  set label-color add-transparency label-color 0\nend\n\n; ball procedure\nto-report ball-can-move\n  (ifelse\n    ball-moves-forever? [report true]\n    ball-set-to-move-x-steps? [report steps-left-to-move > 0]\n  )\nend\n\nto-report ball-set-to-move-x-steps?\n  report is-number? prop \"move\"\nend\n\nto-report ball-moves-forever?\n  report is-boolean? prop \"move\"\nend\n\nto-report steps-left-to-move\n  report amount-of-steps-ball-was-set-to-move - steps-moved-since-ball-was-last-set-to-move-x-steps\nend\n\nto-report amount-of-steps-ball-was-set-to-move\n  report (prop \"move\")\nend\n\nto-report steps-moved-since-ball-was-last-set-to-move-x-steps\n  report (ticks - tick-move-enabled)\nend\n\n; turtle procedure\nto flash-counter-here\n  if [has-counter] of patch-here [\n    ask patch-here [flash-patch black] ]\nend\n\n; patch procedure\nto-report has-flash\n  report any? animations-here with [-name = \"patch-flash\"]\nend\n\n; patch procedure\nto create-flash-here [-flash-color]\n  let -effect \"patch-flash\"\n  let -lifespan 3\n  ask sprout-animation -effect -lifespan [\n    set color -flash-color\n    set shape \"square\"\n    set size 1\n  ]\nend\n\n; patch procedure\nto flash-patch [-flash-color]\n  ifelse has-flash [\n    extend-lifespan-of-flash-here ]\n  [\n    create-flash-here -flash-color\n  ]\nend\n\n; patch procedure\nto extend-lifespan-of-flash-here\n  ask one-of animations-here with [-name = \"patch-flash\"] [reset-animation-lifespan]\nend\n\nto reset-animation-lifespan\n  ;set lifespan lifespan + animation-age\n  set birthday animation-ticks\nend\n\nto-report animation-age\n  report ticks - birthday\nend\n\nto set-ball-xy-to-return-cyclically-around-world\n  set xcor (((xcor + max-pxcor) mod (2 * max-pxcor)) - max-pxcor)\n  set ycor (((ycor + max-pycor) mod (2 * max-pycor)) - max-pycor)\nend\n\nto-report is-ball-being-traced\n  report pen-mode = \"down\"\nend\n\nto return-ball-cyclically-around-world\n  ifelse is-ball-being-traced [\n    pen-up\n    set-ball-xy-to-return-cyclically-around-world\n    pen-down ]\n  [\n    set-ball-xy-to-return-cyclically-around-world\n  ]\nend\n\n; ball procedure\nto-report move-distance\n  report (speed * tick-delta)\nend\n\nto-report edge-patches-with-electric-field-like-mine\n  report edge-patches with [field-number = [field-number] of myself]\nend\n\nto-report edge-patches\n  report (patch-set\n    n-values (world-width) [x -> (patch-set (patch (min-pxcor + x) max-pycor) (patch (min-pxcor + x) min-pycor))]\n    n-values (world-height) [y -> (patch-set (patch max-pxcor (min-pycor + y)) (patch min-pxcor (min-pycor + y)))]\n    )\nend\n\nto-report ball-is-in-electric-field\n  report has-electric-field\nend\n\nto-report neighbors-no-wrap\n  report neighbors with [is-neighbor-no-wrap myself]\nend\n\nto-report neighbors4-no-wrap\n  report neighbors4 with [is-neighbor-no-wrap myself]\nend\n\nto-report is-neighbor-no-wrap [-patch]\n  let abs-xcor-delta abs (pxcor - [pxcor] of -patch)\n  let abs-ycor-delta abs (pycor - [pycor] of -patch)\n  report (abs-xcor-delta <= 1) and (abs-ycor-delta <= 1) and (self != -patch)\nend\n\nto-report is-moving-past-edge-of-world\n  let patch-ball-will-move-to destination-patch-if-ball-were-to-move\n  let ball-will-move-to-new-patch patch-ball-will-move-to != patch-here\n  report (ball-will-move-to-new-patch) and (not [is-neighbor-no-wrap patch-ball-will-move-to] of patch-here)\nend\n\nto-report destination-patch-if-ball-were-to-move\n  report patch-ahead move-distance\nend\n\nto-report is-ball-exiting-world-through-electric-field\n  report ball-is-in-electric-field and is-moving-past-edge-of-world\nend\n\nto move-ball-to-random-edge-patch-with-same-electric-field-it-is-currently-on\n  let saved-pen-mode pen-mode\n  if pen-mode = \"down\" [pen-up]\n  let patches-on-edge edge-patches-with-electric-field-like-mine\n  let new-patch one-of patches-on-edge   ;\n  set xcor [pxcor] of new-patch\n  set ycor [pycor] of new-patch\n  if (([field-x] of new-patch != 0) or ([field-y] of new-patch != 0)) [\n    set heading atan [field-x] of new-patch  [field-y] of new-patch ]\n  set pen-mode saved-pen-mode\nend\n\nto move\n  if ball-can-move [\n    if is-ball-exiting-world-through-electric-field [\n      move-ball-to-random-edge-patch-with-same-electric-field-it-is-currently-on ]\n    jump move-distance\n    on-ball-moved\n  ]\nend\n\nto on-ball-moved\n  increase-counter-on-patch-ball-is-on\nend\n\nto increase-counter-on-patch-ball-is-on\n  if any? counters-here [\n    increase-counter counter-number-here\n    flash-counter-here\n  ]\nend\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;bounce;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\nto-report heading-quadrant\n  let -heading heading mod 360\n  (ifelse\n    (-heading >= 0) and (-heading < 90) [report 1]\n    (-heading >= 90) and (-heading < 180) [report 2]\n    (-heading >= 180) and (-heading < 270) [report 3]\n    (-heading >= 270) and (-heading < 360) [report 4]\n  )\nend\n\nto-report check-wall-collision-quadrant-1\n let new-patch patch-ahead look-ahead-wall-collision\n if new-patch = nobody [report false]\n let new-patch-right  patch-at-heading-and-distance  90 look-ahead-wall-collision\n let new-patch-up    patch-at-heading-and-distance    0 look-ahead-wall-collision\n if (new-patch-right = nobody) [set new-patch-right patch-here]  ; if at edge of world\n if (new-patch-up = nobody) [set new-patch-up patch-here]  ; if at edge of world\n\n (ifelse\n   (([has-wall] of new-patch-right) and ([has-wall] of new-patch-up) ) [report (list \"corner\" [pxcor] of new-patch-right [pycor] of new-patch-right)]\n   ([has-wall] of new-patch-right)   [report (list \"right\" [pxcor] of new-patch-right [pycor] of new-patch-right)]\n   ([has-wall] of new-patch-up)     [report (list \"up\" [pxcor] of new-patch-up [pycor] of new-patch-up)]\n   ([has-wall] of new-patch)        [report (list \"corner\" [pxcor] of new-patch [pycor] of new-patch)]\n    [report false]\n )\nend\n\nto-report check-wall-collision-quadrant-2\n  let new-patch patch-ahead look-ahead-wall-collision\n  if new-patch = nobody [report false]\n  let new-patch-right  patch-at-heading-and-distance   90 look-ahead-wall-collision\n  let new-patch-down  patch-at-heading-and-distance  180 look-ahead-wall-collision\n  if (new-patch-right = nobody) [set new-patch-right patch-here]  ; if at edge of world\n  if (new-patch-down = nobody) [set new-patch-down patch-here]  ; if at edge of world\n\n  (ifelse\n    (([has-wall] of new-patch-right) and ([has-wall] of new-patch-down))  [report (list \"corner\" [pxcor] of new-patch-right [pycor] of new-patch-right)]\n    ([has-wall] of new-patch-right)   [report (list \"right\" [pxcor] of new-patch-right [pycor] of new-patch-right)]\n    ([has-wall] of new-patch-down)   [report (list \"down\" [pxcor] of new-patch-down [pycor] of new-patch-down)]\n    ([has-wall] of new-patch)        [report (list \"corner\" [pxcor] of new-patch [pycor] of new-patch)]\n    [report false]\n  )\nend\n\nto-report check-wall-collision-quadrant-3\n  let new-patch patch-ahead look-ahead-wall-collision\n  if new-patch = nobody [report false]\n  let new-patch-left  patch-at-heading-and-distance  -90 look-ahead-wall-collision\n  let new-patch-down  patch-at-heading-and-distance  180 look-ahead-wall-collision\n  if (new-patch-left = nobody) [set new-patch-left patch-here]  ; if at edge of world\n  if (new-patch-down = nobody) [set new-patch-down patch-here]  ; if at edge of world\n\n  (ifelse\n    (([has-wall] of new-patch-left) and ([has-wall] of new-patch-down))  [report (list \"corner\" [pxcor] of new-patch-left [pycor] of new-patch-left)]\n    ([has-wall] of new-patch-left)   [report (list \"left\" [pxcor] of new-patch-left [pycor] of new-patch-left)]\n    ([has-wall] of new-patch-down)   [report (list \"down\" [pxcor] of new-patch-down [pycor] of new-patch-down)]\n    ([has-wall] of new-patch)        [report (list \"corner\" [pxcor] of new-patch [pycor] of new-patch)]\n    [report false]\n  )\nend\n\nto-report check-wall-collision-quadrant-4\n  let new-patch patch-ahead look-ahead-wall-collision\n  if new-patch = nobody [report false]\n  let new-patch-left  patch-at-heading-and-distance  -90 look-ahead-wall-collision\n  let new-patch-up    patch-at-heading-and-distance    0 look-ahead-wall-collision\n  if (new-patch-left = nobody) [set new-patch-left patch-here]  ; if at edge of world\n  if (new-patch-up = nobody) [set new-patch-up patch-here]  ; if at edge of world\n\n  (ifelse\n    (([has-wall] of new-patch-left) and ([has-wall] of new-patch-up)) [report (list \"corner\" [pxcor] of new-patch-left [pycor] of new-patch-left)]\n    ([has-wall] of new-patch-left)   [report (list \"left\" [pxcor] of new-patch-left [pycor] of new-patch-left)]\n    ([has-wall] of new-patch-up)     [report (list \"up\" [pxcor] of new-patch-up [pycor] of new-patch-up)]\n    ([has-wall] of new-patch)        [report (list \"corner\" [pxcor] of new-patch [pycor] of new-patch)]\n    [report false]\n  )\nend\n\nto-report wall-collision-direction-and-xy\n let quadrant heading-quadrant\n (ifelse\n   quadrant = 1 [report check-wall-collision-quadrant-1]\n   quadrant = 2 [report check-wall-collision-quadrant-2]\n   quadrant = 3 [report check-wall-collision-quadrant-3]\n   quadrant = 4 [report check-wall-collision-quadrant-4]\n )\n  report false\nend\n\nto check-for-wall-collision ;  if next to wall patch, change speed and heading of ball\n  let direction-and-pos wall-collision-direction-and-xy\n  if direction-and-pos != false [\n    let direction item 0  direction-and-pos\n    let -xcor item 1  direction-and-pos\n    let -ycor item 2  direction-and-pos\n    perform-hit-wall direction -xcor -ycor\n  ]\nend\n\nto change-heading-if-collides-with-wall [heading-change]\n  let direction-and-pos wall-collision-direction-and-xy\n  if direction-and-pos != false [\n    let direction item 0  direction-and-pos\n    let -xcor item 1  direction-and-pos\n    let -ycor item 2  direction-and-pos\n    collide-with-wall heading-change direction -xcor -ycor\n  ]\nend\n\nto-report has-collided-with-wall\n  report (last-tick-wall-collision-occured = ticks) or (wall-collision-direction-and-xy != false)\nend\n\nto change-speed-if-collides-with-wall [speed-change]\n  if has-collided-with-wall [\n    change-speed-after-wall-collision prop \"wall-speed\"\n  ]\nend\n\n;ball procedure\nto change-heading-after-wall-collision [wall-direction heading-change]\n  if (heading-change = \"no change\")[]\n  if (heading-change = \"turn left\")[  set heading (heading - 90 ) ]\n  if (heading-change = \"turn right\")[ set heading (heading + 90 )  ]\n  if (heading-change = \"collide\")[bounce wall-direction]  ; change heading (speed remains the same)\nend\n\nto change-speed-after-wall-collision [speed-change]\n  if (speed-change = \"zero\")     [ set speed 0 ]\n  if (speed-change = \"increase\")[set speed speed + collision-speed-delta]\n  if (speed-change = \"decrease\")[set speed speed - collision-speed-delta]\n  if (speed-change = \"collide\") and (speed-change != \"collide\")\n                     [user-message (word \"You cannot pair non-collide heading change with collide speed change.\")]\nend\n\nto set-ball-speed-to-maximum-if-above-max-speed\n  if (speed > max-speed) [set speed max-speed]\nend\n\n; patch procedure\nto flash-wall-here\n  if has-wall [\n    flash-patch pcolor + 2 ]\nend\n\nto flash-wall-at [-xcor -ycor]\n  if flash-wall-collision [\n    ask patch -xcor -ycor [flash-wall-here] ]\nend\n\nto-report flash-wall-collision\n  report התנגשויות-בקיר\nend\n\nto-report wall-collisions-count [population]\n  report table:get-or-default wall-collisions population 0\nend\n\nto increase-wall-collision-count-for-ball-population\n  increment-table-value wall-collisions population-num 1\nend\n\nto collide-with-wall [heading-change wall-direction xpos ypos]\n  increase-wall-collision-count-for-ball-population\n  on-wall-hit xpos ypos\n  change-heading-after-wall-collision wall-direction heading-change\nend\n\nto perform-hit-wall [wall-direction xpos ypos]\n  increase-wall-collision-count-for-ball-population\n  on-wall-hit xpos ypos\n  change-heading-after-wall-collision wall-direction prop \"wall-heading\"\n  change-speed-after-wall-collision prop \"wall-speed\"\nend\n\nto on-wall-hit [xpos ypos]\n  flash-wall-at xpos ypos\n  set last-tick-wall-collision-occured ticks\nend\n\nto bounce [direction]\n;  sets new heading of ball when hits wall\n;  direction is the direction of the wall from ball \"left\" \"right\" \"up\" \"down\" \"corner\"\n\n  if ((direction = \"right\") or (direction = \"left\")) [set heading (-1 * heading)]  ; hit a horizontal wall\n  if ((direction = \"up\")    or (direction = \"down\")) [set heading (180 - heading)] ; hit vertical wall\n  if (direction = \"corner\")                          [set heading (180 + heading)] ; hit wall at a corner\n  ;set last-collision nobody\nend\n\n ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n ;;;;;;;;;;;;;;;;;;;;;;;;;;;;collision;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\nto-report should-perform-collision-with [other-ball]\n  ;report (who < [who] of other-ball) and (other-ball != last-collision)\n  report not already-collided-with? other-ball\nend\n\nto remember-collided-with [other-ball]\n  set balls-collided-with (turtle-set balls-collided-with other-ball)\nend\n\nto-report already-collided-with? [other-ball]\n  report member? other-ball balls-collided-with\nend\n\nto-report balls-colliding\n  report collision-candidates with [ball-collides-with myself]\nend\n\nto-report balls-colliding-from [other-balls]\n  report balls-colliding with [member? self other-balls]\nend\n\nto change-heading-if-collides-with [other-balls heading-change]\n  ask balls-colliding-from other-balls [\n    if should-perform-collision-with myself [\n      ask myself [perform-collision-heading-change myself heading-change  remember-collided-with myself ] ;set last-collision  myself]\n      ;set last-collision myself\n      remember-collided-with myself\n    ]\n  ]\nend\n\nto change-speed-if-collides-with [other-balls speed-change]\n  ask collision-candidates-with other-balls [\n    if ball-collides-with myself [\n        ask myself [perform-collision-speed-change speed-change]\n    ]\n  ]\nend\n\nto perform-collision-heading-change [other-ball heading-change]\n  ; close duplication of other function\n  (ifelse\n    (heading-change = \"no change\") []\n    (heading-change = \"turn left\") [  set heading (heading - 90) ask other-ball [set heading (heading - 90)]]\n    (heading-change = \"turn right\") [ set heading (heading + 90 ) ask other-ball [set heading (heading + 90)]]\n    (heading-change = \"collide\") [collide-with other-ball]\n  )\nend\n\nto perform-collision-speed-change [speed-change]\n  (ifelse\n    (speed-change = \"zero\")    [set speed 0]\n    (speed-change = \"increase\")[set speed speed + collision-speed-delta]\n    (speed-change = \"decrease\")[set speed speed - collision-speed-delta]\n  )\nend\n\nto perform-collision-speed-change-old [other-ball speed-change]\n  ; close duplication of other function\n  (ifelse\n    (speed-change = \"zero\")    [set speed 0 ask other-ball [set speed 0]]\n    (speed-change = \"increase\")[set speed speed + collision-speed-delta ask other-ball [set speed speed + collision-speed-delta]]\n    (speed-change = \"decrease\")[set speed speed - collision-speed-delta ask other-ball [set speed speed - collision-speed-delta]]\n  )\nend\n\n\nto-report collision-candidates-with [other-balls]\n  report collision-candidates with [member? self other-balls]\nend\n\nto-report collision-candidates-of [population]\n  report collision-candidates with [population-num = population]\nend\n\nto-report collision-candidates-from [ball-set]\n  report collision-candidates with [member? self ball-set]\nend\n\nto-report in-radius-candidates [radius]\n  let -length abs ((round (xcor - (radius / 2))) - (round (xcor + (radius / 2) ))) + 1\n  let top-left-xcor (round (xcor - (radius / 2)))\n  let top-left-ycor (round (ycor + (radius / 2)))\n  report other (turtle-set n-values (-length ^ 2) [i ->\n    ifelse-value abs (top-left-xcor + i mod -length) < max-pxcor and abs (top-left-ycor - int(i / -length)) < max-pycor\n                 [[balls-here] of patch (top-left-xcor + i mod -length) (top-left-ycor - int(i / -length))] [nobody]])\nend\n\nto-report collision-candidates\n  let -length abs ((round (xcor - (size / 2))) - (round (xcor + (size / 2) ))) + 1\n  let top-left-xcor (round (xcor - (size / 2)))\n  let top-left-ycor (round (ycor + (size / 2)))\n  report other (turtle-set n-values (-length ^ 2) [i ->\n    ifelse-value abs (top-left-xcor + i mod -length) < max-pxcor and abs (top-left-ycor - int(i / -length)) < max-pycor\n                 [[balls-here] of patch (top-left-xcor + i mod -length) (top-left-ycor - int(i / -length))] [nobody]])\nend\n\nto-report ball-collides-with [other-ball]\n  let interBallMaxDist  ((size + [size] of other-ball) / 2)\n  let ourDistance distance other-ball\n  report (ourDistance <= interBallMaxDist  and ourDistance >= interBallMaxDist - collision-depth-threshold)\nend\n\nto check-for-collision-with-population [population]\n  ask collision-candidates-of population [\n    if ball-collides-with myself [\n      if should-perform-collision-with myself [\n        ask myself [perform-collision myself]; set last-collision  myself]\n        ;set last-collision myself\n      ]\n    ]\n  ]\nend\n\nto check-for-ball-collision\n  ; check if 2 balls collide. If so Change speed and heading of the 2 balls\n\n  ; Here we impose a rule that collisions only take place when there\n  ; are exactly two balls per patch.  We do this because when the\n  ; student introduces new balls from the side, we want them to\n  ; form a uniform wavefront.\n  ;;\n  ; Why do we want a uniform wavefront?  Because it is actually more\n  ; realistic.  (And also because the curriculum uses the uniform\n  ; wavefront to help teach the relationship between ball collisions,\n  ; wall hits, and pressure.)\n  ;;\n  ; Why is it realistic to assume a uniform wavefront?  Because in reality,\n  ; whether a collision takes place would depend on the actual headings\n  ; of the balls, not merely on their proximity.  Since the balls\n  ; in the wavefront have identical speeds and near-identical headings,\n  ; in reality they would not collide.  So even though the two-balls\n  ; rule is not itself realistic, it produces a realistic result.  Also,\n  ; unless the number of balls is extremely large, it is very rare\n  ; for three or more balls to land on the same patch (for example,\n  ; with 400 balls it happens less than 1% of the time).  So imposing\n  ; this additional rule should have only a negligible effect on the\n  ; aggregate behavior of the system.\n  ;;\n  ; Why does this rule produce a uniform wavefront?  The balls all\n  ; start out on the same patch, which means that without the only-two\n  ; rule, they would all start colliding with each other immediately,\n  ; resulting in much random variation of speeds and headings.  With\n  ; the only-two rule, they are prevented from colliding with each other\n  ; until they have spread out a lot.  (And in fact, if you observe\n  ; the wavefront closely, you will see that it is not completely smooth,\n  ; because some collisions eventually do start occurring when it thins out while fanning.)\n\n  ; Collision occurs if there is a ball in the same patch at the borders of the balls  (GIGI at this point assume a ball can collide with only 1 ball)\n    ; the following conditions are imposed on collision candidates:\n    ;   1. they must have a lower who number than my own, because collision\n    ;      code is asymmetrical: it must always happen from the point of view\n    ;      of just one ball.\n    ;      Update: Balls now keep track with who they collided with in current tick, instead of checking for who numbers.\n    ;   2. they must not be the same ball that we last collided with on\n    ;      this patch, so that we have a chance to leave the patch after we've\n    ;      collided with someone.\n\n  ;ask collision-candidates [\n  ;  if ball-collides-with myself [\n  ask balls in-radius 3 with [member? self balls and (((xcor - [xcor] of myself) ^ 2 + (ycor - [ycor] of myself) ^ 2) < (([size] of myself) ^ 2))] [\n  ;ask (in-radius-candidates 3) with [member? self balls and (((xcor - [xcor] of myself) ^ 2 + (ycor - [ycor] of myself) ^ 2) < (([size] of myself) ^ 2))] [\n      if should-perform-collision-with myself [\n      ask myself [perform-collision myself]; set last-collision  myself]\n        ;set last-collision myself\n      ]\n  ]\n  ;  ]\n  ;]\nend\n\nto-report balls-belong-to-same-population [ball1 ball2]\n  report [population-num] of ball1 = [population-num] of ball2\nend\n\nto-report collision-heading-change [other-ball]\n  report ifelse-value balls-belong-to-same-population self other-ball\n                       [prop \"ball-heading\"] [prop \"other-ball-heading\"]\nend\n\nto-report collision-speed-change [other-ball]\n  report ifelse-value balls-belong-to-same-population self other-ball\n                       [prop \"ball-speed\"] [prop \"other-ball-speed\"]\nend\n\nto perform-collision-heading-change-with [other-ball]\n  let heading-change collision-heading-change other-ball\n  let speed-change collision-speed-change other-ball\n  (ifelse\n    (heading-change = \"no change\")[]\n    (heading-change = \"turn left\")[  set heading (heading - 90) ask other-ball [set heading (heading - 90)]]\n    (heading-change = \"turn right\")[ set heading (heading + 90 ) ask other-ball [set heading (heading + 90)]]\n    ((heading-change = \"collide\") and (speed-change = \"collide\")) [collide-with other-ball ]   ; changes heading and speed of BOTH  balls\n    ((heading-change = \"attract\") and (speed-change = \"attract\")) [collide-with other-ball ]   ; changes heading and speed of BOTH  balls\n  )\nend\n\nto perform-collision-speed-change-with [other-ball]\n  let speed-change collision-speed-change other-ball\n  let heading-change collision-heading-change other-ball\n  (ifelse\n    (speed-change = \"zero\")    [set speed 0 ask other-ball [set speed 0]]\n    (speed-change = \"increase\")[set speed speed + collision-speed-delta ask other-ball [set speed speed + collision-speed-delta]]\n    (speed-change = \"decrease\")[set speed speed - collision-speed-delta ask other-ball [set speed speed - collision-speed-delta]]\n    ((speed-change = \"collide\") and (heading-change != \"collide\")) or ((speed-change != \"collide\") and (heading-change = \"collide\"))\n                      [user-message (word \"You cannot pair non-collision heading change with collision speed change.\")]\n    ((speed-change = \"attract\") and (heading-change != \"attract\")) or ((speed-change != \"attract\") and (heading-change = \"attract\"))\n                      [user-message (word \"You cannot pair non-attraction heading change with attraction speed change.\")]\n  )\nend\n\n;ball procedure\nto perform-collision [other-ball]\n  perform-collision-heading-change-with other-ball\n  perform-collision-speed-change-with other-ball\nend\n\nto collide-with [other-ball] ;;\n; implements a collision with another ball.\n;;\n; THIS IS THE HEART OF THE PARTICLE SIMULATION, AND YOU ARE STRONGLY ADVISED\n; NOT TO CHANGE IT UNLESS YOU REALLY UNDERSTAND WHAT YOU'RE DOING!\n;;\n; The two balls colliding are self and other-ball, and while the\n; collision is performed from the point of view of self, both balls are\n; modified to reflect its effects. This is somewhat complicated, so I'll\n; give a general outline here:\n;   1. Do initial setup, and determine the heading between ball centers\n;      (call it theta).\n;   2. Convert the representation of the velocity of each ball from\n;      speed/heading to a theta-based vector whose first component is the\n;      ball's speed along theta, and whose second component is the speed\n;      perpendicular to theta.\n;   3. Modify the velocity vectors to reflect the effects of the collision.\n;      This involves:\n;        a. computing the velocity of the center of mass of the whole system\n;           along direction theta\n;        b. updating the along-theta components of the two velocity vectors.\n;   4. Convert from the theta-based vector representation of velocity back to\n;      the usual speed/heading representation for each ball.\n;   5. Perform final cleanup and update derived quantities.\n\n  let mass2 0\n  let speed2 0\n  let heading2 0\n  let theta 0\n  let v1t 0\n  let v1l 0\n  let v2t 0\n  let v2l 0\n  let vcm 0\n\n  ; Step 0 - If one of the populations shouldnt move (==ballsX-forward == FALSE) the other ball should bounce bck (heading = -heading)\n  ; Actually we enter here with myself is moving. Cant be that my balls-forward is FALSE\n  ;refactor\n  let this-ball-is-moving ball-can-move\n  let other-ball-is-moving [ball-can-move] of other-ball\n  let both-balls-are-moving this-ball-is-moving and other-ball-is-moving\n\n  if not this-ball-is-moving [\n    ask other-ball [ set heading heading + 180  ] ; heading is reflected but speed remains the same and my speed+heading doesnt change (but is irrelevt anyway)\n  ]\n\n  if not other-ball-is-moving [\n    set heading  heading + 180  ; heading is reflected but speed remains the same and my speed+heading doesnt change (but is irrelevt anyway)\n  ]\n\n  if both-balls-are-moving\n  [\n\n  ;; PHASE 1: initial setup\n\n  ; for convenience, grab some quantities from other-ball\n  set mass2 [mass] of other-ball\n  set speed2 [speed] of other-ball\n  set heading2 [heading] of other-ball\n\n  ; since balls are modeled as zero-size points, theta isn't meaningfully\n  ; defined. we can assign it randomly without affecting the model's outcome.\n  set theta (random-float 360)\n\n\n\n  ;; PHASE 2: convert velocities to theta-based vector representation\n\n  ; now convert my velocity from speed/heading representation to components\n  ; along theta and perpendicular to theta\n  set v1t (speed * cos (theta - heading))\n  set v1l (speed * sin (theta - heading))\n\n  ; do the same for other-ball\n  set v2t (speed2 * cos (theta - heading2))\n  set v2l (speed2 * sin (theta - heading2))\n\n\n\n  ;; PHASE 3: manipulate vectors to implement collision\n\n  ; compute the velocity of the system's center of mass along theta\n  set vcm (((mass * v1t) + (mass2 * v2t)) / (mass + mass2) )\n\n  ; now compute the new velocity for each ball along direction theta.\n  ; velocity perpendicular to theta is unaffected by a collision along theta,\n  ; so the next two lines actually implement the collision itself, in the\n  ; sense that the effects of the collision are exactly the following changes\n  ; in ball velocity.\n  set v1t (2 * vcm - v1t)\n  set v2t (2 * vcm - v2t)\n\n  ;; PHASE 4: convert back to normal speed/heading\n\n  ; now convert my velocity vector into my new speed and heading\n  set speed sqrt ((v1t * v1t) + (v1l * v1l))\n  ; if the magnitude of the velocity vector is 0, atan is undefined. but\n  ; speed will be 0, so heading is irrelevant anyway. therefore, in that\n  ; case we'll just leave it unmodified.\n   ; make sure speed does not exceed limit\n   if (speed > max-speed) [set speed max-speed]\n   if v1l != 0 or v1t != 0\n    [ set heading (theta - (atan v1l v1t)) ]\n\n  ; and do the same for other-ball\n  ask other-ball [\n    set speed sqrt ((v2t ^ 2) + (v2l ^ 2))\n    if v2l != 0 or v2t != 0\n      [ set heading (theta - (atan v2l v2t)) ]\n  ]\n\n  ]\nend\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GRAVITY;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\nto update-electricity   ; updates the per patch gravity field vector by adding the fields for each ball\n  let ball-pos-x 0\n  let ball-pos-y 0\n  let dist 0\n  let max-electric-strength 10  ; this needs to become a global variable set from a button in the interface\n  let patch-list []\n  set patch-list patches\n\n  ; first null the electric field\n  ask patches [\n     set field-x  0\n     set field-y  0\n  ]\n\n  ask balls\n  [\n      ask patch-list [\n;  [ foreach patch in-radius 10000 [\n    set field-x  field-x + 1\n;    ]\n  ]\n  ]\n;   ; per ball update the electric field in each patch\n ask balls [\n    set ball-pos-x xcor\n    set ball-pos-y ycor\n\n    ask patch-list [\n      set dist  sqrt max ( list ((pxcor - ball-pos-x) ^ 2 + (pycor - ball-pos-y) ^ 2)  1)   ; dist holds distance to patch but does not alllow 0\n\n      set field-x  (field-x +   (pxcor - ball-pos-x) / (dist ^ 3)  * max-electric-strength)\n      set field-y  (field-y +   (pycor - ball-pos-y) / (dist ^ 3)  * max-electric-strength)\n  ]\n  ]\nend\n\nto-report own-population-repels-or-attracts-ball\n  report member? prop \"ball-heading\" [\"repel\" \"attract\" \"repel and attract\"]\nend\n\nto-report other-populations-repel-or-attract-ball\n  let other-populations remove population-num population-numbers\n  foreach other-populations [population -> if population-repels-or-attracts-other-populations? population [report true]]\n  report false\nend\n\nto-report is-ball-affected-by-repel-or-attract-forces\n  report own-population-repels-or-attracts-ball or other-populations-repel-or-attract-ball\nend\n\nto-report balls-of [population]\n  report table:get-or-default population-balls population no-turtles\nend\n\nto apply-force-on [other-balls force]\n  let  mypos-x xcor\n  let  mypos-y ycor\n  let dist 0  ; will be used to calculate distance between balls\n\n  ask other-balls\n  [\n    (ifelse\n      force = \"repel\" [\n        set dist sqrt max ( list ((xcor - mypos-x) ^ 2 + (ycor - mypos-y) ^ 2) 1)  ; dist holds distance to patch but does not alllow 0\n        set force-x-sum  (force-x-sum -   (mypos-x - xcor) / (dist ^ 3)  * repulsion-strength)\n        set force-y-sum  (force-y-sum -   (mypos-x - ycor) / (dist ^ 3)  * repulsion-strength)\n      ]\n\n      force = \"attract\" [\n        set dist  sqrt max ( list ((xcor - mypos-x) ^ 2 + (ycor - mypos-y) ^ 2) 1)  ; dist holds distance to patch but does not alllow 0\n        set force-x-sum  (force-x-sum  +   (mypos-x - xcor) / (dist ^ 3)  * attraction-strength)\n        set force-y-sum  (force-y-sum  +   (mypos-y - ycor) / (dist ^ 3)  * attraction-strength)\n      ]\n\n      force = \"repel and attract\" [\n        set dist  sqrt max ( list ((xcor - mypos-x) ^ 2 + (ycor - mypos-y) ^ 2) 1)  ; dist holds distance to patch but does not alllow 0\n        set LJsigma size  ; set this LJ param to be size of ball\n        let lj-force ((24 * LJeps / LJsigma ^ 2 * ( 2 * (LJsigma / (dist )) ^ 14 - (LJsigma / (dist)) ^ 8 ) ))  ;LJ formula from Eilon's code\n        set force-x-sum  (force-x-sum    - lj-force *  (mypos-x - xcor) / (dist))     ; (xcor - mypos-x) / (dist)  is sin(theta)\n        set force-y-sum  (force-y-sum    - lj-force *  (mypos-y - ycor) / (dist))     ; (ycor - mypos-y) / (dist)  is cos(theta)\n      ]\n    )\n  ]\nend\n\nto apply-forces-acting-on-ball\n  let vx (sin heading * speed) + (force-x-sum * tick-delta)\n  let vy (cos heading * speed) + (force-y-sum * tick-delta)\n  set speed sqrt ((vy ^ 2) + (vx ^ 2))\n  if ((vx != 0) or (vy != 0))  [set heading atan vx vy]\nend\n\nto-report force-vector-acting-on-ball\n  let my-field-x 0 ; null my field data\n  let my-field-y 0 ; null my field data\n  let  mypos-x xcor\n  let  mypos-y ycor\n  let distance-between-balls 0\n  let force 0 ; will hold the LJ force between 2 balls\n\n  ask other balls\n  [\n    let heading-change collision-heading-change myself\n    let speed-change collision-speed-change myself\n\n    if ((heading-change = \"repel\") and (speed-change = \"repel\")) [ ; add repulsion factor to my field\n      set distance-between-balls  sqrt max ( list ((xcor - mypos-x) ^ 2 + (ycor - mypos-y) ^ 2) 1)  ; dist holds distance to patch but does not alllow 0\n      set my-field-x  (my-field-x -   (xcor - mypos-x) / (distance-between-balls ^ 3)  * repulsion-strength)\n      set my-field-y  (my-field-y -   (ycor - mypos-y) / (distance-between-balls ^ 3)  * repulsion-strength)\n    ]\n    if ((heading-change = \"attract\") and (speed-change = \"attract\")) [ ; add attraction factor to my field\n      set distance-between-balls  sqrt max ( list ((xcor - mypos-x) ^ 2 + (ycor - mypos-y) ^ 2) 1)  ; dist holds distance to patch but does not alllow 0\n      set my-field-x  (my-field-x  +   (xcor - mypos-x) / (distance-between-balls ^ 3)  * attraction-strength)\n      set my-field-y  (my-field-y  +   (ycor - mypos-y) / (distance-between-balls ^ 3)  * attraction-strength)\n    ]\n    if ((heading-change = \"repel and attract\") and (speed-change = \"repel and attract\")) [ ; add leonard-Jones factor to my field\n      set distance-between-balls  sqrt max ( list ((xcor - mypos-x) ^ 2 + (ycor - mypos-y) ^ 2) 1)  ; dist holds distance to patch but does not alllow 0\n      set LJsigma size  ; set this LJ param to be size of ball\n      set force ((24 * LJeps / LJsigma ^ 2 * ( 2 * (LJsigma / (distance-between-balls )) ^ 14 - (LJsigma / (distance-between-balls)) ^ 8 ) ))  ;LJ formula from Eilon's code\n      set my-field-x  (my-field-x    - force *  (xcor - mypos-x) / (distance-between-balls))     ; (xcor - mypos-x) / (dist)  is sin(theta)\n      set my-field-y  (my-field-y    - force *  (ycor - mypos-y) / (distance-between-balls))     ; (ycor - mypos-y) / (dist)  is cos(theta)\n    ]\n  ]\n\n  let vx (sin heading * speed) + (my-field-x * tick-delta)\n  let vy (cos heading * speed) + (my-field-y * tick-delta)\n  report (list vx vy)\nend\n\n\n\nto factor-repel-and-attract-forces  ; turtle procedure consider repel and attract forces\n  if is-ball-affected-by-repel-or-attract-forces [\n    let force-vector force-vector-acting-on-ball\n    let vx first force-vector\n    let vy last force-vector\n    set speed sqrt ((vy ^ 2) + (vx ^ 2))\n    if ((vx != 0) or (vy != 0))  [set heading atan vx vy]\n  ]\nend\n\nto apply-electric-field [field-strength]\n  if field-number > 0 [\n    let vx ((sin heading) * speed) + ([field-x] of patch-here * field-strength * tick-delta)\n    let vy ((cos heading) * speed) + ([field-y] of patch-here * field-strength * tick-delta)\n    set speed sqrt ((vy ^ 2) + (vx ^ 2))\n    if ((vx != 0) or (vy != 0))  [set heading atan vx vy]\n  ]\nend\n\nto factor-electric-field\n  apply-electric-field prop \"electric-field\"\nend\n\nto apply-gravity [y-acceleration]  ; turtle procedure\n  apply-force 0 y-acceleration\nend\n\nto apply-force [x y] ; turtle procedure\n  let vx (sin heading * speed) + (x * tick-delta)\n  let vy (cos heading * speed) + (y * tick-delta)\n  set speed sqrt ((vy ^ 2) + (vx ^ 2))\n  set heading atan vx vy\nend\n\nto factor-gravity  ; turtle procedure\n  if is-affected-by-gravity [apply-gravity (- prop \"gravity\")]\nend\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;STICK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n;to stick\n;  set stick-to-wall? true\n;        set leader self\n;  if has-wall [set stuck-on-wall? true]\n;\n;end\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;earser;;;;;;;;;;;;;;;\n\nto setup   ; called from START NEW TASK button\n  ; counting block spaces is slow so keep result between resets\n  ;let tmp-amount-of-block-spaces amount-of-block-spaces\n  clear-all\n  reset-ticks\n  ;set amount-of-block-spaces tmp-amount-of-block-spaces\n  initialize-world\n  update-ball-population-properties-defined-in-nettango-blocks\n  select-next-population-in-properties-ui\n  setup-brush\n  recolor-all-patches\n  display\nend;\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n; LOGGING\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\nto-report delimit [-left delimiter -right]\n  report (word -left delimiter -right)\nend\n\nto-report delimit-comma [-left -right]\n  report delimit -left \",\" -right\nend\n\nto-report delimit-hashtag [-left -right]\n  report delimit -left \",#,\" -right\nend\n\nto-report delimited-population-settings [population -settings]\n  report reduce delimit-comma map [property -> pprop population property] -settings\nend\n\nto-report delimited-all-populations-settings [-settings]\n  report reduce delimit-hashtag map [population -> delimited-population-settings population -settings] population-numbers\nend\n\nto-report delimited-all-populations-numerous-settings [settings-list]\n  report reduce delimit-hashtag map [settings -> delimited-all-populations-settings settings] settings-list\nend\n\nto-report populations-settings-delimited-string\n  let properties [\"size\" \"color\" \"speed\" \"heading\"]\n  let actions [\"move\"]\n  let interactions [\"wall-heading\" \"wall-speed\" \"ball-heading\" \"ball-speed\"\n        \"other-ball-heading\" \"other-ball-speed\" \"gravity\" \"electric-field\"]\n  report delimited-all-populations-numerous-settings (list properties actions interactions)\nend\n\nto-report count-balls-in-population [population]\n  report count balls with [population-num = population]\nend\n\nto-report amount-of-balls-being-traced\n  report count balls with [pen-mode = \"down\"]\nend\n\nto-report delimited-population-count\n  report reduce delimit-comma map count-balls-in-population population-numbers\nend\n\nto-report delimited-log-string\n  report (word populations-settings-delimited-string \",\" amount-of-balls-being-traced \",\" delimited-population-count \",\" background-color)\nend\n\nto-report log-header\n   report (word \" Date = \"  date-and-time \" , Command Name, ticks, ball1-Properties,  balls1-Size,balls1-color,balls1-init-speed,balls1-init-heading,\"\n                \" balls2-Properties , balls2-Size,balls2-color,balls2-init-speed,balls2-init-heading,\"\n                \"balls1-Actions , balls1-forward , balls2-Actions , balls2-forward,\"\n                \" balls1-Interactions, if-hit-wall-heading1,if-hit-wall-speed1,if-meet-ball-heading1,if-meet-ball-speed1\"\n                \", balls2-Interactions,if-hit-wall-heading2,if-hit-wall-speed2,if-meet-ball-heading2,if-meet-ball-speed2 , \"\n                \" balls1&balls2-Interactions ,if-meet-ball-heading ,if-meet-ball-speed , , trace-a-ball? ,num-balls1 , num-balls2 , background-color, Electric-Field-Strength,\"\n                \" Gravity-field \" )\nend\n\nto set-new-log-filename [fileName]\n  let timestamp date-and-time\n  let timestamp-no-colon replace-item 2 timestamp \"-\"\n  set timestamp-no-colon replace-item 5 timestamp-no-colon \"-\"\n  set log-file-name (word fileName \"_\" substring timestamp-no-colon 16 27 \"_\" substring timestamp-no-colon 0 8 \".csv\")\nend\n\nto setup-logging  [fileName]\n  set-new-log-filename fileName\n  if log-enabled [\n    set -log log-header\n    send-to:file log-file-name -log\n  ]\nend\n\nto set-new-log-photo-filename\n  set log-picture-prefix (word substring log-file-name 0 (length log-file-name - 4) \"_\" logged-pictures \".png\")\nend\n\nto log_picture\n  if log-enabled [\n    set-new-log-photo-filename\n    export-view log-picture-prefix\n  ]\nend\n\nto-report test-if-log-output [command-name]\n  ifelse log-enabled [\n    let new-line (word command-name  \",#,\" delimited-log-string)\n    ifelse (new-line = prev-line) [report FALSE] [report TRUE]\n  ] [report false]\nend\n\nto append-to-log [new-log]\n set -log word -log new-log\nend\n\nto log-command [command-name]\n  if (prev-command-name != command-name) [log-output command-name]\nend\n\nto-report time-elapsed\n  report ticks * tick-delta\nend\n\nto log-output [command-name]\n  if log-enabled [\n    append-to-log (word timer \",\" command-name \",\" time-elapsed \",#,\" delimited-log-string)\n    send-to:file log-file-name -log\n  set prev-command-name command-name\n  set prev-line (word command-name  \",#,\"  delimited-log-string)\n  ]\nend\n\nto make-halo  ; runner procedurepaint-world\n  if not has-halo [\n    hatch-halos 1\n    [\n      set size size * 11\n      set color add-transparency yellow 0.75\n      set shape \"halo\"\n      set show-speed false\n      pen-up\n      create-link-from myself\n      [\n        tie\n        hide-link\n      ]\n      contrast-color-to-background\n    ]\n    log-command \"make-halo\"\n  ]\nend\n\nto contrast-color-to-background\n  let -complementary-background-color complementary-color background-color\n  set color -complementary-background-color\n  set label-color -complementary-background-color\nend\n\nto-report convert-to-target-color-model [target to-convert]\n  (ifelse\n    is-rgb target [report to-rgb to-convert]\n    is-rgba target [report to-rgba to-convert]\n    is-netlogo-color target [report to-netlogo-color to-convert]\n    [report false]\n  )\nend\n\nto-report to-netlogo-color [-color]\n  (ifelse\n    is-rgb -color [report approximate-rgb item 0 -color item 1 -color item 2 -color]\n    is-rgba -color [report approximate-rgb item 0 -color item 1 -color item 2 -color]\n    is-netlogo-color -color [report -color]\n    [report false]\n  )\nend\n\nto-report is-netlogo-color [-color]\n  report is-number? -color and -color >= 0 and -color < 140\nend\n\nto-report to-rgb [-color]\n  (ifelse\n    is-rgb -color [report -color]\n    is-rgba -color [report sublist -color 0 3]\n    is-netlogo-color -color [report extract-rgb -color]\n    [report false]\n  )\nend\n\nto-report to-rgba [-color]\n  (ifelse\n    is-rgb -color [report lput 255 -color]\n    is-rgba -color [report -color]\n    is-netlogo-color -color [report lput 255 extract-rgb -color]\n    [report false]\n  )\nend\n\nto-report complementary-color [-color]\n  let -rgba to-rgba -color\n  let complementary-red 255 - (item 0 -rgba)\n  let complementary-green 255 - (item 1 -rgba)\n  let complementary-blue 255 - (item 2 -rgba)\n  let alpha item 3 -rgba\n  let compementary-rgba (list complementary-red complementary-green complementary-blue alpha)\n  report convert-to-target-color-model -color compementary-rgba\nend\n\nto save-existing-layout\n  let file-name user-input \"איזה שם לתת לקובץ?\"\n  export-world (word file-name \".nlogo\")\n  log-command \"save-existing-layout\"\nend\n\nto load-existing-layout\n  fetch:user-file-async [file-name ->\n    if file-name != false [try-import-world-file file-name]]\n  log-command \"load-existing-layout\"\nend\n\nto try-import-world-file [file-name]\n  carefully [\n    import-a:world file-name\n  ] [\n    user-message \"אין אפשרות לטעון את הקובץ\"\n  ]\nend\n\n;patch procedure\nto-report patch-has-wall\n  report has-wall\nend\n\n;patch procedure\nto-report patch-has-balls\n  report count balls-here > 0\nend\n\n;patch procedure\nto-report can-attempt-to-create-wall-in-patch\n  report not patch-has-wall\nend\n\n; patch procedure\nto try-to-push-aside-balls-from-patch\n  ask balls-here [try-to-move-to-closest-unblocked-neighbors4-patch]\nend\n\n;turtle procedure\nto try-to-move-to-closest-unblocked-neighbors4-patch\n  let closest-unblocked-neighbor-patch closest-unblocked-neighbors4-patch self\n  let unblocked-neighbor-exists closest-unblocked-neighbor-patch != nobody\n  if unblocked-neighbor-exists [\n    move-to closest-unblocked-neighbor-patch\n    randomly-move-ball-inside-radius 0.01\n  ]\nend\n\nto-report closest-unblocked-neighbors4-patch [-turtle]\n  let patch-turtle-is-on [patch-here] of -turtle\n  report min-one-of unblocked-neighbor4-patches patch-turtle-is-on [distance patch-turtle-is-on]\nend\n\nto-report unblocked-neighbor4-patches [-patch]\n  report ([neighbors4] of -patch) with [not patch-has-wall]\nend\n\nto-report can-create-wall-in-patch\n  report (not patch-has-wall) and (not patch-has-balls)\nend\n\n;patch procedure\nto create-wall-in-patch\n  if can-attempt-to-create-wall-in-patch [\n    try-to-push-aside-balls-from-patch\n    if can-create-wall-in-patch [\n      set has-wall true\n      recolor-patch\n    ]\n  ]\nend\n\n; patch procedure\nto remove-wall-in-patch\n  if patch-has-wall [\n    set has-wall false\n    recolor-patch\n  ]\nend\n\nto erase-all-balls-of-population-selected-in-ui\n  if is-a-population-selected-in-ui [ask balls-of population-to-set-properties-for-in-ui [remove-ball]]\nend\n\n;======== BRUSH ===========================\n\nto setup-brush\n  set mouse-down?-when-brush-was-last-activated false\n  set mousexy-when-brush-was-last-activated [ ]\n  set patches-drawn-on-since-brush-was-held-down no-patches\n  set current-mousexy (list mouse-xcor mouse-ycor)\n  set current-mouse-down? mouse-down?\n  set current-mouse-inside?  mouse-inside?\n  set brush-in-draw-mode true\n  set brush-style \"free-form\"\n  set brush-shape \"square\"\n  set brush-type \"wall\"\n  set brush-icon-size 4\n  set shape-drawn-by-brush \"rectangle\"\n  set center-patch-of-drawn-shape nobody\n  set patches-affected-by-drawn-shape no-patches\n  set brush-icon-transparency-normalized 0\n  set gfx-displaying-patches-affected-by-drawn-shape no-turtles\n  set brush-size 1\n  create-brush-border-outlines 1 [hide-turtle set -brush-border-outline self]\n  create-brush-cursors 1 [hide-turtle set -brush-cursor self]\n  create-gfx-overlay 1 [set brush-type-icon self\n    set color add-transparency red brush-icon-transparency-normalized\n    setxy (max-pxcor - brush-icon-size - ((brush-icon-size - 1) * 0.5)) (max-pycor - ((brush-icon-size - 1) * 0.5))\n    set size brush-icon-size\n  ]\n  create-gfx-overlay 1 [set brush-draw-erase-mode-icon self\n    set color add-transparency red brush-icon-transparency-normalized\n    setxy (max-pxcor - ((brush-icon-size - 1) * 0.5)) (max-pycor - ((brush-icon-size - 1) * 0.5))\n    set size brush-icon-size\n  ]\n  update-brush-cursor-icon\n  update-brush-type-icon\n  update-brush-add-erase-mode-icon\nend\n\nto draw-with-brush\n  (ifelse\n    brush-style = \"free-form\" [draw-with-free-form-brush]\n    brush-style = \"shape\" [draw-shape-with-brush]\n  )\nend\n\nto draw-shape-with-brush\n  (ifelse\n    is-brush-pressed-down [configure-new-shape-with-brush]\n    brush-is-held-down [configure-current-shape-with-brush]\n    brush-has-been-clicked [draw-shape-configured-by-brush remove-gfx-display-of-patches-to-be-affected-by-drawn-shape log-shape-drawn] )\nend\n\nto set-center-for-drawn-shape\n  set center-patch-of-drawn-shape patch-under-brush\nend\n\nto configure-new-shape-with-brush\n  set-center-for-drawn-shape\n  set patches-affected-by-drawn-shape patch-set patch-under-brush\n  update-display-of-patches-to-be-affected-by-drawn-shape\nend\n\nto configure-current-shape-with-brush\n  if is-new-size-configured-for-drawn-shape [\n    set-patches-to-be-affected-by-current-drawn-shape-configuration\n    update-display-of-patches-to-be-affected-by-drawn-shape\n  ]\nend\n\nto-report is-new-size-configured-for-drawn-shape\n  let current-distance-of-patch-under-brush-from-shape-center [distance center-patch-of-drawn-shape] of patch-under-brush\n  let former-distance-of-patch-under-brush-from-shape-center [distance center-patch-of-drawn-shape] of (patch-at-point mousexy-when-brush-was-last-activated)\n  report current-distance-of-patch-under-brush-from-shape-center != former-distance-of-patch-under-brush-from-shape-center\nend\n\nto update-display-of-patches-to-be-affected-by-drawn-shape\n  remove-gfx-display-of-patches-to-be-affected-by-drawn-shape\n  add-gfx-display-of-patches-to-be-affected-by-drawn-shape\nend\n\nto remove-gfx-display-of-patches-to-be-affected-by-drawn-shape\n  ask gfx-displaying-patches-affected-by-drawn-shape [die]\nend\n\nto add-gfx-display-of-patches-to-be-affected-by-drawn-shape\n  ask patches-affected-by-drawn-shape [display-this-patch-as-affected-by-drawn-shape]\n  ask gfx-displaying-patches-affected-by-drawn-shape [show-turtle]\nend\n\nto display-this-patch-as-affected-by-drawn-shape\n  sprout-gfx-overlay 1 [\n    set shape \"square\"\n    set color yellow\n    set heading 0\n    hide-turtle\n    set gfx-displaying-patches-affected-by-drawn-shape (turtle-set gfx-displaying-patches-affected-by-drawn-shape self)\n  ]\nend\n\nto set-patches-to-be-affected-by-current-drawn-shape-configuration\n  (ifelse\n    shape-drawn-by-brush = \"circle\" [set-patches-to-be-affected-by-current-drawn-circle-configuration ]\n    shape-drawn-by-brush = \"rectangle\" [set-patches-to-be-affected-by-current-drawn-rectangle-configuration ]\n    shape-drawn-by-brush = \"square\" [set-patches-to-be-affected-by-current-drawn-square-configuration ]\n    shape-drawn-by-brush = \"line\" [set-patches-to-be-affected-by-current-drawn-line-configuration ] )\nend\n\nto-report radius-of-circle-drawn-by-brush\n  report max (list [distance-no-wrap center-patch-of-drawn-shape] of patch-under-brush 0.5)\nend\n\nto-report size-of-square-drawn-by-brush\n  report max list (delta-pxcor center-patch-of-drawn-shape patch-under-brush) (delta-pycor center-patch-of-drawn-shape patch-under-brush)\nend\n\nto-report delta-pycor [patch1 patch2]\n  report abs ([pycor] of patch1 - [pycor] of patch2)\nend\n\nto-report delta-pxcor [patch1 patch2]\n  report abs ([pxcor] of patch1 - [pxcor] of patch2)\nend\n\nto set-patches-to-be-affected-by-current-drawn-line-configuration\n  let point1 (list [pxcor] of center-patch-of-drawn-shape [pycor] of center-patch-of-drawn-shape)\n  ;set patches-affected-by-drawn-shape patches-line-intersects point1 current-mousexy\n  set patches-affected-by-drawn-shape patches-line-intersects-no-wrap item 0 point1 item 1 point1 item 0 current-mousexy item 1 current-mousexy\nend\n\nto set-patches-to-be-affected-by-current-drawn-rectangle-configuration\n  let corner-xcor-delta-from-center delta-pxcor center-patch-of-drawn-shape patch-under-brush\n  let corner-ycor-delta-from-center delta-pycor center-patch-of-drawn-shape patch-under-brush\n  let width (corner-xcor-delta-from-center * 2) + 1\n  let height (corner-ycor-delta-from-center * 2) + 1\n  set patches-affected-by-drawn-shape patches-that-form-a-rectangular-border-around-center-patch-no-wrap center-patch-of-drawn-shape width height\nend\n\nto-report point-is-inside-world-no-wrap [point]\n  let -pxcor round first point\n  let -pycor round last point\n  report (-pxcor >= min-pxcor) and (-pxcor <= max-pxcor) and (-pycor >= min-pycor) and (-pycor <= max-pycor)\nend\n\nto-report patches-that-form-a-rectangular-border-around-center-patch-no-wrap [center width height]\n  let height-from-center (height - 1) / 2\n  let width-from-center (width - 1) / 2\n  let top-side-ycor [pycor] of center + height-from-center\n  let bot-side-ycor [pycor] of center - height-from-center\n  let right-side-xcor [pxcor] of center + width-from-center\n  let left-side-xcor [pxcor] of center - width-from-center\n\n  let top-side-patches patch-set map [point -> patch-at-point point]\n    filter point-is-inside-world-no-wrap n-values (width) [x -> (list (left-side-xcor + x) top-side-ycor)]\n  let bottom-side-patches patch-set map [point -> patch-at-point point]\n    filter point-is-inside-world-no-wrap n-values (width) [x -> (list (left-side-xcor + x) bot-side-ycor)]\n  let right-side-patches patch-set map [point -> patch-at-point point]\n    filter point-is-inside-world-no-wrap n-values (height) [y -> (list right-side-xcor (bot-side-ycor + y))]\n  let left-side-patches patch-set map [point -> patch-at-point point]\n    filter point-is-inside-world-no-wrap n-values (height) [y -> (list left-side-xcor (bot-side-ycor + y))]\n\n  report (patch-set top-side-patches bottom-side-patches right-side-patches left-side-patches)\nend\n\nto set-patches-to-be-affected-by-current-drawn-square-configuration\n  let square-size size-of-square-drawn-by-brush\n  let side-length (square-size * 2) + 1\n  set patches-affected-by-drawn-shape patches-that-form-a-rectangular-border-around-center-patch-no-wrap center-patch-of-drawn-shape side-length side-length\nend\n\nto-report in-radius-no-wrap [-patch radius]\n  report distance-no-wrap -patch <= radius\nend\n\nto set-patches-to-be-affected-by-current-drawn-circle-configuration\n  let radius radius-of-circle-drawn-by-brush\n  ;set patches-affected-by-drawn-shape patches with [(distance-no-wrap center-patch-of-drawn-shape > radius - 0.5) and (distance-no-wrap center-patch-of-drawn-shape < radius + 0.5)]\n  set patches-affected-by-drawn-shape patches-that-form-a-circular-border-around-center-patch-no-wrap center-patch-of-drawn-shape radius\nend\n\nto-report patches-that-form-a-circular-border-around-center-patch-no-wrap [center radius]\n  let amount-of-heading-intervals-to-check (radius * 16) ; 16 seems to be a good sampling rate\n  let heading-interval-to-check-for-border-patch (360 / amount-of-heading-intervals-to-check)\n  let potential-patches (patch-set n-values amount-of-heading-intervals-to-check [interval ->\n      [(patch-at-heading-and-distance (interval * heading-interval-to-check-for-border-patch) (radius))] of center])\n  report potential-patches with [(distance-no-wrap center >= radius - 0.5) and (distance-no-wrap center < radius + 0.5)]\nend\n\nto-report distance-no-wrap [-other]\n  report sqrt ((pxcor - [pxcor] of -other) ^ 2 + (pycor - [pycor] of -other) ^ 2)\nend\n\nto-report is-shape-being-configured\n  report has-center-of-drawn-shape-been-set-inside-world\nend\n\nto-report has-center-of-drawn-shape-been-set-inside-world\n  report center-patch-of-drawn-shape != nobody\nend\n\nto-report is-brush-pressed-down\n  report current-mouse-down? and (not mouse-down?-when-brush-was-last-activated)\nend\n\nto draw-with-free-form-brush\n  ifelse brush-is-held-down [\n    on-brush-is-held-down\n    if is-brush-drawing-on-patches-not-drawn-on-since-brush-was-held-down [\n      on-brush-drawing-only-once-per-patch]]\n  [\n    if brush-has-been-clicked [\n      on-brush-has-been-clicked]\n  ]\nend\n\nto-report brush-has-been-clicked\n  report (not brush-is-held-down) and (brush-was-held-down-last-time-brush-was-activated)\nend\n\nto-report brush-was-held-down-last-time-brush-was-activated\n  report mouse-down?-when-brush-was-last-activated\nend\n\nto-report patches-under-brush\n  report patches-affected-by-brush-shape-used-at-patch patch-under-brush\nend\n\nto-report patches-affected-by-brush-shape-used-at-patch [-patch]\n  (ifelse\n    brush-shape = \"circle\" [report patches-affected-by-a-circle-shaped-brush-at-patch -patch]\n    brush-shape = \"square\" [report patches-affected-by-a-square-shaped-brush-at-patch -patch ]\n  )\nend\n\nto-report patches-affected-by-a-circle-shaped-brush-at-patch [-patch]\n  let radius (brush-size / 2)\n  let -center-patch select-closest-patch-that-can-be-surrounded-by-radius-in-world -patch radius\n  let potential-patches patches-affected-by-a-square-shaped-brush-at-patch -center-patch\n  report [potential-patches in-radius radius] of -center-patch\nend\n\nto-report select-closest-patch-that-can-be-surrounded-by-radius-in-world [-patch radius]\n  let -pxcor [pxcor] of -patch\n  let -pycor [pycor] of -patch\n  let result-pxcor -pxcor\n  let result-pycor -pycor\n\n  let min-xcor (min-pxcor - 0.5)\n  let max-xcor (max-pxcor + 0.5)\n  let min-ycor (min-pycor - 0.5)\n  let max-ycor (max-pycor + 0.5)\n\n  let distance-from-min-xcor -pxcor - min-xcor\n  let distance-from-max-xcor max-xcor - -pxcor\n  let distance-from-min-ycor -pycor - min-ycor\n  let distance-from-max-ycor max-ycor - -pycor\n\n  if distance-from-min-xcor < radius [set result-pxcor min-xcor + radius]\n  if distance-from-max-xcor < radius [set result-pxcor max-xcor - radius]\n  if distance-from-min-ycor < radius [set result-pycor min-ycor + radius]\n  if distance-from-max-ycor < radius [set result-pycor max-ycor - radius]\n\n  report patch result-pxcor result-pycor\nend\n\nto-report patches-affected-by-a-square-shaped-brush-at-patch [-patch]\n  let radius (brush-size / 2)\n  let -center-patch select-closest-patch-that-can-be-surrounded-by-radius-in-world -patch radius\n  report (patch-set n-values (brush-size ^ 2) [i -> patch (([pxcor] of -center-patch - (brush-size / 2)) + i mod brush-size) (([pycor] of -center-patch - (brush-size / 2)) + int(i / brush-size))])\nend\n\nto-report patches-brush-is-drawing-on\n    report patch-set [patches-affected-by-brush-shape-used-at-patch self] of patches-brush-moved-over-while-being-held-down\nend\n\nto-report patches-brush-moved-over-while-being-held-down\n  report patches-line-intersects-no-wrap item 0 coordinates-of-brush-when-last-held-down item 1 coordinates-of-brush-when-last-held-down item 0 current-mousexy item 1 current-mousexy\nend\n\nto-report coordinates-of-brush-when-last-held-down\n  report mousexy-when-brush-was-last-activated\nend\n\nto-report newly-drawn-on-patches-brush-is-drawing-on\n  report patch-set patches-brush-is-drawing-on with [not member? self get-patches-drawn-on-since-brush-was-held-down]\nend\n\nto-report patch-under-brush\n  report patch-at-point current-mousexy\nend\n\nto set-brush-style-as-free-form\n  set brush-style \"free-form\"\n  on-user-set-brush-style-to-free-form\nend\n\nto set-brush-style-as-shape\n  set brush-style \"shape\"\n  on-user-set-brush-style-to-shape\nend\n\nto set-brush-shape [-brush-shape]\n  set brush-shape -brush-shape\nend\n\nto set-shape-drawn-by-brush [-shape]\n  set shape-drawn-by-brush -shape\nend\n\nto set-brush-type [-brush-type]\n  set brush-type -brush-type\n  on-brush-type-set\nend\n\nto on-brush-type-set\n  update-brush-type-icon\nend\n\nto on-user-set-brush-style-to-shape\n  ;set-brush-cursor-icon-to-draw\n  update-brush-cursor-icon\n  update-brush-draw-erase-icon\nend\n\nto on-user-set-brush-style-to-free-form\n  update-brush-draw-erase-icon\n  update-brush-cursor-icon\nend\n\nto-report brush-type-already-chosen [-brush-type]\n  report brush-type = -brush-type\nend\n\nto toggle-add-erase\n  set brush-in-draw-mode ifelse-value brush-in-draw-mode = true [false] [true]\nend\n\nto display-brush-border-outline\n  ifelse show-brush-border? [\n    show-brush-border-outline\n    set-brush-border-outline-coordinates\n    set-brush-border-outline-shape\n    set-brush-border-outline-color\n    set-brush-border-outline-size\n    set-brush-border-outline-label ]\n  [\n    hide-brush-border-outline ]\nend\n\nto-report show-brush-border?\n  report (brush-style = \"free-form\" and current-mouse-inside?)\nend\n\nto display-brush-cursor\n  ifelse current-mouse-inside? [\n    set-brush-cursor-icon\n    show-brush-cursor\n    set-brush-cursor-coordinates ]\n  [\n    hide-brush-cursor ]\nend\n\nto set-brush-cursor-icon\n  ifelse brush-in-draw-mode [\n    (ifelse\n      brush-type = \"counter\" [\n        ask -brush-cursor [set shape \"brush-cursor-draw-counter3\" set size 3]\n      ]\n      brush-type = \"halo\" or brush-type = \"halo-speed\" [\n        ask -brush-cursor [set shape \"brush-cursor-draw-halo2\" set size 3]\n      ]\n      brush-type = \"trace\" [\n        ask -brush-cursor [set shape \"brush-cursor-draw-trace2\" set size 3]\n      ]\n    )\n  ] [\n    (ifelse\n      brush-type = \"counter\" [\n        ask -brush-cursor [set shape \"brush-cursor-erase-counter\" set size 3]\n      ]\n      brush-type = \"halo\" or brush-type = \"halo-speed\"[\n        ask -brush-cursor [set shape \"brush-cursor-erase-halo2\" set size 3]\n      ]\n      brush-type = \"trace\" [\n        ask -brush-cursor [set shape \"brush-cursor-erase-trace\" set size 3]\n      ]\n    )\n  ]\nend\n\nto update-brush-type-icon\n  update-brush-type-icon-shape\n  update-brush-type-icon-color\nend\n\nto update-brush-type-icon-shape\n  carefully [\n    ask brush-type-icon [set shape word \"brush-type-icon-\" brush-type] ]\n  [\n    ask brush-type-icon [set shape \"full-square\"]\n  ]\nend\n\nto update-brush-type-icon-color\nend\n\nto set-brush-type-icon-color [-color]\n  ask brush-type-icon [set color add-transparency -color brush-icon-transparency-normalized]\nend\n\nto update-brush-add-erase-mode-icon\n  ifelse is-brush-in-draw-mode [\n    set-brush-draw-erase-icon-to-draw ]\n  [\n    set-brush-draw-erase-icon-to-erase ]\nend\n\nto-report is-brush-in-draw-mode\n  report (brush-in-draw-mode = true)\nend\n\nto-report is-brush-in-erase-mode\n  report not is-brush-in-draw-mode\nend\n\nto-report add-transparency [-color transparency-normalized]\n  let transparency (transparency-normalized * 255)\n  (ifelse\n    is-rgb -color [report add-transparency-rgb -color transparency]\n    is-rgba -color [report add-transparency-rgba -color transparency]\n  )\n  report add-transparency-netlogo-color -color transparency\nend\n\nto-report is-rgb [-color]\n  report (is-list? -color) and (length -color = 3)\nend\n\nto-report is-rgba [-color]\n  report (is-list? -color) and (length -color = 4)\nend\n\nto-report add-transparency-rgb [-color transparency]\n  report lput transparency -color\nend\n\nto-report add-transparency-rgba [-color transparency]\n  report replace-item 3 -color transparency\nend\n\nto-report add-transparency-netlogo-color [-color transparency]\n  report lput transparency extract-rgb -color\nend\n\nto-report rgba-to-hsb [-color]\n  report extract-hsb sublist -color 0 3\nend\n\nto-report set-color-brightness [-color brightness-normalized]\n  let brightness brightness-normalized * 100\n  (ifelse\n    is-rgb -color [report set-rgb-brightness -color brightness]\n    is-rgba -color [report set-rgba-brightness -color brightness]\n  )\n  report set-netlogo-color-brightness -color brightness\nend\n\nto-report set-rgb-brightness [-color brightness]\n  let -hsb extract-hsb -color\n  let hue item 0 -hsb\n  let saturation  item 1 -hsb\n  report hsb hue saturation brightness\nend\n\nto-report set-rgba-brightness [-color brightness]\n  let -hsb extract-hsb sublist -color 0 3\n  let hue item 0 -hsb\n  let saturation  item 1 -hsb\n  let alpha item 3 -color\n  report lput alpha hsb hue saturation brightness\nend\n\nto-report set-netlogo-color-brightness [-color brightness]\n  let -hsb extract-hsb -color\n  let hue item 0 -hsb\n  let saturation  item 1 -hsb\n  report approximate-hsb hue saturation brightness\nend\n\nto hide-brush-cursor\n  ask -brush-cursor [hide-turtle]\nend\n\nto show-brush-cursor\n  ask -brush-cursor [show-turtle]\nend\n\nto set-brush-cursor-coordinates\n  (ifelse\n    brush-style = \"free-form\" [set-brush-free-form-cursor-coordinates-and-heading]\n    brush-style = \"shape\" [set-brush-shape-cursor-coordinates]\n  )\nend\n\nto-report brush-cursor-near-top-right-corner-of-world\n  report brush-cursor-near-right-edge-of-world and brush-cursor-near-top-edge-of-world\nend\n\nto-report brush-cursor-near-top-edge-of-world\n  report last current-mousexy + [size / 2] of -brush-cursor > max-pycor - 0.35\nend\n\nto-report brush-cursor-near-right-edge-of-world\n  report first current-mousexy + [size / 2] of -brush-cursor > max-pxcor - 0.35\nend\n\nto-report current-mouse-xcor\n  report item 0 current-mousexy\nend\n\nto-report current-mouse-ycor\n  report item 1 current-mousexy\nend\n\nto set-brush-free-form-cursor-coordinates-and-heading\n  let new-heading 0\n  let new-xcor current-mouse-xcor\n  let new-ycor current-mouse-ycor\n  (ifelse\n    brush-cursor-near-top-right-corner-of-world [\n      set new-heading 180\n      set new-xcor current-mouse-xcor - 1.5\n      set new-ycor current-mouse-ycor - 1.5\n    ]\n    brush-cursor-near-top-edge-of-world [\n      set new-heading 90\n      set new-xcor current-mouse-xcor + 1.5\n      set new-ycor current-mouse-ycor - 1.5\n    ]\n    brush-cursor-near-right-edge-of-world [\n      set new-heading 270\n      set new-xcor current-mouse-xcor - 1.5\n      set new-ycor current-mouse-ycor + 1.5\n    ]\n    [\n      set new-heading 0\n      set new-xcor current-mouse-xcor + 1.5\n      set new-ycor current-mouse-ycor + 1.5\n    ]\n  )\n  ask -brush-cursor [set heading new-heading]\n  carefully [ ask -brush-cursor [set xcor new-xcor] ] []\n  carefully [ ask -brush-cursor [set ycor new-ycor] ] []\nend\n\nto set-brush-shape-cursor-coordinates\n  carefully [ ask -brush-cursor [set xcor ([pxcor] of patch-under-brush)]] []\n  carefully [ ask -brush-cursor [set ycor ([pycor] of patch-under-brush)]] []\nend\n\nto display-brush-gfx\n  display-brush-border-outline\n  display-brush-cursor\n  ;diplay-brush-xy-as-label-on-brush-mode-icon\n  make-sure-brush-gets-updated-in-display-atleast-every 0.005\nend\n\nto make-sure-brush-gets-updated-in-display-atleast-every [seconds]\n  if brush-activated-after-model-was-advanced [ every seconds [display] ]\n  ;update-display-every-given-time-interval-if-ticks-have-not-advanced-since-brush-was-last-activated seconds\nend\n\nto diplay-brush-xy-as-label-on-brush-mode-icon\n  ifelse current-mouse-inside? [\n    ask brush-draw-erase-mode-icon [set label (word [pxcor] of patch-under-brush \", \" [pycor] of patch-under-brush) ] ]\n  [\n    ask brush-draw-erase-mode-icon [set label \"\"]\n  ]\nend\n\nto set-brush-border-outline-label\n  ;ask patch 0 min-pycor [set plabel brush-type]\nend\n\nto set-brush-border-outline-coordinates\n  let radius (brush-size / 2)\n  let -center-patch select-closest-patch-that-can-be-surrounded-by-radius-in-world patch-under-brush radius\n  (ifelse\n    brush-shape = \"square\" [ ;offset brush for even sizes since patch under brush can not be center\n      carefully [\n        ask -brush-border-outline [setxy ([pxcor] of -center-patch - 0.5 * ((brush-size + 1) mod 2)) ([pycor] of -center-patch - 0.5 * ((brush-size + 1) mod 2))]] [] ]\n    brush-shape = \"circle\" [ask -brush-border-outline [setxy [pxcor] of -center-patch [pycor] of -center-patch]])\nend\n\nto hide-brush-border-outline\n  ask -brush-border-outline [hide-turtle]\nend\n\nto show-brush-border-outline\n  ask -brush-border-outline [show-turtle]\nend\n\nto set-brush-border-outline-shape\n  (ifelse\n    brush-shape = \"square\" [ask -brush-border-outline [set shape \"square outline thick\"] ]\n    brush-shape = \"circle\" [ask -brush-border-outline [set shape \"circle outline\"] ])\nend\n\nto set-brush-border-outline-color\n  ifelse is-brush-in-draw-mode [\n    ask -brush-border-outline [set color cyan] ]\n  [\n    ask -brush-border-outline [set color red] ]\nend\n\nto set-brush-border-outline-size\n  ask -brush-border-outline [set size brush-size]\nend\n\nto activate-brush\n  set-brush-state\n  display-brush-gfx\n  draw-with-brush\n  run-animations\n  keep-track-of-current-brush-state\nend\n\nto set-brush-state\n  set current-mousexy (list mouse-xcor mouse-ycor)\n  set current-mouse-down? mouse-down?\n  set current-mouse-inside? mouse-inside?\n  if is-brush-pressed-down [set mouse-xy-when-brush-was-pressed-down current-mousexy]\nend\n\nto keep-track-of-current-brush-state\n  update-which-patches-have-been-affected-by-brush-since-it-was-held-down\n  set mouse-down?-when-brush-was-last-activated current-mouse-down?\n  set mousexy-when-brush-was-last-activated current-mousexy\n  set brush-activated-after-model-was-advanced true\nend\n\nto-report brush-is-held-down\n  report current-mouse-down?\nend\n\nto update-which-patches-have-been-affected-by-brush-since-it-was-held-down\n  ifelse brush-is-held-down [\n    set patches-drawn-on-since-brush-was-held-down (patch-set patches-drawn-on-since-brush-was-held-down\n      patches-brush-is-drawing-on) ]\n  [\n    set patches-drawn-on-since-brush-was-held-down no-patches ]\nend\n\nto-report is-brush-drawing-on-patches-not-drawn-on-since-brush-was-held-down\n  report any? newly-drawn-on-patches-brush-is-drawing-on\nend\n\nto-report get-patches-drawn-on-since-brush-was-held-down\n  report patches-drawn-on-since-brush-was-held-down\nend\n\nto user-set-brush-to-draw\n  set brush-in-draw-mode true\n  on-user-set-brush-to-draw\nend\n\nto user-set-brush-to-erase\n  set brush-in-draw-mode false\n  on-user-set-brush-to-erase\nend\n\nto on-user-set-brush-to-draw\n  ;set-brush-draw-erase-icon-to-draw\n  update-brush-draw-erase-icon\n  set-brush-cursor-icon-to-draw\nend\n\nto on-user-set-brush-to-erase\n  ;set-brush-draw-erase-icon-to-erase\n  update-brush-draw-erase-icon\n  set-brush-icon-to-erase\nend\n\nto update-brush-draw-erase-icon\n  (ifelse\n    brush-style = \"shape\" [set-brush-draw-erase-icon-as-current-shape-drawn-by-brush ]\n    brush-style = \"free-form\" [set-brush-draw-erase-icon-for-free-form-brush ])\nend\n\nto set-brush-draw-erase-icon-as-current-shape-drawn-by-brush\n  ask brush-draw-erase-mode-icon [set shape (word \"brush-mode-icon-\" shape-drawn-by-brush)]\nend\n\nto set-brush-draw-erase-icon-for-free-form-brush\n  ifelse is-brush-in-draw-mode [set-brush-draw-erase-icon-to-draw] [set-brush-draw-erase-icon-to-erase]\nend\n\nto set-brush-cursor-icon-to-draw\n  ask -brush-cursor [set shape \"brush-cursor-draw6\" set size 3]\nend\n\nto set-brush-icon-to-erase\n  ask -brush-cursor [set shape \"brush-cursor-erase\" set size 3]\nend\n\nto set-brush-cursor-icon-to-shape-configure\n  ask -brush-cursor [set shape \"brush-cursor-shape\" set size 4]\nend\n\nto update-brush-cursor-icon\n  (ifelse\n    brush-style = \"shape\" [set-brush-cursor-icon-to-shape-configure ]\n    is-brush-in-draw-mode [set-brush-cursor-icon-to-draw ]\n    [set-brush-icon-to-erase ] )\nend\n\nto set-brush-draw-erase-icon-to-draw\n  ask brush-draw-erase-mode-icon [set shape \"brush-mode-icon-draw2\"]\nend\n\nto set-brush-draw-erase-icon-to-erase\n  ask brush-draw-erase-mode-icon [set shape \"brush-mode-icon-erase\"]\nend\n\n;==== Brush functions unique to this model ======\n\nto draw-shape-configured-by-brush\n  if brush-type = \"wall\" [draw-shape-with-wall]\nend\n\nto draw-shape-with-wall\n  create-wall-in-patches patches-affected-by-drawn-shape\nend\n\nto on-brush-is-held-down\n  (ifelse\n    brush-type = \"ball\" [on-brush-held-down-with-ball ]\n    brush-type = \"halo\" [on-brush-held-down-with-halo ]\n    brush-type = \"halo-speed\" [on-brush-held-down-with-halo-speed ]\n    brush-type = \"trace\" [on-brush-held-down-with-trace ]\n    brush-type = \"field\" [on-brush-held-down-with-field]\n  )\nend\n\nto on-brush-held-down-with-halo-speed\n  ifelse is-brush-in-draw-mode [add-halo-speed-to-balls balls-in-patches-brush-is-drawing-on] [remove-halo-speed-from-balls balls-in-patches-brush-is-drawing-on]\nend\n\nto add-halo-speed-to-balls [-balls]\n  ask -balls with [not has-halo] [make-halo]\n  let -halos (turtle-set [get-halo] of -balls)\n  ask -halos [set show-speed true]\n  ask -balls [add-halo-speed]\n  ;set marked-balls (turtle-set marked-balls balls-in-patches-brush-is-drawing-on)\nend\n\nto add-halo-speed\n  ask get-halo [update-halo-speed]\n  ;ask get-halo-speed [update-halo-speed]\nend\n\nto remove-halo-speed-from-balls [-balls]\n  ask -balls with [has-halo and [show-speed] of get-halo = true] [remove-halo]\n  ;set marked-balls marked-balls with [not member? self -balls]\nend\n\nto on-brush-drawing-only-once-per-patch\n  (ifelse\n    brush-type = \"wall\" [on-brush-used-with-wall ]\n    brush-type = \"counter\" [on-brush-used-with-counter ] )\nend\n\nto on-brush-has-been-clicked\n  (ifelse\n    brush-type = \"ball\" [on-brush-clicked-with-ball ]\n    brush-type = \"field\" [on-brush-clicked-with-field ]\n    brush-type = \"trace\" [on-brush-clicked-with-trace ]\n  )\n  log-free-form-brush-used\nend\n\nto log-free-form-brush-used\n  log-output (word ifelse-value is-brush-in-draw-mode [\"paint-\"] [\"erase-\"] brush-type)\nend\n\nto log-shape-drawn\n  log-output (word \"place-\" shape-drawn-by-brush)\nend\n\nto on-brush-clicked-with-trace\n  if not is-brush-in-draw-mode [clear-drawing]\nend\n\nto on-brush-clicked-with-field\n  ifelse is-brush-in-draw-mode [finalize-field-configuration-with-brush] [erase-field-number-under-brush]\nend\n\nto erase-field-number-under-brush\n  if [has-field] of patch-under-brush [erase-field [field-number] of patch-under-brush]\nend\n\nto on-brush-held-down-with-field\n  if is-brush-in-draw-mode [create-field-with-brush]\nend\n\nto create-field-with-brush\n  ifelse is-brush-currently-configuring-a-field [\n    configure-current-field-with-brush ]\n  [\n    configure-new-field-with-brush\n  ]\nend\n\nto-report is-brush-currently-configuring-a-field\n  report length patches-brush-drew-electric-field-on > 0\nend\n\nto-report has-electric-field\n  report field-number != 0\nend\n\nto-report new-electric-field-number\n  report (max [field-number] of patches) + 1\nend\n\nto configure-new-field-with-brush\n  if not [has-wall] of patch-under-brush and not [has-electric-field] of patch-under-brush[\n    set patches-brush-drew-electric-field-on lput patch-under-brush patches-brush-drew-electric-field-on\n    ask patch-under-brush [set field-number new-electric-field-number]\n    configure-current-field-with-brush\n  ]\nend\n\nto-report is-first-patch-electric-field-drawn-on\n  report length patches-brush-drew-electric-field-on = 1\nend\n\nto-report before-last [-list]\n  let -length length -list\n  report item (-length - 2) -list\nend\n\nto configure-current-field-with-brush\n  let field-x-value 0\n  let field-y-value 0\n  let prev-mouse-xcor item 0 mousexy-when-brush-was-last-activated\n  let prev-mouse-ycor item 1 mousexy-when-brush-was-last-activated\n  let electric-field-count [field-number] of one-of patches-brush-drew-electric-field-on\n  if patch-under-brush != last patches-brush-drew-electric-field-on [\n    set patches-brush-drew-electric-field-on lput patch-under-brush patches-brush-drew-electric-field-on]\n\n  if not [has-wall] of patch-under-brush [\n    ifelse is-first-patch-electric-field-drawn-on [\n      set field-x-value (mouse-xcor - [pxcor] of patch-under-brush)\n      set field-y-value (mouse-ycor - [pycor] of patch-under-brush)\n    ] [\n      set field-x-value (mouse-xcor - [pxcor] of before-last patches-brush-drew-electric-field-on)\n      set field-y-value (mouse-ycor - [pycor] of before-last patches-brush-drew-electric-field-on)\n    ]\n    if (field-x-value != 0 or field-y-value != 0 ) [ ; mouse moved from prev location\n      ask patch-under-brush [\n        set field-number electric-field-count\n        set field-x field-x-value  / (sqrt ((field-x-value ^ 2) + (field-y-value ^ 2)))\n        set field-y field-y-value  / (sqrt ((field-x-value ^ 2) + (field-y-value ^ 2)))\n        draw-arrow-in-direction-of-electric-field\n      ]\n      ;paint-arrow this-patch\n      set prev-mouse-xcor mouse-xcor\n      set prev-mouse-ycor mouse-ycor\n    ]\n  ]\nend\n\nto finalize-field-configuration-with-brush\n  if is-brush-currently-configuring-a-field [\n    create-electric-field-in-direction-configured-by-brush\n    set patches-brush-drew-electric-field-on []\n    log-command \"paint-field\"\n  ]\nend\n\nto-report balls-in-patches [-patches]\n  report (turtle-set [balls-here] of patches-brush-is-drawing-on)\nend\n\nto-report balls-in-patches-brush-is-drawing-on\n  report balls-in-patches patches-brush-is-drawing-on\nend\n\nto on-brush-used-with-counter\n  if is-brush-pressed-down [\n    set-counter-number-to-be-drawn-with-brush ]\n  ifelse is-brush-in-draw-mode [create-counters-in-patches patches-brush-is-drawing-on] [remove-counters-from-patches patches-brush-is-drawing-on]\nend\n\nto remove-counters-from-patches [-patches]\n  ask -patches [remove-counter-from-patch]\nend\n\nto create-counters-in-patches [-patches]\n  ask -patches [create-counter-in-patch]\nend\n\n;patch procedure\nto remove-counter-from-patch\n  if has-counter [\n    let counter-number-removed counter-number-here\n    ask counters-here [die]\n    on-counter-removed-from-patch counter-number-removed\n  ]\nend\n\nto-report ball-count-in-population [population]\n  report count balls-of population\nend\n\nto on-counter-removed-from-patch [counter-number-removed]\n  update-position-of-counter-information counter-number-removed\nend\n\nto-report can-create-counter-in-patch\n  report (not has-wall) and (not has-counter)\nend\n\n;patch procedure\nto create-counter-in-patch\n  if can-create-counter-in-patch [\n    sprout-counters 1 [\n      set shape  \"counter\"\n      ;set color counter-color\n      ;let hsb-color extract-hsb item counter-number-drawn-by-brush base-colors\n      ;set hsb-color replace-item 1 hsb-color 100\n      ;set hsb-color replace-item 2 hsb-color 100\n      set color (item ((counter-number-drawn-by-brush - 1) mod length default-colors-for-ball-populations) default-colors-for-ball-populations) + 2\n      set number counter-number-drawn-by-brush\n      set heading 0\n    ]\n    on-counter-added-to-patch\n  ]\nend\n\n;patch procedure\nto-report counter-number-here\n  report [number] of one-of counters-here\nend\n\nto-report create-counter-number-gfx [-counter-number]\n  let -counter-number-gfx sprout-initialized-gfx-overlay\n  ask -counter-number-gfx [set label word \"Area: \" -counter-number]\n  report -counter-number-gfx\nend\n\nto-report create-initialized-counter-information-gfx-overlay [-counter-number]\n  let counter-information table:make\n  table:put counter-information \"counter-number\" create-counter-number-gfx -counter-number\n  table:put counter-information \"ball-count\" sprout-initialized-gfx-overlay\n  report counter-information\nend\n\nto-report ball-count-in-counter [-counter-number]\n  report table:get-or-default counter-value -counter-number 0\nend\n\nto-report ball-count-gfx [-counter-number]\n  report table:get get-counter-information -counter-number \"ball-count\"\nend\n\nto-report counter-number-gfx [-counter-number]\n  report table:get get-counter-information -counter-number \"counter-number\"\nend\n\nto update-ball-count-in-counter [-counter-number]\n  ask ball-count-gfx -counter-number [set label (word \"Count: \" ball-count-in-counter -counter-number)]\nend\n\n; patch procedure\nto-report sprout-initialized-gfx-overlay\n  let gfx-overlay-created nobody\n  sprout-gfx-overlay 1 [set gfx-overlay-created self hide-turtle set shape \"empty\"]\n  report gfx-overlay-created\nend\n\nto increase-counter [-counter-number]\n  increment-table-value counter-value -counter-number 1\n  update-ball-count-in-counter -counter-number\nend\n\nto-report has-counter-been-initialized [-counter-number]\n  report table:has-key? counter-value -counter-number\nend\n\nto initialize-counter-information-if-not-initialized-yet [-counter-number]\n  if not has-counter-been-initialized -counter-number [\n    table:put counters-information-gfx -counter-number create-initialized-counter-information-gfx-overlay -counter-number\n    table:put counter-value -counter-number 0\n    update-ball-count-in-counter -counter-number\n  ]\nend\n\n;patch procedure\nto on-counter-added-to-patch\n  initialize-counter-information-if-not-initialized-yet counter-number-here\n  update-position-of-counter-information counter-number-here\nend\n\nto-report counters-of [-counter-number]\n  report counters with [number = -counter-number]\nend\n\nto-report counters-with-counter-number-exist [-counter-number]\n  report any? counters-of -counter-number\nend\n\nto-report get-counter-information [-counter-number]\n  report table:get counters-information-gfx -counter-number\nend\n\nto hide-counter-information [-counter-number]\n  ask counter-number-gfx -counter-number [hide-turtle]\n  ask ball-count-gfx -counter-number [hide-turtle]\nend\n\nto-report center-turtle [-turtles]\n  let mean-xcor mean [xcor] of -turtles\n  let mean-ycor mean [ycor] of -turtles\n  report min-one-of -turtles [distancexy mean-xcor mean-ycor]\nend\n\nto set-counter-information-in-center [-counter-number]\n  let center-counter center-turtle counters-of -counter-number\n  let center-counter-xcor [xcor] of center-counter\n  let center-counter-ycor [ycor] of center-counter\n  carefully [\n    ask counter-number-gfx -counter-number [setxy center-counter-xcor center-counter-ycor show-turtle]\n    ask ball-count-gfx -counter-number [setxy center-counter-xcor (center-counter-ycor - 1) show-turtle]\n  ][]\nend\n\nto update-position-of-counter-information [-counter-number]\n  ifelse not counters-with-counter-number-exist -counter-number [\n    hide-counter-information -counter-number]\n  [\n    set-counter-information-in-center -counter-number\n  ]\nend\n\n;patch procedure\nto-report has-counter\n  report count counters-here > 0\nend\n\nto-report counter-number-of-closest-neighbor-of-patches-brush-is-drawing-on-to-mouse-xy\n  report 0\nend\n\nto-report highest-counter-number-in-use\n  report max [number] of counters\nend\n\nto-report highest-counter-number\n  report max table:keys counter-value\nend\n\nto-report any-counters-created-so-far\n  report table:length counter-value > 0\nend\n\nto-report new-highest-counter-number\n  report ifelse-value any-counters-created-so-far [highest-counter-number + 1] [1]\nend\n\nto-report one-of-patches-brush-is-drawing-on-has-a-counter\n  report count patches-brush-is-drawing-on with [has-counter] > 0\nend\n\nto-report counter-number-in-patch-brush-is-drawing-on-closest-to-mouse-xy\n  report [counter-number-here] of min-one-of patches-brush-is-drawing-on with [has-counter] [distancexy item 0 current-mousexy item 1 current-mousexy]\nend\n\nto set-counter-number-to-be-drawn-with-brush\n  ifelse one-of-patches-brush-is-drawing-on-has-a-counter [\n    set counter-number-drawn-by-brush counter-number-in-patch-brush-is-drawing-on-closest-to-mouse-xy]\n  [\n    set counter-number-drawn-by-brush new-highest-counter-number\n  ]\nend\n\nto on-brush-held-down-with-trace\n  ifelse is-brush-in-draw-mode [trace-balls-brush-is-drawing-on] [stop-tracing balls-in-patches-brush-is-drawing-on]\nend\n\nto trace-balls-brush-is-drawing-on\n  set marked-balls (turtle-set marked-balls balls-in-patches-brush-is-drawing-on)\n  ;marker-added-to-ball balls-in-patches-brush-is-drawing-on\n  let balls-to-trace balls-in-patches-brush-is-drawing-on; with [pen-mode != \"down\"]\n  ask balls-to-trace [flash-outline 5 white]\n  trace balls-to-trace\nend\n\nto on-brush-held-down-with-halo\n  ifelse is-brush-in-draw-mode [add-halo-to-balls balls-in-patches-brush-is-drawing-on] [remove-halo-from-balls balls-in-patches-brush-is-drawing-on]\nend\n\nto on-brush-clicked-with-ball\n  if is-brush-in-draw-mode [create-balls-of-population-selected-in-ui]\nend\n\nto on-brush-held-down-with-ball\n  if is-brush-in-erase-mode [remove-balls-from-patches-brush-is-drawing-on]\nend\n\nto remove-balls-from-patches-brush-is-drawing-on\n  ask balls-in-patches-brush-is-drawing-on [remove-ball]\nend\n\nto create-balls-of-population-selected-in-ui\n  if is-a-population-selected-in-ui [\n    ;update-interactively-ball-population-property-settings\n    create-balls-if-under-maximum-capacity population-to-set-properties-for-in-ui number-of-balls-to-add mouse-xcor mouse-ycor\n  ]\nend\n\nto-report number-of-balls-to-add\n  report כדורים-להוספה\nend\n\nto on-brush-used-with-wall\n  ifelse is-brush-in-draw-mode [create-wall-in-patches patches-brush-is-drawing-on] [remove-wall-from-patches patches-brush-is-drawing-on]\nend\n\nto on-erase-wall-brush-button-clicked\n  if is-first-time-radio-button-is-pressed-down \"erase\" [\n    set-brush-style-as-free-form\n    user-set-brush-to-erase\n    set-brush-type \"wall\"\n  ]\n  if should-release-brush-radio-button? \"erase\" [stop]\n  ifelse סוג-מברשת = \"שדה חשמלי\" [\n    set-brush-type \"field\" ]\n  [\n    set-brush-type \"wall\"\n  ]\n  activate-brush\nend\n\nto on-draw-wall-brush-button-clicked\n  if is-first-time-radio-button-is-pressed-down \"wall\" [\n    user-set-brush-to-draw\n  ]\n  if should-release-brush-radio-button? \"wall\" [stop]\n  ifelse סוג-מברשת = \"שדה חשמלי\" [\n    set-brush-type \"field\" ]\n  [\n    set-brush-type \"wall\"\n  ]\n  ifelse סוג-מברשת = \"קיר\" or סוג-מברשת = \"שדה חשמלי\" [\n    set-brush-style-as-free-form\n    set brush-size 1\n  ] [\n    set-shape-drawn-by-brush wall-shape-hebrew-to-english סוג-מברשת\n    set-brush-style-as-shape\n  ]\n  activate-brush\nend\n\nto-report wall-shape-hebrew-to-english [hebrew]\n  (ifelse\n    hebrew = \"ריבוע\" [report \"square\"]\n    hebrew = \"מעגל\" [report \"circle\"]\n    hebrew = \"קו\" [report \"line\"]\n    hebrew = \"שדה חשמלי\" [report \"field\"]\n  )\nend\n\nto on-erase-marker-brush-button-clicked\n  update-marker\n  if סמן = \"ללא סמן\" [\n    stop\n  ]\n  if is-first-time-radio-button-is-pressed-down \"erase-mark\" [\n    set-brush-style-as-free-form ]\n  if should-release-brush-radio-button? \"erase-mark\" [stop]\n  set-brush-type marker-hebrew-to-english סמן\n  user-set-brush-to-erase\n  (ifelse\n    brush-type = \"counter\" [set brush-size 2]\n    brush-type = \"halo\" [set brush-size 2]\n    brush-type = \"halo-speed\" [set brush-size 2]\n    brush-type = \"trace\" [set brush-size 2]\n  )\n  activate-brush\nend\n\nto-report marker-hebrew-to-english [hebrew]\n  (ifelse\n    hebrew = \"הילה\" [report \"halo\"]\n    hebrew = \"עקבות של כדור\" [report \"trace\"]\n    hebrew = \"מונה כדורים\" [report \"counter\"]\n    hebrew = \"שדה חשמלי\" [report \"field\"]\n    hebrew = \"הילה עם מהירות\" [report \"halo-speed\"]\n  )\nend\n\nto on-draw-marker-brush-button-clicked\n  update-marker\n  if סמן = \"ללא סמן\" [\n    stop\n  ]\n  if is-first-time-radio-button-is-pressed-down \"draw-mark\" [\n    set-brush-style-as-free-form\n  ]\n  if should-release-brush-radio-button? \"draw-mark\" [stop]\n  set-brush-type marker-hebrew-to-english סמן\n  user-set-brush-to-draw\n  (ifelse\n    brush-type = \"counter\" [set brush-size 2]\n    brush-type = \"halo\" [set brush-size 2]\n    brush-type = \"halo-speed\" [set brush-size 2]\n    brush-type = \"trace\" [set brush-size 2]\n  )\n  activate-brush\nend\n\nto on-wall-brush-button-clicked\n  if is-first-time-radio-button-is-activated \"wall\" [\n    set-brush-type \"wall\"\n    set-brush-style-as-free-form ]\n  if should-release-brush-radio-button? \"wall\" [stop]\n  activate-brush\nend\n\nto on-field-brush-button-clicked\n  if is-first-time-radio-button-is-activated \"field\" [\n    set-brush-type \"field\"\n    set-brush-style-as-free-form\n  ]\n  if should-release-brush-radio-button? \"field\" [stop]\n  activate-brush\nend\n\nto on-counter-brush-button-clicked\n  if is-first-time-radio-button-is-activated \"counter\" [\n    set-brush-type \"counter\"\n    set-brush-style-as-free-form\n  ]\n  if should-release-brush-radio-button? \"counter\" [stop]\n  activate-brush\nend\n\nto on-trace-brush-button-clicked\n  if should-release-brush-radio-button? \"trace\" [stop]\n  set-brush-type \"trace\"\n  set-brush-style-as-free-form\n  activate-brush\nend\n\nto on-halo-brush-button-clicked\n  if should-release-brush-radio-button? \"halo\" [stop]\n  set-brush-type \"halo\"\n  set-brush-style-as-free-form\n  activate-brush\nend\n\nto on-ball-brush-button-clicked\n  if should-release-brush-radio-button? \"ball\" [stop]\n  set-brush-type \"ball\"\n  set brush-size 1\n  user-set-brush-to-draw\n  set-brush-style-as-free-form\n  activate-brush\nend\n\nto on-wall-line-brush-button-clicked\n  if should-release-brush-radio-button? \"wall-line\" [stop]\n  set-brush-type \"wall\"\n  set-shape-drawn-by-brush \"line\"\n  set-brush-style-as-shape\n  activate-brush\nend\n\nto on-wall-rectangle-brush-button-clicked\n  if should-release-brush-radio-button? \"wall-rectangle\" [stop]\n  set-brush-type \"wall\"\n  set-shape-drawn-by-brush \"rectangle\"\n  set-brush-style-as-shape\n  activate-brush\nend\n\nto on-wall-circle-brush-button-clicked\n  if should-release-brush-radio-button? \"wall-circle\" [stop]\n  set-brush-type \"wall\"\n  set-shape-drawn-by-brush \"circle\"\n  set-brush-style-as-shape\n  activate-brush\nend\n\nto on-wall-square-brush-button-clicked\n  if is-first-time-radio-button-is-activated \"wall-square\" [\n    set-brush-type \"wall\"\n    set-shape-drawn-by-brush \"square\"\n    set-brush-style-as-shape\n  ]\n  if should-release-brush-radio-button? \"wall-square\" [stop]\n  activate-brush\nend\n\n\n;=========================\n\nto create-wall-in-patches [-patches]\n  foreach sort-patches-by-proximity-to-their-most-center-patch -patches [-patch -> ask -patch [create-wall-in-patch]]\nend\n\nto-report sort-patches-by-proximity-to-their-most-center-patch [-patches]\n  let -center-patch center-agent-world-wrap -patches\n  report sort-by [ [patch1 patch2] -> (distance-between-patches patch1 -center-patch) < (distance-between-patches patch2 -center-patch)] -patches\nend\n\nto-report distance-between-patches [patch1 patch2]\n  report [distance patch2] of patch1\nend\n\nto-report center-agent-world-wrap [-patches]\n  report min-one-of -patches [sum-distances-to-patches -patches]\nend\n\n;patch-procedure\nto-report sum-distances-to-patches [-patches]\n  let patch-to-calculate-distance-from self\n  report sum [distance-between-patches patch-to-calculate-distance-from self] of -patches\nend\n\nto remove-wall-from-patches [-patches]\n  ask -patches [remove-wall-in-patch]\nend\n\n;ball procedure\nto-report has-halo\n  report get-halo != nobody\nend\n\n;ball procedure\nto-report get-halo\n  let retreived-halo nobody\n  let links-to-halos my-links with [is-halo? other-end]\n  if any? links-to-halos [set retreived-halo [other-end] of one-of links-to-halos]\n  report retreived-halo\nend\n\nto-report my-halos\n  report turtle-set [other-end] of my-links with [is-halo? other-end]\nend\n\n;ball procedure\nto remove-halo\n  ask my-halos [die]\n  ;ask my-halo-speeds [die]\nend\n\n;ball procedure\nto remove-ball\n  remove-halo\n  kill-existing-compound-shapes\n  ; ask a patch to kill ball so code can be executed after ball dies\n  ask patch-here [\n    ask myself [die]\n    ; put any code here that needs to be executed after balls death\n    ;update-ball-population-plot\n  ]\nend\n\nto remove-all-balls\n  ask balls [remove-ball]\nend\n\nto remove-halo-from-balls [-balls]\n  ask -balls with [has-halo and [show-speed] of get-halo = false] [remove-halo]\n  ;set marked-balls marked-balls with [not member? self -balls]\nend\n\nto add-halo-to-balls [-balls]\n  ;let balls-without-halo -balls with [not has-halo]\n  ask -balls [make-halo]\n  let -halos (turtle-set [get-halo] of -balls)\n  ask -halos [set show-speed false]\n  ;set marked-balls (turtle-set marked-balls -balls)\nend\n\n;turtle procedure\nto trace [-turtles]\n  ask -turtles [pen-down]\nend\n\n;turtle procedure\nto stop-tracing [-turtles]\n  ask -turtles [flash-outline 5 (red + 2)]\n  ask -turtles [pen-up]\n  set marked-balls marked-balls with [not member? self -turtles]\nend\n\nto-report patch-at-point [point]\n  report patch first point last point\nend\n\n;===== INTERSECTION MATH ==================\n\nto-report patches-line-intersects-no-wrap [x1 y1 x2 y2]\n  let -start patch x1 y1\n  let -stop patch x2 y2\n  let neighbors-stop [neighbors-no-wrap] of -stop\n  let result (patch-set -start)\n  if -start != -stop [\n    let -heading heading-between-points x1 y1 x2 y2\n    let current-patch -start\n    while [current-patch != -stop and not member? current-patch neighbors-stop] [\n      set current-patch min-one-of ([neighbors-no-wrap with [not member? self result]] of current-patch)\n      [abs (-heading - (heading-between-points x1 y1 pxcor pycor))]\n      set result (patch-set result current-patch)\n    ]\n  ]\n  report (patch-set result -stop)\nend\n\nto-report heading-between-points [x1 y1 x2 y2]\n  report ((90 - atan (y2 - y1) (x2 - x1) ) mod 360)\nend\n\n;========= AST TREE ======================\n\nto-report path-to-node-from-root [node]\n  report reverse fput node-name node ancestors-names node\nend\n\nto-report ancestors-names [node]\n  report map node-name ancestors-of node\nend\n\nto-report ancestors-of [node]\n  let path-to-root []\n  let curr-node node\n  loop [\n   set path-to-root lput curr-node path-to-root\n   ifelse is-root-node curr-node [\n     report but-first path-to-root\n   ] [\n     set curr-node node-parent curr-node\n   ]\n  ]\nend\n\nto-report first-node-by-name [name]\n  report first filter [node -> node-name node = name] nodes-by-id\nend\n\nto-report node-name [node]\n  report table:get node \"name\"\nend\n\nto-report node-id [node]\n  report table:get node \"id\"\nend\n\nto-report node-parent [node]\n  report item node-parent-id node nodes-by-id\nend\n\nto-report node-parent-id [node]\n  report table:get node \"parent-id\"\nend\n\nto-report node-parameters [node]\n  report table:get node \"parameters\"\nend\n\nto-report node-parameter [node parameter]\n  report table:get node-parameters node parameter\nend\n\nto-report node-children [node]\n  report table:get node \"children\"\nend\n\nto-report child-by-name [node name]\n  report one-of filter [child -> node-name child = name] node-children node\nend\n\nto-report child-by-index [node index]\n  report item index node-children node\nend\n\nto validate-node-has-only-children-named [node valid-names]\n  let name node-name node\n  let children node-children node\n  let invalid-children filter [child -> not member? node-name child valid-names] children\n  if not empty? invalid-children [\n    let invalid-children-names map node-name invalid-children\n    let message (word \"'\" name \"' contains invalid block\" ifelse-value length invalid-children-names = 1\n      [(word \": '\" first invalid-children-names \"'\")] [(word \"s: \" invalid-children-names)] )\n    throw-ast-error first invalid-children message\n  ]\nend\n\nto validate-node-has-exactly-n-children [node amount]\n  let name node-name node\n  let children node-children node\n  let amount-of-children length children\n  if amount-of-children != amount [\n    let message (word \"'\" name \"' needs to have exactly \" amount\n      \" children. Current children count is \" amount-of-children \": \" children)\n    throw-ast-error node message\n  ]\nend\n\nto validate-only-one-of-children-exists [node names]\n  let name node-name node\n  let children node-children node\n  let children-names map [child -> node-name child] children\n  let name-intersection filter [element -> member? element children-names] (remove-duplicates names)\n  let names-are-invalid length name-intersection > 1\n  if names-are-invalid [\n    let message (word \"'\" name \"' can only have one of these blocks exist: \" name-intersection)\n    throw-ast-error node message\n  ]\nend\n\nto validate-no-duplicate-children-named [node names]\n  let name node-name node\n  let children node-children node\n  let children-names map node-name children\n  let name-count table:counts children-names\n  let duplicate-names filter [key -> table:get name-count key > 1] table:keys name-count\n  if not empty? duplicate-names [\n    let message (word \"'\" name \"' can not have duplicate names: \" duplicate-names)\n    throw-ast-error node message\n  ]\nend\n\nto validate-has-one-of-ancestors [node ancestors]\n  let name node-name node\n  let has-one-of-ancestors not empty? filter [ancestor -> member? ancestor ancestors] ancestors-names node\n  if not has-one-of-ancestors [\n    let message (word \"'\" name \"' must be a descendent of: \" ancestors)\n    throw-ast-error node message\n  ]\nend\n\nto reset-ast\n  set ast-root table:make\n  set current-node false\n  set last-added-node false\n  ;set nodes-by-id []\n  ;set id-counter 0\nend\n\nto print-ast-nodes-parents\n  foreach nodes-by-id [ node ->\n    let name table:get node \"name\"\n    let parent-name \"\"\n    ifelse not is-root-node node [\n      let parent-id table:get node \"parent-id\"\n      let parent-node item parent-id nodes-by-id\n      set parent-name table:get parent-node \"name\"\n    ] [\n      set parent-name \"[root]\"\n    ]\n    print (word name \" \" parent-name)\n  ]\nend\n\nto print-path-to-node [src dest]\n  let x string-builder-path-to-node src dest 0\n  foreach x print\nend\n\nto-report string-path-to-node [src dest]\n  let x string-builder-path-to-node src dest 0\n  report reduce [[result next] -> (word result \"\\n\" next)] x\nend\n\nto-report parameter-descriptor [node]\n  let parameter-values table:values node-parameters node\n  report ifelse-value not empty? parameter-values [\n    reduce [[result next] -> (word result \" \" next)] parameter-values\n  ] [\n    \"\" ]\nend\n\nto-report string-builder-path-to-node [src dest indent]\n  let path []\n  let name node-name src\n  let parameters node-parameters src\n  let children node-children src\n  let -parameter-descriptor parameter-descriptor src\n  let src-descriptor \"\"\n  ifelse src = dest [\n    set src-descriptor (word char-repeat \">\" (indent * 2) name \" \" -parameter-descriptor \"\\t <--- Error here!\") ]\n  [\n    set src-descriptor (word char-repeat \".\" (indent * 4) name \" \" -parameter-descriptor) ]\n  set path fput src-descriptor path\n  foreach filter-nodes-above dest children [ child ->\n    let child-descriptor string-builder-path-to-node child dest (indent + 1)\n    foreach child-descriptor [x -> set path lput x path]\n  ]\n  report path\nend\n\nto-report filter-nodes-above [node other-nodes]\n  let nodes-above []\n  foreach other-nodes [ other-node ->\n    set nodes-above lput other-node nodes-above\n    if member? other-node ancestors-of node [report nodes-above]\n  ]\n  report nodes-above\nend\n\nto-report char-repeat [char -length]\n  let string \"\"\n  if -length > 0 [\n    repeat -length [\n      set string (word string char)\n    ]\n  ]\n  report string\nend\n\nto-report is-root-node [node]\n  report not table:has-key? node \"parent-id\"\nend\n\nto throw-ast-error [node message]\n  let x (word \"Error parsing node '\" node-name node \"'\\n\" message \"\\n\")\n    ;\"Path to block: \" reduce [[result next] -> (word result \" -> \" next)] path-to-node-from-root node)\n  set x (word x \"\\n\" string-path-to-node table:get blocks 1 node)\n  error x\nend\n\nto increment-table-value [dict key increment]\n  let value table:get-or-default dict key 0\n  table:put dict key value + increment\nend\n\nto-report last-n-elements [-list n]\n  let -length length -list\n  report ifelse-value n < -length [sublist -list (-length - n) -length] [-list]\nend\n\nto-report tables-are-equal [t1 t2]\n  report table-as-list t1 = table-as-list t2\nend\n\nto-report table-as-list [element]\n  (ifelse\n    is-table element [report map [key -> (list key (table-as-list table:get element key))] table:keys element ]\n    is-list? element [report map [list-element -> table-as-list list-element] element]\n    [report element]\n  )\nend\n\nto-report is-table [t]\n  ; this procedure is not correct but we currently assume that an element in a table can only be\n  ; one of 5 values: table, string, number, list or boolean\n  ; need to check if there is a way to get object type\n  report (not is-string? t) and (not is-number? t) and (not is-list? t) and (not is-boolean? t)\nend\n\nto-report is-table2 [t]\n  ; this procedure runs extremely slow\n  let -is-table false\n  carefully [\n    let x table:has-key? t \"1\"\n    set -is-table true ]\n  [ ]\n  report -is-table\nend\n\nto-report copy-table [orig]\n  let copy table:make\n  foreach (table:keys orig) [key -> table:put copy key (table:get orig key)]\n  report copy\nend\n\nto increase-depth\n  set current-node last-added-node\nend\n\nto decrease-depth\n  set current-node get-parent-node current-node\nend\n\nto-report get-parent-node [node]\n  let parent-id table:get node \"parent-id\"\n  report item parent-id nodes-by-id\nend\n\nto add-node [name parameters]\n  let node create-node name parameters\n  ifelse is-ast-empty [\n    set-as-root-node-in-ast node\n  ] [\n    add-child-to-currently-selected-node node\n  ]\n  set last-added-node node\nend\n\nto set-as-root-node-in-ast [node]\n  set ast-root node\n  set current-node node\nend\n\nto-report create-node [name parameters]\n  let node table:from-list (list\n    (list \"id\" id-counter)\n    (list \"name\" name)\n    (list \"parameters\" table:from-list parameters)\n    (list \"children\" [])\n  )\n  set nodes-by-id lput node nodes-by-id\n  set id-counter id-counter + 1\n  report node\nend\n\nto-report is-ast-empty\n  report table:length ast-root = 0\nend\n\nto add-child-to-currently-selected-node [node]\n  table:put node \"parent-id\" table:get current-node \"id\"\n  let updated-children lput node table:get current-node \"children\"\n  table:put current-node \"children\" updated-children\nend\n\n; --- NETTANGO BEGIN ---\n\n; This block of code was added by the NetTango builder.  If you modify this code\n; and re-import it into the NetTango builder you may lose your changes or need\n; to resolve some errors manually.\n\n; If you do not plan to re-import the model into the NetTango builder then you\n; can safely edit this code however you want, just like a normal NetLogo model.\n\n; Code for קבוצה 1\nto configure-population-1\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 1))\nadd-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" (nt:get \"__ntb-defs-0-canvas_0_26_0\")))\n] decrease-depth\nadd-node \"actions\" []\nincrease-depth if true [\n] decrease-depth\nadd-node \"interactions\" []\nincrease-depth if true [\n] decrease-depth\ntable:put curr-ast-by-population 1 ast-root\nend\n\n; Code for קבוצה 2\nto configure-population-2\n  reset-ast\n  add-node \"configure-population\" (list (list \"population\" 2))\nadd-node \"properties\" []\nincrease-depth if true [\n  add-node \"name\" (list (list \"name\" \"\"))\n] decrease-depth\nadd-node \"actions\" []\nincrease-depth if true [\n] decrease-depth\nadd-node \"interactions\" []\nincrease-depth if true [\n] decrease-depth\ntable:put curr-ast-by-population 2 ast-root\nend\n; --- NETTANGO END ---\n@#$#@#$#@\nGRAPHICS-WINDOW\n286\n10\n791\n515\n-1\n-1\n9.53\n1\n14\n1\n1\n1\n0\n1\n1\n1\n-26\n26\n-26\n26\n1\n1\n1\nticks\n30\n\nSLIDER\n118\n331\n240\n364\nכדורים-להוספה\nכדורים-להוספה\n1\n100\n10\n1\n1\nNIL\nHORIZONTAL\n\nBUTTON\n58\n10\n175\n56\nמשימה חדשה\nsetup\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n1\n\nBUTTON\n294\n549\n396\n582\nהתחלה/עצירה\ngo\nT\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nBUTTON\n122\n104\n223\n164\nבחירת צבע רקע\nset-background-color-button-clicked\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n1\n\nBUTTON\n34\n372\n119\n405\nמחיקת כדורים\nclear-drawing\\nerase-all-balls-of-population-selected-in-ui\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nBUTTON\n129\n635\n230\n668\nשמירת מודל\nsave-existing-layout\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nBUTTON\n23\n635\n124\n668\nטעינת מודל\nload-existing-layout\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nINPUTBOX\n21\n104\n118\n164\nצבע-רקע\n0\n1\n0\nColor\n\nBUTTON\n22\n240\n118\n276\nמחיקה\non-erase-wall-brush-button-clicked\nT\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nBUTTON\n125\n372\n217\n405\nהוספת כדורים\non-ball-brush-button-clicked\nT\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nTEXTBOX\n106\n78\n157\n103\nציור\n18\n105\n1\n\nINPUTBOX\n21\n174\n118\n234\nצבע-מברשת\n105\n1\n0\nColor\n\nSWITCH\n134\n501\n265\n534\nהתנגשויות-בקיר\nהתנגשויות-בקיר\n0\n1\n-1000\n\nSLIDER\n11\n331\n110\n364\nמספר-קבוצה\nמספר-קבוצה\n1\n2\n1\n1\n1\nNIL\nHORIZONTAL\n\nBUTTON\n34\n411\n217\n444\nמחיקת כל הכדורים\nclear-drawing\\nremove-all-balls\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nTEXTBOX\n100\n302\n197\n324\nכדורים\n18\n105\n1\n\nTEXTBOX\n99\n469\n199\n491\nסמנים\n18\n105\n1\n\nTEXTBOX\n81\n607\n231\n629\nהפעלת מודל\n18\n105\n1\n\nBUTTON\n403\n549\n466\n582\nצעד\ngo\nNIL\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nTEXTBOX\n514\n539\n625\n561\nמספר כדורים\n18\n105\n1\n\nTEXTBOX\n680\n539\n786\n561\nפגיעות בקיר\n18\n105\n1\n\nMONITOR\n498\n565\n560\n610\nקבוצה 1\ncount balls with [population-num = 1]\n17\n1\n11\n\nMONITOR\n568\n565\n630\n610\nקבוצה 2\ncount balls with [population-num = 2]\n17\n1\n11\n\nMONITOR\n660\n565\n722\n610\nקבוצה 1\nwall-collisions-count 1\n17\n1\n11\n\nMONITOR\n732\n565\n794\n610\nקבוצה 2\nwall-collisions-count 2\n17\n1\n11\n\nBUTTON\n48\n545\n131\n578\nמחיקת סמן\non-erase-marker-brush-button-clicked\nT\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nCHOOSER\n9\n496\n131\n541\nסמן\nסמן\n\"ללא סמן\" \"הילה\" \"הילה עם מהירות\" \"עקבות של כדור\" \"מונה כדורים\"\n0\n\nBUTTON\n135\n545\n224\n578\nציור סמן\non-draw-marker-brush-button-clicked\nT\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nBUTTON\n123\n240\n219\n276\nציור\non-draw-wall-brush-button-clicked\nT\n1\nT\nOBSERVER\nNIL\nNIL\nNIL\nNIL\n0\n\nCHOOSER\n127\n181\n219\n226\nסוג-מברשת\nסוג-מברשת\n\"קיר\" \"מעגל\" \"ריבוע\" \"קו\" \"שדה חשמלי\"\n0\n@#$#@#$#@\n## WHAT IS IT?\n\n(a general understanding of what the model is trying to show or explain)\n\n## HOW IT WORKS\n\n(what rules the agents use to create the overall behavior of the model)\n\n## HOW TO USE IT\n\n(how to use the model, including a description of each of the items in the Interface tab)\n\n## THINGS TO NOTICE\n\n(suggested things for the user to notice while running the model)\n\n## THINGS TO TRY\n\n(suggested things for the user to try to do (move sliders, switches, etc.) with the model)\n\n## EXTENDING THE MODEL\n\n(suggested things to add or change in the Code tab to make the model more complicated, detailed, accurate, etc.)\n\n## NETLOGO FEATURES\n\n(interesting or unusual features of NetLogo that the model uses, particularly in the Code tab; or where workarounds were needed for missing features)\n\n## RELATED MODELS\n\n(models in the NetLogo Models Library and elsewhere which are of related interest)\n\n## CREDITS AND REFERENCES\n\n(a reference to the model's URL on the web if it has one, as well as any other necessary credits, citations, and links)\n@#$#@#$#@\ndefault\ntrue\n0\nPolygon -7500403 true true 150 5 40 250 150 205 260 250\n\nairplane\ntrue\n0\nPolygon -7500403 true true 150 0 135 15 120 60 120 105 15 165 15 195 120 180 135 240 105 270 120 285 150 270 180 285 210 270 165 240 180 180 285 195 285 165 180 105 180 60 165 15\n\narrow\ntrue\n0\nPolygon -7500403 true true 150 0 0 150 105 150 105 293 195 293 195 150 300 150\n\nball\ntrue\n0\nCircle -7500403 true true 90 90 120\nCircle -16777216 false false 90 90 120\n\nbattery\nfalse\n9\nRectangle -7500403 true false 14 90 284 210\nRectangle -2674135 true false 255 90 285 210\nRectangle -2674135 true false 30 90 30 210\nRectangle -16777216 true false 15 90 45 210\nRectangle -13791810 false true 164 151 195 147\nRectangle -1 true false 25 137 31 161\nRectangle -1 true false 259 141 280 148\nRectangle -1 true false 18 146 40 153\n\nbox\nfalse\n0\nPolygon -7500403 true true 150 285 285 225 285 75 150 135\nPolygon -7500403 true true 150 135 15 75 150 15 285 75\nPolygon -7500403 true true 15 75 15 225 150 285 150 135\nLine -16777216 false 150 285 150 135\nLine -16777216 false 150 135 15 75\nLine -16777216 false 150 135 285 75\n\nbrush-cursor-draw-counter\ntrue\n7\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -7500403 true false 15 15 30 60\nRectangle -7500403 true false 16 -1 121 104\nLine -16777216 false 43 104 43 -1\nLine -16777216 false 97 104 97 -1\nLine -16777216 false 16 24 121 24\nLine -16777216 false 17 77 122 77\nPolygon -13840069 true false 70 39 82 30 83 67 88 66 88 72 73 71 73 66 78 66 78 38 73 43\nRectangle -13840069 true false 57 48 62 64\nRectangle -13840069 true false 51 54 68 59\n\nbrush-cursor-draw-counter2\ntrue\n7\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -7500403 true false 15 15 30 60\nRectangle -7500403 true false -14 -31 105 90\nLine -16777216 false 13 89 15 -30\nLine -16777216 false 75 90 75 -30\nLine -16777216 false -15 15 105 15\nLine -16777216 false -15 60 105 60\n\nbrush-cursor-draw-counter3\ntrue\n7\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -7500403 true false 15 15 30 60\nRectangle -7500403 true false 16 -1 121 104\nLine -16777216 false 15 75 120 75\nLine -16777216 false 15 30 120 30\nLine -16777216 false 45 105 45 0\nLine -16777216 false 90 105 90 0\n\nbrush-cursor-draw-halo\ntrue\n7\nCircle -1184463 false false -107 178 212\nCircle -1184463 false false -107 178 212\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\n\nbrush-cursor-draw-halo2\ntrue\n7\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\nCircle -1184463 false false 48 3 85\n\nbrush-cursor-draw-trace\ntrue\n7\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -2674135 true false 75 69 115 10 124 74 179 9 182 14 121 86 112 23 77 74\nCircle -13791810 true false 20 54 72\n\nbrush-cursor-draw-trace2\ntrue\n7\nPolygon -2674135 true false 65 81 147 9 152 15 68 89\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\nCircle -13791810 true false 3 62 80\n\nbrush-cursor-draw6\ntrue\n7\nPolygon -1184463 true false 195 45 225 45 255 75 255 105 75 270 75 240 45 210 45 210 15 210 195 45\nPolygon -16777216 false false 15 210 195 45 225 45 255 75 255 105 75 270 75 240 45 210 15 210\nLine -16777216 false 225 45 45 210\nLine -16777216 false 255 75 75 240\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 15 210 0 285 75 270 75 240 45 210 15 210\nPolygon -16777216 false false 15 210 0 285 75 270 75 240 45 210 15 210\n\nbrush-cursor-erase\ntrue\n0\nPolygon -16777216 false false 75 195\nPolygon -2064490 true false 30 270 135 270 240 165 225 120 135 120 45 195 30 270\nLine -16777216 false 30 270 135 270\nLine -16777216 false 135 195 135 270\nLine -16777216 false 135 270 240 165\nLine -16777216 false 240 165 225 120\nLine -16777216 false 135 195 225 120\nLine -16777216 false 45 195 135 195\nLine -16777216 false 45 195 30 270\nLine -16777216 false 45 195 135 120\nLine -16777216 false 135 120 225 120\n\nbrush-cursor-erase-counter\ntrue\n6\nPolygon -16777216 false false 75 195\nPolygon -2064490 true false 30 270 135 270 240 165 225 120 135 120 45 195 30 270\nLine -16777216 false 30 270 135 270\nLine -16777216 false 135 195 135 270\nLine -16777216 false 135 270 240 165\nLine -16777216 false 240 165 225 120\nLine -16777216 false 135 195 225 120\nLine -16777216 false 45 195 135 195\nLine -16777216 false 45 195 30 270\nLine -16777216 false 45 195 135 120\nLine -16777216 false 135 120 225 120\nRectangle -7500403 true false -15 15 90 120\nLine -16777216 false 15 120 15 15\nLine -16777216 false 60 120 60 15\nLine -16777216 false 90 45 -15 45\nLine -16777216 false 90 90 -15 90\n\nbrush-cursor-erase-halo\ntrue\n0\nCircle -1184463 false false -105 165 210\nCircle -1184463 false false -105 165 210\nPolygon -16777216 false false 75 195\nPolygon -2064490 true false 30 270 135 270 240 165 225 120 135 120 45 195 30 270\nLine -16777216 false 30 270 135 270\nLine -16777216 false 135 195 135 270\nLine -16777216 false 135 270 240 165\nLine -16777216 false 240 165 225 120\nLine -16777216 false 135 195 225 120\nLine -16777216 false 45 195 135 195\nLine -16777216 false 45 195 30 270\nLine -16777216 false 45 195 135 120\nLine -16777216 false 135 120 225 120\n\nbrush-cursor-erase-halo2\ntrue\n0\nPolygon -16777216 false false 75 195\nPolygon -2064490 true false 30 270 135 270 240 165 225 120 135 120 45 195 30 270\nLine -16777216 false 30 270 135 270\nLine -16777216 false 135 195 135 270\nLine -16777216 false 135 270 240 165\nLine -16777216 false 240 165 225 120\nLine -16777216 false 135 195 225 120\nLine -16777216 false 45 195 135 195\nLine -16777216 false 45 195 30 270\nLine -16777216 false 45 195 135 120\nLine -16777216 false 135 120 225 120\nCircle -1184463 false false 18 63 85\n\nbrush-cursor-erase-trace\ntrue\n0\nPolygon -2674135 true false 75 83 148 25 153 31 79 89\nPolygon -16777216 false false 75 195\nPolygon -2064490 true false 30 270 135 270 240 165 225 120 135 120 45 195 30 270\nLine -16777216 false 30 270 135 270\nLine -16777216 false 135 195 135 270\nLine -16777216 false 135 270 240 165\nLine -16777216 false 240 165 225 120\nLine -16777216 false 135 195 225 120\nLine -16777216 false 45 195 135 195\nLine -16777216 false 45 195 30 270\nLine -16777216 false 45 195 135 120\nLine -16777216 false 135 120 225 120\nCircle -13791810 true false 5 69 86\n\nbrush-cursor-shape\nfalse\n0\nCircle -13840069 true false 116 116 67\nRectangle -13840069 true false 138 143 243 158\nRectangle -13840069 true false 46 143 151 158\nRectangle -13840069 true false 142 43 157 148\nRectangle -13840069 true false 143 146 158 251\nCircle -16777216 true false 128 128 44\n\nbrush-cursor-shape3\nfalse\n0\nRectangle -13840069 true false 125 126 132 176\nRectangle -13840069 true false 125 169 177 176\nRectangle -13840069 true false 170 125 178 176\nRectangle -13840069 true false 125 125 177 132\nRectangle -13840069 true false 171 146 220 154\nRectangle -13840069 true false 82 146 131 154\nRectangle -13840069 true false 147 80 155 129\nRectangle -13840069 true false 147 170 155 219\n\nbrush-mode-icon-circle\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nCircle -13791810 true false 23 26 254\nCircle -7500403 true false 45 49 210\nRectangle -16777216 false false 0 0 300 300\n\nbrush-mode-icon-draw-circle\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nCircle -13345367 true false -2 -2 302\nCircle -7500403 true false 30 30 240\nPolygon -1184463 true false 210 30 240 30 270 60 270 90 90 255 90 225 60 195 60 195 30 195 210 30\nPolygon -16777216 false false 30 195 210 30 240 30 270 60 270 90 90 255 90 225 60 195 30 195\nLine -16777216 false 240 30 60 195\nLine -16777216 false 270 60 90 225\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 30 195 15 270 90 255 90 225 60 195 30 195\nPolygon -16777216 false false 30 195 15 270 90 255 90 225 60 195 30 195\n\nbrush-mode-icon-draw-circle3\nfalse\n5\nRectangle -7500403 true false 0 0 300 300\nCircle -13345367 true false 23 23 255\nCircle -7500403 true false 45 45 210\nRectangle -16777216 false false 0 0 300 300\n\nbrush-mode-icon-draw2\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nPolygon -1184463 true false 210 30 240 30 270 60 270 90 90 255 90 225 60 195 60 195 30 195 210 30\nPolygon -16777216 false false 30 195 210 30 240 30 270 60 270 90 90 255 90 225 60 195 30 195\nLine -16777216 false 240 30 60 195\nLine -16777216 false 270 60 90 225\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 30 195 15 270 90 255 90 225 60 195 30 195\nPolygon -16777216 false false 30 195 15 270 90 255 90 225 60 195 30 195\nRectangle -16777216 false false 0 0 300 300\n\nbrush-mode-icon-erase\nfalse\n6\nRectangle -7500403 true false 0 0 300 300\nPolygon -16777216 false false 75 195\nPolygon -2064490 true false 45 225 150 225 255 120 240 75 150 75 60 150 45 225\nLine -16777216 false 45 225 150 225\nLine -16777216 false 150 150 150 225\nLine -16777216 false 150 225 255 120\nLine -16777216 false 255 120 240 75\nLine -16777216 false 150 150 240 75\nLine -16777216 false 60 150 150 150\nLine -16777216 false 60 150 45 225\nLine -16777216 false 60 150 150 75\nLine -16777216 false 150 75 240 75\nRectangle -16777216 false false 0 0 300 300\n\nbrush-mode-icon-line\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nPolygon -13791810 true false 46 246 241 36 256 51 61 261 46 246\n\nbrush-mode-icon-rectangle\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nRectangle -13791810 true false 23 80 278 230\nRectangle -7500403 true false 42 100 259 209\nRectangle -16777216 false false 0 0 300 300\n\nbrush-mode-icon-square\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nRectangle -13791810 true false 40 41 268 268\nRectangle -7500403 true false 68 70 239 241\nRectangle -16777216 false false 0 0 300 300\n\nbrush-type-icon-ball\nfalse\n9\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nCircle -16777216 true false 93 89 118\nCircle -955883 true false 94 90 116\n\nbrush-type-icon-ball2\nfalse\n15\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nCircle -1184463 false false 41 42 220\nCircle -11221820 true false 124 19 50\nCircle -955883 true false 92 88 120\nCircle -11221820 true false 40 187 50\nCircle -11221820 true false 213 186 50\n\nbrush-type-icon-counter\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nLine -16777216 false 60 0 60 300\nLine -16777216 false 240 0 240 315\nLine -16777216 false 0 60 315 60\nLine -16777216 false 0 240 300 240\nRectangle -13840069 true false 139 152 159 219\nRectangle -13840069 true false 124 219 174 235\nPolygon -13840069 true false 159 137 125 162 125 184 159 163\nRectangle -13840069 true false 65 190 116 205\nRectangle -13840069 true false 83 173 98 223\nCircle -16777216 true false 147 52 85\nCircle -955883 true false 148 53 83\nLine -16777216 false 172 33 154 18\nLine -16777216 false 136 45 105 20\nLine -16777216 false 122 83 107 73\n\nbrush-type-icon-field\nfalse\n7\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nPolygon -13345367 true false 60 195 180 195 180 150 256 216 180 285 180 240 180 240 60 240 60 195\nLine -16777216 false 45 60 75 60\nLine -16777216 false 90 60 135 60\nLine -16777216 false 135 60 150 60\nCircle -955883 true false 158 42 94\nLine -16777216 false 135 90 120 90\nLine -16777216 false 147 120 105 120\nLine -16777216 false 90 120 60 120\nLine -16777216 false 60 90 30 90\nLine -16777216 false 105 90 60 90\nLine -16777216 false 50 120 40 120\n\nbrush-type-icon-halo\nfalse\n9\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nCircle -16777216 true false 93 89 118\nCircle -955883 true false 94 90 116\nCircle -1184463 false false 33 33 234\n\nbrush-type-icon-halo2\nfalse\n9\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nCircle -16777216 true false 88 84 128\nCircle -955883 true false 89 85 126\nCircle -1184463 false false 32 31 238\n\nbrush-type-icon-trace\nfalse\n9\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nPolygon -13840069 true false 150 165 191 253 228 209 255 270 245 275 270 285 272 258 262 264 232 194 193 237 157 160\nCircle -16777216 true false 87 83 110\nCircle -955883 true false 88 84 108\n\nbrush-type-icon-trace3\nfalse\n9\nRectangle -7500403 true false 0 0 300 300\nRectangle -16777216 false false 0 0 300 300\nPolygon -2674135 true false 45 195 15 270\nPolygon -2674135 true false 132 150 174 247 218 191 258 263 249 271 273 280 276 252 266 259 220 170 176 225 143 142\nCircle -16777216 true false 63 58 128\nCircle -955883 true false 64 59 126\n\nbrush-type-icon-wall\nfalse\n6\nRectangle -1 true false 0 0 300 300\nRectangle -13345367 true false 15 225 150 285\nRectangle -13345367 true false 165 225 300 285\nRectangle -13345367 true false 75 150 210 210\nRectangle -13345367 true false 0 150 60 210\nRectangle -13345367 true false 225 150 300 210\nRectangle -13345367 true false 166 75 301 135\nRectangle -13345367 true false 15 75 150 135\nRectangle -13345367 true false 0 0 60 60\nRectangle -13345367 true false 225 0 300 60\nRectangle -13345367 true false 75 0 210 60\nPolygon -6459832 true false 123 155 207 261 221 265 234 251 235 238 147 136 123 155\nPolygon -7500403 true false 140 147 155 133 149 116 150 109 154 104 168 97 190 91 179 78 154 82 127 93 101 111 88 122 92 129 93 131 91 135 87 136 83 134 78 129 59 145 57 157 78 181 88 187 109 168 104 161 103 154 105 155 105 152 105 152 112 155 116 161\nPolygon -16777216 false false 178 79 188 90 152 104 149 108 149 117 155 133 147 139 130 152 115 161 111 154 104 153 102 156 108 167 88 187 78 181 56 155 59 146 76 129 85 137 89 139 92 131 88 122 129 91 156 82 176 78\nPolygon -16777216 false false 150 138 234 238 234 252 220 263 206 260 125 157\nRectangle -16777216 false false 0 0 300 300\n\nbug\ntrue\n0\nCircle -7500403 true true 96 182 108\nCircle -7500403 true true 110 127 80\nCircle -7500403 true true 110 75 80\nLine -7500403 true 150 100 80 30\nLine -7500403 true 150 100 220 30\n\nbutterfly\ntrue\n0\nPolygon -7500403 true true 150 165 209 199 225 225 225 255 195 270 165 255 150 240\nPolygon -7500403 true true 150 165 89 198 75 225 75 255 105 270 135 255 150 240\nPolygon -7500403 true true 139 148 100 105 55 90 25 90 10 105 10 135 25 180 40 195 85 194 139 163\nPolygon -7500403 true true 162 150 200 105 245 90 275 90 290 105 290 135 275 180 260 195 215 195 162 165\nPolygon -16777216 true false 150 255 135 225 120 150 135 120 150 105 165 120 180 150 165 225\nCircle -16777216 true false 135 90 30\nLine -16777216 false 150 105 195 60\nLine -16777216 false 150 105 105 60\n\ncar\nfalse\n0\nPolygon -7500403 true true 300 180 279 164 261 144 240 135 226 132 213 106 203 84 185 63 159 50 135 50 75 60 0 150 0 165 0 225 300 225 300 180\nCircle -16777216 true false 180 180 90\nCircle -16777216 true false 30 180 90\nPolygon -16777216 true false 162 80 132 78 134 135 209 135 194 105 189 96 180 89\nCircle -7500403 true true 47 195 58\nCircle -7500403 true true 195 195 58\n\ncircle\nfalse\n0\nCircle -7500403 true true 0 0 300\n\ncircle 2\nfalse\n0\nCircle -7500403 true true 0 0 300\nCircle -16777216 true false 30 30 240\n\ncircle outline\ntrue\n0\nCircle -7500403 false true 0 0 300\n\ncounter\nfalse\n0\nRectangle -7500403 true true 3 4 296 296\n\ncow\nfalse\n0\nPolygon -7500403 true true 200 193 197 249 179 249 177 196 166 187 140 189 93 191 78 179 72 211 49 209 48 181 37 149 25 120 25 89 45 72 103 84 179 75 198 76 252 64 272 81 293 103 285 121 255 121 242 118 224 167\nPolygon -7500403 true true 73 210 86 251 62 249 48 208\nPolygon -7500403 true true 25 114 16 195 9 204 23 213 25 200 39 123\n\ncylinder\nfalse\n0\nCircle -7500403 true true 0 0 300\n\ndot\nfalse\n0\nCircle -7500403 true true 90 90 120\n\nempty\nfalse\n0\n\neraser\nfalse\n0\nRectangle -7500403 true true 0 0 300 360\nRectangle -7500403 true true 0 0 300 375\n\nface happy\ntrue\n0\nCircle -7500403 true true 8 8 285\nCircle -16777216 true false 60 75 60\nCircle -16777216 true false 180 75 60\nPolygon -16777216 true false 150 255 90 239 62 213 47 191 67 179 90 203 109 218 150 225 192 218 210 203 227 181 251 194 236 217 212 240\n\nface neutral\nfalse\n0\nCircle -7500403 true true 8 7 285\nCircle -16777216 true false 60 75 60\nCircle -16777216 true false 180 75 60\nRectangle -16777216 true false 60 195 240 225\n\nface sad\nfalse\n0\nCircle -7500403 true true 8 8 285\nCircle -16777216 true false 60 75 60\nCircle -16777216 true false 180 75 60\nPolygon -16777216 true false 150 168 90 184 62 210 47 232 67 244 90 220 109 205 150 198 192 205 210 220 227 242 251 229 236 206 212 183\n\nfish\nfalse\n0\nPolygon -1 true false 44 131 21 87 15 86 0 120 15 150 0 180 13 214 20 212 45 166\nPolygon -1 true false 135 195 119 235 95 218 76 210 46 204 60 165\nPolygon -1 true false 75 45 83 77 71 103 86 114 166 78 135 60\nPolygon -7500403 true true 30 136 151 77 226 81 280 119 292 146 292 160 287 170 270 195 195 210 151 212 30 166\nCircle -16777216 true false 215 106 30\n\nflag\nfalse\n0\nRectangle -7500403 true true 60 15 75 300\nPolygon -7500403 true true 90 150 270 90 90 30\nLine -7500403 true 75 135 90 135\nLine -7500403 true 75 45 90 45\n\nflower\nfalse\n0\nPolygon -10899396 true false 135 120 165 165 180 210 180 240 150 300 165 300 195 240 195 195 165 135\nCircle -7500403 true true 85 132 38\nCircle -7500403 true true 130 147 38\nCircle -7500403 true true 192 85 38\nCircle -7500403 true true 85 40 38\nCircle -7500403 true true 177 40 38\nCircle -7500403 true true 177 132 38\nCircle -7500403 true true 70 85 38\nCircle -7500403 true true 130 25 38\nCircle -7500403 true true 96 51 108\nCircle -16777216 true false 113 68 74\nPolygon -10899396 true false 189 233 219 188 249 173 279 188 234 218\nPolygon -10899396 true false 180 255 150 210 105 210 75 240 135 240\n\nfull-square\nfalse\n0\nRectangle -7500403 true true 0 0 300 300\n\nhalo\nfalse\n0\nCircle -7500403 false true 75 75 150\n\nhalo-speed\nfalse\n0\n\nhouse\nfalse\n0\nRectangle -7500403 true true 45 120 255 285\nRectangle -16777216 true false 120 210 180 285\nPolygon -7500403 true true 15 120 150 15 285 120\nLine -16777216 false 30 120 270 120\n\nline\ntrue\n0\nLine -7500403 true 150 0 150 300\n\nline half\ntrue\n0\nLine -7500403 true 150 0 150 150\n\nmagnet\ntrue\n0\nPolygon -7500403 true true 120 270 75 270 60 105 60 60 75 30 106 10 150 3 195 10 225 30 240 60 240 105 225 270 180 270 195 105 196 74 184 55 165 45 135 45 115 55 104 75 105 105\nPolygon -16777216 true false 219 264 188 264 193 214 224 215\nPolygon -16777216 true false 81 264 112 264 107 214 76 215\n\nminus\ntrue\n15\nLine -7500403 false 165 135 135 135\n\nmolecule-a2\ntrue\n0\nCircle -7500403 true true 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -7500403 true true 5 67 158\nCircle -16777216 false false 4 67 160\n\nmolecule-a2-static\ntrue\n0\nCircle -13791810 true false 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -13791810 true false 5 67 158\nCircle -16777216 false false 4 67 160\n\nmolecule-ab2\ntrue\n0\nCircle -1 true false 183 63 84\nCircle -16777216 false false 183 63 84\nCircle -7500403 true true 75 75 150\nCircle -16777216 false false 75 75 150\nCircle -1 true false 33 63 84\nCircle -16777216 false false 33 63 84\n\nmolecule-ab2-a\ntrue\n0\nCircle -7500403 true true 75 75 150\nCircle -16777216 false false 75 75 150\n\nmolecule-ab2-b2\ntrue\n0\nCircle -7500403 true true 183 63 84\nCircle -16777216 false false 183 63 84\nCircle -7500403 true true 33 63 84\nCircle -16777216 false false 33 63 84\n\nmolecule-alcohol\ntrue\n6\nCircle -7500403 true false 160 106 88\nCircle -16777216 false false 159 105 90\nCircle -7500403 true false 106 106 88\nCircle -16777216 false false 105 105 90\nCircle -2674135 true false 54 106 88\nCircle -16777216 false false 53 105 90\nCircle -1 true false -1 105 88\nCircle -16777216 false false -2 104 90\nCircle -1 true false 89 192 88\nCircle -16777216 false false 88 191 90\nCircle -1 true false 213 107 88\nCircle -1 true false 86 21 88\nCircle -1 true false 174 20 88\nCircle -1 true false 176 192 88\nCircle -16777216 false false 173 19 90\nCircle -16777216 false false 85 20 90\nCircle -16777216 false false 175 191 90\nCircle -16777216 false false 212 106 90\n\nmolecule-alcohol-c2\ntrue\n0\nCircle -7500403 true true 160 106 88\nCircle -16777216 false false 159 105 90\nCircle -7500403 true true 106 106 88\nCircle -16777216 false false 105 105 90\n\nmolecule-alcohol-h5\ntrue\n0\nCircle -7500403 true true -1 105 88\nCircle -16777216 false false -2 104 90\nCircle -7500403 true true 89 192 88\nCircle -16777216 false false 88 191 90\nCircle -7500403 true true 213 107 88\nCircle -7500403 true true 86 21 88\nCircle -7500403 true true 174 20 88\nCircle -7500403 true true 176 192 88\nCircle -16777216 false false 173 19 90\nCircle -16777216 false false 85 20 90\nCircle -16777216 false false 175 191 90\nCircle -16777216 false false 212 106 90\n\nmolecule-alcohol-oh\ntrue\n0\nCircle -7500403 true true 54 106 88\nCircle -16777216 false false 53 105 90\n\nmolecule-ao\ntrue\n0\nCircle -2674135 true false 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -8630108 true false 5 67 158\nCircle -16777216 false false 4 67 160\n\nmolecule-ao-a\ntrue\n0\nCircle -7500403 true true 5 67 158\nCircle -16777216 false false 4 67 160\n\nmolecule-ao-o\ntrue\n0\nCircle -7500403 true true 136 66 158\nCircle -16777216 false false 136 66 158\n\nmolecule-candle\ntrue\n4\nCircle -7500403 true false 73 103 95\nCircle -16777216 false false 73 103 96\nCircle -7500403 true false 133 103 95\nCircle -16777216 false false 133 103 96\nCircle -1 true false 141 182 95\nCircle -16777216 false false 140 182 96\nCircle -1 true false 136 25 95\nCircle -16777216 false false 136 24 96\nCircle -1 true false -2 103 95\nCircle -1 true false 208 103 95\nCircle -1 true false 69 26 95\nCircle -1 true false 67 182 95\nCircle -16777216 false false 69 25 96\nCircle -16777216 false false 208 102 96\nCircle -16777216 false false -2 103 96\nCircle -16777216 false false 67 182 96\n\nmolecule-candle-c\ntrue\n0\nCircle -955883 true false 73 103 95\nCircle -16777216 false false 73 103 96\nCircle -955883 true false 133 103 95\nCircle -16777216 false false 133 103 96\n\nmolecule-candle-h\ntrue\n0\nCircle -13840069 true false 141 182 95\nCircle -16777216 false false 140 182 96\nCircle -13840069 true false 136 25 95\nCircle -16777216 false false 136 24 96\nCircle -13840069 true false -2 103 95\nCircle -13840069 true false 208 103 95\nCircle -13840069 true false 69 26 95\nCircle -13840069 true false 67 182 95\nCircle -16777216 false false 69 25 96\nCircle -16777216 false false 208 102 96\nCircle -16777216 false false -2 103 96\nCircle -16777216 false false 67 182 96\n\nmolecule-ch3oh\ntrue\n4\nCircle -7500403 true false 208 103 95\nCircle -16777216 false false 208 102 96\nCircle -2674135 true false 133 103 95\nCircle -16777216 false false 133 103 96\nCircle -7500403 true false -2 103 95\nCircle -7500403 true false 69 26 95\nCircle -7500403 true false 67 182 95\nCircle -16777216 false false 69 25 96\nCircle -16777216 false false -2 103 96\nCircle -16777216 false false 67 182 96\nCircle -16777216 false false 73 103 96\nCircle -16777216 true false 73 103 95\n\nmolecule-ch3oh-c\ntrue\n6\nCircle -13840069 true true 73 103 95\nCircle -16777216 false false 73 103 96\n\nmolecule-ch3oh-h4\ntrue\n0\nCircle -7500403 true true 208 103 95\nCircle -16777216 false false 208 102 96\nCircle -7500403 true true -2 103 95\nCircle -7500403 true true 69 26 95\nCircle -7500403 true true 67 182 95\nCircle -16777216 false false 69 25 96\nCircle -16777216 false false -2 103 96\nCircle -16777216 false false 67 182 96\n\nmolecule-ch3oh-o\ntrue\n1\nCircle -2674135 true true 133 103 95\nCircle -16777216 false false 133 103 96\n\nmolecule-ch4\ntrue\n6\nCircle -13840069 true true 36 20 230\nCircle -16777216 false false 35 19 232\nCircle -1 true false 206 136 92\nCircle -1 true false 1 136 92\nCircle -1 true false 109 207 92\nCircle -16777216 false false 0 135 94\nCircle -16777216 false false 205 135 94\nCircle -16777216 false false 108 207 94\nCircle -1 true false 105 1 92\nCircle -16777216 false false 104 0 94\n\nmolecule-ch4-c\ntrue\n0\nCircle -7500403 true true 36 20 230\nCircle -16777216 false false 35 19 232\n\nmolecule-ch4-h4\ntrue\n0\nCircle -7500403 true true 206 136 92\nCircle -7500403 true true 1 136 92\nCircle -7500403 true true 109 207 92\nCircle -16777216 false false 0 135 94\nCircle -16777216 false false 205 135 94\nCircle -16777216 false false 108 207 94\nCircle -7500403 true true 105 1 92\nCircle -16777216 false false 104 0 94\n\nmolecule-co2\ntrue\n5\nCircle -2674135 true false 162 81 138\nCircle -2674135 true false 0 84 138\nCircle -16777216 false false -1 83 140\nCircle -16777216 false false 161 81 140\nCircle -7500403 true false 82 86 138\nCircle -16777216 false false 81 85 140\n\nmolecule-co2-c\ntrue\n0\nCircle -7500403 true true 82 86 138\nCircle -16777216 false false 81 85 140\n\nmolecule-co2-o2\ntrue\n0\nCircle -7500403 true true 162 81 138\nCircle -7500403 true true 0 84 138\nCircle -16777216 false false -1 83 140\nCircle -16777216 false false 161 81 140\n\nmolecule-h2o\ntrue\n4\nCircle -1 true false 186 162 112\nCircle -1 true false 3 167 112\nCircle -16777216 false false 3 167 113\nCircle -16777216 false false 185 162 113\nCircle -2674135 true false 46 6 210\nCircle -16777216 false false 46 5 211\n\nmolecule-h2o-h2\ntrue\n0\nCircle -7500403 true true 186 162 112\nCircle -7500403 true true 3 167 112\nCircle -16777216 false false 3 167 113\nCircle -16777216 false false 185 162 113\n\nmolecule-h2o-o\ntrue\n0\nCircle -7500403 true true 46 6 210\nCircle -16777216 false false 46 5 211\n\nmolecule-ha\ntrue\n6\nCircle -1184463 true false 40 44 252\nCircle -16777216 false false 39 44 254\nCircle -1 true false 3 2 112\nCircle -16777216 false false 3 2 112\n\nmolecule-ha-a\ntrue\n0\nCircle -7500403 true true 3 2 112\nCircle -16777216 false false 3 2 112\n\nmolecule-ha-h\ntrue\n0\nCircle -7500403 true true 40 44 252\nCircle -16777216 false false 39 44 254\n\nmolecule-n2h4\ntrue\n2\nCircle -8630108 true false 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -8630108 true false 5 67 158\nCircle -16777216 false false 3 66 162\nCircle -7500403 true false -2 28 92\nCircle -16777216 false false -2 28 92\nCircle -7500403 true false 208 178 92\nCircle -7500403 true false 208 28 92\nCircle -7500403 true false -2 178 92\nCircle -16777216 false false 208 28 92\nCircle -16777216 false false 208 178 92\nCircle -16777216 false false -2 178 92\n\nmolecule-n2h4-h4\ntrue\n0\nCircle -7500403 true true -2 28 92\nCircle -16777216 false false -2 28 92\nCircle -7500403 true true 208 178 92\nCircle -7500403 true true 208 28 92\nCircle -7500403 true true -2 178 92\nCircle -16777216 false false 208 28 92\nCircle -16777216 false false 208 178 92\nCircle -16777216 false false -2 178 92\n\nmolecule-n2h4-n2\ntrue\n11\nCircle -8630108 true true 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -8630108 true true 5 67 158\nCircle -16777216 false false 3 66 162\n\nmolecule-n2o4\ntrue\n2\nCircle -8630108 true false 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -8630108 true false 5 67 158\nCircle -16777216 false false 3 66 162\nCircle -7500403 true false -2 28 92\nCircle -16777216 false false -2 28 92\nCircle -7500403 true false 208 178 92\nCircle -7500403 true false 208 28 92\nCircle -7500403 true false -2 178 92\nCircle -16777216 false false 208 28 92\nCircle -16777216 false false 208 178 92\nCircle -16777216 false false -2 178 92\n\nmolecule-n2o4-n2\ntrue\n11\nCircle -8630108 true true 136 66 158\nCircle -16777216 false false 136 66 158\nCircle -8630108 true true 5 67 158\nCircle -16777216 false false 3 66 162\n\nmolecule-n2o4-o4\ntrue\n0\nCircle -7500403 true true -2 28 92\nCircle -16777216 false false -2 28 92\nCircle -7500403 true true 208 178 92\nCircle -7500403 true true 208 28 92\nCircle -7500403 true true -2 178 92\nCircle -16777216 false false 208 28 92\nCircle -16777216 false false 208 178 92\nCircle -16777216 false false -2 178 92\n\nmolecule-nh3\ntrue\n6\nCircle -13840069 true true 36 5 230\nCircle -16777216 false false 35 4 232\nCircle -1 true false 208 129 92\nCircle -1 true false 0 127 92\nCircle -1 true false 109 207 92\nCircle -16777216 false false -1 126 94\nCircle -16777216 false false 208 129 94\nCircle -16777216 false false 108 207 94\n\nmolecule-nh3-h3\ntrue\n0\nCircle -7500403 true true 208 129 92\nCircle -7500403 true true 0 127 92\nCircle -7500403 true true 109 207 92\nCircle -16777216 false false -1 126 94\nCircle -16777216 false false 208 129 94\nCircle -16777216 false false 108 207 94\n\nmolecule-nh3-n\ntrue\n0\nCircle -7500403 true true 36 5 230\nCircle -16777216 false false 35 4 232\n\nmolecule-no2\ntrue\n0\nCircle -2674135 true false 162 111 138\nCircle -2674135 true false 0 114 138\nCircle -16777216 false false -1 113 140\nCircle -16777216 false false 161 111 140\nCircle -8630108 true false 82 26 138\nCircle -16777216 false false 81 25 140\n\nmolecule-no2-n\ntrue\n0\nCircle -7500403 true true 82 26 138\nCircle -16777216 false false 81 25 140\n\nmolecule-no2-o2\ntrue\n0\nCircle -7500403 true true 162 111 138\nCircle -7500403 true true 0 114 138\nCircle -16777216 false false -1 113 140\nCircle -16777216 false false 161 111 140\n\nmolecule-sugar\ntrue\n0\nPolygon -7500403 true true 90 15 210 15 285 90 285 210 210 285 90 285 15 210 15 90 90 15\nPolygon -16777216 false false 90 15 210 15 285 90 285 210 210 285 90 285 15 210 15 90 90 15\n\nmolecule-sugar-static\ntrue\n0\nPolygon -1184463 true false 90 15 210 15 285 90 285 210 210 285 90 285 15 210 15 90 90 15\nPolygon -16777216 false false 90 15 210 15 285 90 285 210 210 285 90 285 15 210 15 90 90 15\n\norbit 1\ntrue\n0\nCircle -7500403 true true 116 11 67\nCircle -7500403 false true 41 41 218\n\norbit 2\ntrue\n0\nCircle -7500403 true true 116 221 67\nCircle -7500403 true true 116 11 67\nCircle -7500403 false true 44 44 212\n\norbit 3\ntrue\n0\nCircle -7500403 true true 116 11 67\nCircle -7500403 true true 26 176 67\nCircle -7500403 true true 206 176 67\nCircle -7500403 false true 45 45 210\n\noutside\ntrue\n0\nCircle -13840069 true false -166 -121 212\n\npencil\nfalse\n0\nPolygon -7500403 true true 255 60 255 90 105 240 90 225\nPolygon -7500403 true true 60 195 75 210 240 45 210 45\nPolygon -7500403 true true 90 195 105 210 255 60 240 45\nPolygon -6459832 true false 90 195 60 195 45 255 105 240 105 210\nPolygon -16777216 true false 45 255 74 248 75 240 60 225 51 225\n\npentagon\nfalse\n0\nPolygon -7500403 true true 150 15 15 120 60 285 240 285 285 120\n\nplus\nfalse\n15\nLine -7500403 false 150 0 150 300\nLine -7500403 false 300 165 0 165\nLine -7500403 false 300 165 0 165\nLine -7500403 false 300 165 0 165\nLine -7500403 false 300 165 0 165\nLine -7500403 false 150 0 150 300\nLine -7500403 false 150 0 150 300\n\nsquare\ntrue\n0\nRectangle -7500403 true true 30 30 270 270\n\nsquare 2\nfalse\n0\nRectangle -7500403 true true 30 30 270 270\nRectangle -16777216 true false 60 60 240 240\n\nsquare full\nfalse\n0\nRectangle -7500403 true true 0 0 300 300\n\nsquare outline\nfalse\n0\nRectangle -7500403 false true 0 0 300 300\n\nsquare outline thick\nfalse\n0\nRectangle -7500403 true true 0 285 300 300\nRectangle -7500403 true true 285 0 300 300\nRectangle -7500403 true true 0 0 300 15\nRectangle -7500403 true true 0 0 15 300\n\nsquare-outline\nfalse\n6\nRectangle -13840069 false true 0 0 300 300\n\nstar\ntrue\n0\nPolygon -7500403 true true 151 1 185 108 298 108 207 175 242 282 151 216 59 282 94 175 3 108 116 108\n\nthin ring\ntrue\n0\nCircle -7500403 false true -1 -1 301\n\ntriangle\nfalse\n0\nPolygon -7500403 true true 150 30 15 255 285 255\n\ntriangle 2\nfalse\n0\nPolygon -7500403 true true 150 30 15 255 285 255\nPolygon -16777216 true false 151 99 225 223 75 224\n\nx\nfalse\n0\nPolygon -7500403 true true 270 75 225 30 30 225 75 270\nPolygon -7500403 true true 30 75 75 30 270 225 225 270\n@#$#@#$#@\nNetLogo 6.2.0\n@#$#@#$#@\n@#$#@#$#@\n@#$#@#$#@\n@#$#@#$#@\n@#$#@#$#@\ndefault\n0\n-0.2 0 0 1\n0 1 1 0\n0.2 0 0 1\nlink direction\ntrue\n0\nLine -7500403 true 150 150 90 180\nLine -7500403 true 150 150 210 180\n@#$#@#$#@\n\n@#$#@#$#@\n","netLogoSettings":{"isVertical":true}}